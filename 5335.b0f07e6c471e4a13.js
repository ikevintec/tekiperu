"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[5335],{85335:(B,p,r)=>{r.r(p),r.d(p,{ConsultaComprobantesModule:()=>Q});var l=r(74202),i=r(93075),o=r(5e3),h=r(96310),C=r(24394),b=r(1203),d=r(69808),v=r(22313),x=r(31424),Z=r(43724),y=r(14036),T=r(75652),I=r(40845),F=r(15315),_=r(74297);function A(t,s){if(1&t&&(o.TgZ(0,"div",11),o._UZ(1,"img",12),o.qZA()),2&t){const e=o.oxw();o.xp6(1),o.Q6J("src",e.company.urlLogo,o.LSH)}}function U(t,s){1&t&&o._UZ(0,"p-message",31)}function M(t,s){1&t&&o._UZ(0,"p-message",32)}function q(t,s){1&t&&o._UZ(0,"p-message",33)}function J(t,s){1&t&&o._UZ(0,"p-message",34)}function w(t,s){1&t&&o._UZ(0,"p-message",35)}function N(t,s){1&t&&o._UZ(0,"p-message",36)}const g=function(){return{width:"100%"}};function D(t,s){if(1&t){const e=o.EpF();o.TgZ(0,"form",13),o.NdJ("ngSubmit",function(){return o.CHM(e),o.oxw().submitForm()}),o.TgZ(1,"div",14),o.TgZ(2,"div",15),o.TgZ(3,"h4",16),o._uU(4,"Ruc (*)"),o.qZA(),o.TgZ(5,"input",17),o.NdJ("input",function(){return o.CHM(e),o.oxw().changeRuc()}),o.qZA(),o.YNc(6,U,1,0,"p-message",18),o.qZA(),o.TgZ(7,"div",15),o.TgZ(8,"h4",16),o._uU(9,"Tipo de documento (*)"),o.qZA(),o._UZ(10,"p-dropdown",19),o.YNc(11,M,1,0,"p-message",20),o.qZA(),o.TgZ(12,"div",15),o.TgZ(13,"h4",16),o._uU(14,"Serie (*)"),o.qZA(),o._UZ(15,"input",21),o.YNc(16,q,1,0,"p-message",22),o.qZA(),o.TgZ(17,"div",15),o.TgZ(18,"h4",16),o._uU(19,"N\xfamero (*)"),o.qZA(),o._UZ(20,"input",23),o.YNc(21,J,1,0,"p-message",24),o.qZA(),o.TgZ(22,"div",15),o.TgZ(23,"h4",16),o._uU(24,"Monto (*)"),o.qZA(),o._UZ(25,"input",25),o.YNc(26,w,1,0,"p-message",26),o.qZA(),o.TgZ(27,"div",15),o.TgZ(28,"h4",16),o._uU(29,"Fecha de emisi\xf3n (*)"),o.qZA(),o._UZ(30,"p-calendar",27),o.YNc(31,N,1,0,"p-message",28),o.qZA(),o.TgZ(32,"div",29),o._UZ(33,"button",30),o.qZA(),o.qZA(),o.qZA()}if(2&t){const e=o.oxw();o.Q6J("formGroup",e.modelForm),o.xp6(6),o.Q6J("ngIf",e.ruc.touched&&(null==e.ruc.errors?null:e.ruc.errors.required)),o.xp6(4),o.Akn(o.DdM(15,g)),o.Q6J("options",e.tiposDocumento)("showClear",!0),o.xp6(1),o.Q6J("ngIf",e.tipoDocumento.touched&&(null==e.tipoDocumento.errors?null:e.tipoDocumento.errors.required)),o.xp6(5),o.Q6J("ngIf",e.serie.touched&&(null==e.serie.errors?null:e.serie.errors.required)),o.xp6(5),o.Q6J("ngIf",e.numero.touched&&(null==e.numero.errors?null:e.numero.errors.required)),o.xp6(5),o.Q6J("ngIf",e.monto.touched&&(null==e.monto.errors?null:e.monto.errors.required)),o.xp6(4),o.Akn(o.DdM(16,g)),o.Q6J("locale",e.listas.calendarEs),o.xp6(1),o.Q6J("ngIf",e.fechaEmision.touched&&(null==e.fechaEmision.errors?null:e.fechaEmision.errors.required)),o.xp6(2),o.Q6J("disabled",!e.modelForm.valid)}}const S=function(){return{width:"800px",minWidth:"300px"}};let f=(()=>{class t{constructor(e,n,m,a,c,u,z){this.companyService=e,this.route=n,this.fb=m,this.listas=a,this.ticketService=c,this.datePipe=u,this.sanitizer=z,this.company={},this.tiposDocumento=[{codigo:"01",nombre:"Factura"},{codigo:"03",nombre:"Boleta"},{codigo:"07",nombre:"Nota de cr\xe9dito"},{codigo:"08",nombre:"Nota de d\xe9bito"},{codigo:"09",nombre:"Gu\xeda de remisi\xf3n"}],this.verPdfModal=!1}ngOnInit(){const e=this.route.snapshot.params.ruc;e&&this.companyService.publicCompanyByRuc(e).subscribe(n=>this.company=n),this.builderForm(e)}changeRuc(){const e=this.modelForm.getRawValue().ruc;e&&11===e.length&&this.companyService.publicCompanyByRuc(e).subscribe(n=>this.company=n)}builderForm(e){this.modelForm=this.fb.group({ruc:[e,[i.kI.required]],tipoDocumento:[null,[i.kI.required]],serie:["",[i.kI.required,i.kI.maxLength(4),i.kI.minLength(4)]],numero:["",[i.kI.required]],monto:["",[i.kI.required]],fechaEmision:[new Date,[i.kI.required]]})}submitForm(){let e=this.route.snapshot.params.ruc;e||(e=this.modelForm.value.ruc);const n={ruc:e,serie:this.modelForm.value.serie.toUpperCase(),tipoComprobante:this.modelForm.value.tipoDocumento.codigo,numero:this.modelForm.value.numero,montoTotal:this.modelForm.value.monto,fechaEmision:this.datePipe.transform(this.modelForm.value.fechaEmision,"yyyy-MM-dd")};this.ticketService.downloadPdfPublico(n).subscribe(m=>{this.responseData=m,this.urlB64=`data:application/pdf;base64,${m.data}`,this.verPdfModal=!0})}downloadXml(){const e=`${this.modelForm.value.serie.toUpperCase()}-${this.modelForm.value.numero}.xml`;this.downloadB64(this.responseData.xml,e)}downloadB64(e,n){const m=atob(e),a=document.createElement("a");document.body.appendChild(a);const c=new Blob([m],{type:"octet/stream"}),u=window.URL.createObjectURL(c);a.href=u,a.download=n,a.click(),window.URL.revokeObjectURL(u)}get serie(){return this.modelForm.get("serie")}get numero(){return this.modelForm.get("numero")}get tipoDocumento(){return this.modelForm.get("tipoDocumento")}get monto(){return this.modelForm.get("monto")}get ruc(){return this.modelForm.get("ruc")}get fechaEmision(){return this.modelForm.get("fechaEmision")}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(h.J),o.Y36(l.gz),o.Y36(i.qu),o.Y36(C.E),o.Y36(b.w),o.Y36(d.uU),o.Y36(v.H7))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-consulta-comprobantes"]],decls:16,vars:12,consts:[[1,"bg"],[1,"container"],["style","text-align: center; margin-bottom: 10px;",4,"ngIf"],["id","contact"],[1,"card"],["novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],["header","Comprobante electr\xf3nico",3,"visible","modal","responsive","minY","baseZIndex","visibleChange"],["id","pdftoprint","width","100%","height","400px",3,"src"],[1,"grid","mt-3"],[1,"col-6"],["type","button","pButton","","icon","fa fa-code","label","Descargar XML",3,"click"],[2,"text-align","center","margin-bottom","10px"],["alt","",2,"max-height","100px",3,"src"],["novalidate","",3,"formGroup","ngSubmit"],[1,"grid","p-fluid"],[1,"col-12","md:col-6"],[2,"margin-bottom","0.5rem","margin-top","0"],["formControlName","ruc","id","ruc","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em",3,"input"],["severity","error","text","Ingrese ruc",4,"ngIf"],["formControlName","tipoDocumento","placeholder","Seleccione...","optionLabel","nombre","id","tipoDocumento",3,"options","showClear"],["severity","error","text","Ingrese tipo de documento",4,"ngIf"],["formControlName","serie","id","serie","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["severity","error","text","Ingrese serie",4,"ngIf"],["formControlName","numero","id","numero","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["severity","error","text","Ingrese n\xfamero",4,"ngIf"],["formControlName","monto","id","monto","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["severity","error","text","Ingrese monto",4,"ngIf"],["placeholder","Fecha de emisi\xf3n","formControlName","fechaEmision","dateFormat","dd/mm/yy",3,"locale"],["severity","error","text","Ingrese fecha",4,"ngIf"],[1,"col-12",2,"text-align","center","margin-top","15px"],["pButton","","type","submit","label","Consultar",3,"disabled"],["severity","error","text","Ingrese ruc"],["severity","error","text","Ingrese tipo de documento"],["severity","error","text","Ingrese serie"],["severity","error","text","Ingrese n\xfamero"],["severity","error","text","Ingrese monto"],["severity","error","text","Ingrese fecha"]],template:function(e,n){1&e&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.YNc(2,A,2,1,"div",2),o.TgZ(3,"div",3),o.TgZ(4,"h3"),o._uU(5),o.qZA(),o.TgZ(6,"h4"),o._uU(7,"Consulta tu comprobante de pago"),o.qZA(),o.TgZ(8,"div",4),o.YNc(9,D,34,17,"form",5),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(10,"p-dialog",6),o.NdJ("visibleChange",function(a){return n.verPdfModal=a}),o.TgZ(11,"p-card"),o._UZ(12,"iframe",7),o.qZA(),o.TgZ(13,"div",8),o.TgZ(14,"div",9),o.TgZ(15,"button",10),o.NdJ("click",function(){return n.downloadXml()}),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(2),o.Q6J("ngIf",n.company&&n.company.urlLogo),o.xp6(3),o.Oqu(n.company.razonSocial),o.xp6(4),o.Q6J("ngIf",n.modelForm),o.xp6(1),o.Akn(o.DdM(11,S)),o.Q6J("visible",n.verPdfModal)("modal",!0)("responsive",!0)("minY",500)("baseZIndex",1e4),o.xp6(2),o.Q6J("src",n.sanitizer.bypassSecurityTrustResourceUrl(n.urlB64),o.uOi))},directives:[d.O5,i._Y,i.JL,i.sg,i.Fj,i.JJ,i.u,x.o,Z.q,y.Lt,T.f,I.Hq,F.V,_.Z],styles:['@import"https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,600";*[_ngcontent-%COMP%]{box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-font-smoothing:antialiased;-o-font-smoothing:antialiased;font-smoothing:antialiased;text-rendering:optimizeLegibility}body[_ngcontent-%COMP%]{font-family:Open Sans,Helvetica,Arial,sans-serif;font-weight:300;font-size:12px;line-height:30px;color:#777;background:#0CF}.container[_ngcontent-%COMP%]{padding-top:40px;max-width:600px;width:100%;margin:0 auto;position:relative}#contact[_ngcontent-%COMP%]{background:#F9F9F9;padding:25px}#contact[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#1c98ff;display:block;font-size:30px;font-weight:400}#contact[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:5px 0 15px;display:block;font-size:13px}']}),t})();const Y=[{path:":ruc",component:f},{path:"",component:f}];let O=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[l.Bz.forChild(Y)],l.Bz]}),t})();var P=r(20958);let Q=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[O,P.m]]}),t})()}}]);