"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[9558],{56644:(N,h,s)=>{s.d(h,{k:()=>S});var _=s(93075),e=s(82817),t=s(5e3),g=s(74202),v=s(87969),E=s(96310),P=s(33379),T=s(20207),d=s(59783),b=s(47745),u=s(74297),f=s(69808),x=s(31424),Z=s(43724),A=s(14036),C=s(28061),I=s(4119),O=s(10930),M=s(40845);function D(a,r){1&a&&t._UZ(0,"p-message",17)}function R(a,r){1&a&&t._UZ(0,"p-message",18)}function U(a,r){if(1&a){const o=t.EpF();t.TgZ(0,"div",23),t.TgZ(1,"label",6),t._uU(2),t.qZA(),t.TgZ(3,"div"),t.TgZ(4,"p-inputSwitch",24),t.NdJ("onChange",function(){return t.CHM(o),t.oxw(3).loadPermisosRuta()}),t.qZA(),t.qZA(),t.qZA()}if(2&a){const o=r.$implicit;t.xp6(2),t.Oqu(o.nombre),t.xp6(2),t.s9C("name","per"+o.id),t.s9C("formControlName","per"+o.id)}}function y(a,r){if(1&a){const o=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"p-panel"),t.TgZ(2,"p-header"),t.TgZ(3,"div"),t.TgZ(4,"span",19),t._uU(5),t.qZA(),t.TgZ(6,"div",20),t.TgZ(7,"p-inputSwitch",21),t.NdJ("onChange",function(n){const c=t.CHM(o).$implicit;return t.oxw(2).changeSelectorModule(c,n)}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"div",0),t.YNc(9,U,5,3,"div",22),t.qZA(),t.qZA(),t.qZA()}if(2&a){const o=r.$implicit;t.xp6(5),t.Oqu(o.nombre),t.xp6(2),t.s9C("name",o.id),t.xp6(2),t.Q6J("ngForOf",o.permisos)}}function L(a,r){if(1&a){const o=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){return t.CHM(o),t.oxw(2).confirmDelete()}),t.qZA()}}const B=function(){return{width:"100%"}};function F(a,r){if(1&a){const o=t.EpF();t.TgZ(0,"form",3),t.NdJ("ngSubmit",function(){return t.CHM(o),t.oxw().submitForm()}),t.TgZ(1,"div",4),t.TgZ(2,"div",5),t.TgZ(3,"label",6),t._uU(4,"Nombre (*)"),t.qZA(),t._UZ(5,"input",7),t.YNc(6,D,1,0,"p-message",8),t.qZA(),t.TgZ(7,"div",5),t.TgZ(8,"label",9),t._uU(9,"Ruta Inicial (*)"),t.qZA(),t._UZ(10,"p-dropdown",10),t.YNc(11,R,1,0,"p-message",11),t.qZA(),t.TgZ(12,"div",1),t.TgZ(13,"label",6),t._uU(14,"Permisos (*)"),t.qZA(),t.TgZ(15,"p-card"),t.TgZ(16,"div",0),t.YNc(17,y,10,3,"div",12),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"div",13),t._UZ(19,"button",14),t.YNc(20,L,1,0,"button",15),t._UZ(21,"button",16),t.qZA(),t.qZA(),t.qZA()}if(2&a){const o=t.oxw();t.Q6J("formGroup",o.modelForm),t.xp6(6),t.Q6J("ngIf",o.nombre.touched&&(null==o.nombre.errors?null:o.nombre.errors.required)),t.xp6(4),t.Akn(t.DdM(11,B)),t.Q6J("options",o.rutasIniciales),t.xp6(1),t.Q6J("ngIf",o.rutaInicial.touched&&(null==o.rutaInicial.errors?null:o.rutaInicial.errors.required)),t.xp6(6),t.Q6J("ngForOf",o.modulos),t.xp6(2),t.Q6J("disabled",!o.modelForm.valid)("label",o.textButtonAction),t.xp6(1),t.Q6J("ngIf",o.isEdit),t.xp6(1),t.Q6J("routerLink",o.linkVolver)}}let S=(()=>{class a{constructor(o,i,n,l,c,m,p,Y,J,Q){this.route=o,this.router=i,this.profileService=n,this.companyService=l,this.userService=c,this.loginService=m,this.messageService=p,this.confirmationService=Y,this.fb=J,this.breadcrumbService=Q,this.modulos=[],this.rutasIniciales=[]}ngOnInit(){this.breadcrumbService.setItems((0,e.kn)(this.route)),this.modeRoot&&this.companyService.findById(this.idEmpresa).subscribe(i=>{this.empresa=i});const o=["porEmpresa=true"];this.modeRoot&&o.push(`idEmpresa=${this.idEmpresa}`),this.profileService.findAllModulesAccess(o.join("&")).subscribe(i=>{this.modulos=i,this.builderForm(),this.loadModel()})}loadPermisosRuta(){this.rutasIniciales=this.modulos.map(i=>i.permisos).reduce((i,n)=>i.concat(n)).filter(i=>this.modelForm.get(`per${i.id}`).value&&i.ruta).map(i=>({label:i.ruta,value:i.ruta})),this.rutasIniciales.find(i=>i.value===this.modelForm.get("rutaInicial").value)||this.modelForm.patchValue({rutaInicial:void 0})}builderForm(){this.modelForm=this.fb.group({nombre:["",[_.kI.required]],rutaInicial:[void 0,[_.kI.required]]}),this.initializeForm()}initializeForm(){this.modulos.forEach(o=>{o.permisos.forEach(i=>{this.modelForm.addControl(`per${i.id}`,this.fb.control(!1,void 0))})})}submitForm(){let o,i;this.formToModel(),this.isEdit?(o=this.profileService.update(this.idEmpresa,this.model,this.modeRoot),i="Perfil actualizado correctamente."):(o=this.profileService.save(this.idEmpresa,this.model,this.modeRoot),i="Perfil registrado correctamente."),o.subscribe(n=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:i}),this.router.navigateByUrl(this.linkVolver)})}formToModel(){this.model||(this.model={}),this.model.nombre=this.modelForm.value.nombre,this.model.rutaInicial=this.modelForm.value.rutaInicial,this.model.empresa={id:this.idEmpresa};const i=[];this.modulos.map(n=>n.permisos).reduce((n,l)=>n.concat(l)).forEach(n=>{this.modelForm.get(`per${n.id}`).value&&i.push(n)}),this.model.permisos=i}modelToForm(o){console.log(o),this.modelForm.patchValue({nombre:o.nombre,rutaInicial:o.rutaInicial}),o.permisos.forEach(i=>{const n={};n[`per${i.id}`]=!0,this.modelForm.patchValue(n)})}changeSelectorModule(o,i){o.permisos.forEach(n=>{const l={};l[`per${n.id}`]=i.checked,this.modelForm.patchValue(l)}),this.loadPermisosRuta()}get textButtonAction(){return this.isEdit?"Actualizar":"Guardar"}get nameModulo(){return this.route.snapshot.data.title}get nombre(){return this.modelForm.get("nombre")}get rutaInicial(){return this.modelForm.get("rutaInicial")}loadModel(){this.isEdit=this.route.snapshot.data.isEdit,this.isEdit&&this.profileService.findById(this.idEmpresa,this.route.snapshot.params.id,this.modeRoot).subscribe(i=>{i&&(this.model=i,this.modelToForm(i),this.loadPermisosRuta())})}confirmDelete(){this.confirmationService.confirm({message:"Estas seguro de eliminar este registro?",accept:()=>{this.profileService.deleteById(this.idEmpresa,this.model.id,this.modeRoot).subscribe(()=>{this.messageService.clear(),this.messageService.add({severity:"success",summary:"Mensaje",detail:"Registro eliminado correctamente"}),this.router.navigateByUrl(this.linkVolver)})},acceptLabel:"Si",rejectLabel:"No"})}get modeRoot(){return this.route.snapshot.data.modeRoot}get idEmpresa(){return this.modeRoot?this.route.snapshot.params.idEmpresa:this.loginService.getUser().empresa.id}get linkVolver(){return this.modeRoot?`/empresas/${this.idEmpresa}/perfiles`:"/perfiles"}}return a.\u0275fac=function(o){return new(o||a)(t.Y36(g.gz),t.Y36(g.F0),t.Y36(v.H),t.Y36(E.J),t.Y36(P.i),t.Y36(T.r),t.Y36(d.ez),t.Y36(d.YP),t.Y36(_.qu),t.Y36(b.p))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-perfil"]],decls:4,vars:1,consts:[[1,"grid"],[1,"col-12"],["novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit"],[1,"grid","form-group"],[1,"col-6"],["for","nombre",1,"label-form"],["formControlName","nombre","id","nombre","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["severity","error","text","Ingrese nombre",4,"ngIf"],["for","rutaInicial",1,"label-form"],["id","rutaInicial","formControlName","rutaInicial","placeholder","Seleccione...",3,"options"],["severity","error","text","Ingrese ruta inicial",4,"ngIf"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12",2,"text-align","center"],["pButton","","type","submit",2,"margin-right","0.4rem",3,"disabled","label"],["style","margin-right: 0.4rem","pButton","","type","button","label","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["pButton","","type","button","label","Volver",1,"p-button-secondary",2,"margin-right","0.4rem",3,"routerLink"],["severity","error","text","Ingrese nombre"],["severity","error","text","Ingrese ruta inicial"],[1,"p-panel-title",2,"display","inline-block","margin-top","2px"],["pTooltip","Marcar/Desmarcar",2,"float","right"],[3,"name","onChange"],["class","col-12 md:col-3",4,"ngFor","ngForOf"],[1,"col-12","md:col-3"],[3,"name","formControlName","onChange"],["pButton","","type","button","label","Eliminar",1,"p-button-danger",2,"margin-right","0.4rem",3,"click"]],template:function(o,i){1&o&&(t.TgZ(0,"p-card"),t.TgZ(1,"div",0),t.TgZ(2,"div",1),t.YNc(3,F,22,12,"form",2),t.qZA(),t.qZA(),t.qZA()),2&o&&(t.xp6(3),t.Q6J("ngIf",i.modelForm))},directives:[u.Z,f.O5,_._Y,_.JL,_.sg,_.Fj,_.JJ,_.u,x.o,Z.q,A.Lt,f.sg,C.s,d.h4,I.u,O.Ql,M.Hq,g.rH],encapsulation:2}),a})()},96330:(N,h,s)=>{s.d(h,{p:()=>a});var _=s(82817),e=s(5e3),t=s(74202),g=s(87969),v=s(96310),E=s(20207),P=s(47745),T=s(74297),d=s(98952),b=s(59783),u=s(69808),f=s(40845);function x(r,o){if(1&r&&e._UZ(0,"p-sortIcon",10),2&r){const i=e.oxw().$implicit;e.Q6J("field",i.field)}}function Z(r,o){if(1&r&&(e.TgZ(0,"th",8),e._uU(1),e.YNc(2,x,1,1,"p-sortIcon",9),e.qZA()),2&r){const i=o.$implicit;e.Q6J("pSortableColumn",i.field),e.xp6(1),e.hij(" ",i.header," "),e.xp6(1),e.Q6J("ngIf",!i.isActions)}}function A(r,o){if(1&r&&(e.TgZ(0,"tr"),e.YNc(1,Z,3,3,"th",7),e.qZA()),2&r){const i=o.$implicit;e.xp6(1),e.Q6J("ngForOf",i)}}function C(r,o){if(1&r&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&r){const i=e.oxw(4).$implicit;e.xp6(1),e.Oqu(i.nombre)}}function I(r,o){if(1&r&&(e.ynx(0),e.TgZ(1,"span",17),e._uU(2,"Nombre"),e.qZA(),e.YNc(3,C,2,1,"span",13),e.BQk()),2&r){const i=e.oxw(2).$implicit,n=e.oxw().$implicit;e.xp6(3),e.Q6J("ngIf",n[i.field])}}function O(r,o){if(1&r&&(e.TgZ(0,"div",21),e.TgZ(1,"div",22),e.TgZ(2,"span",23),e._uU(3),e.qZA(),e._uU(4),e.qZA(),e.qZA()),2&r){const i=o.$implicit;e.xp6(3),e.hij("",i.modulo,": "),e.xp6(1),e.hij(" ",i.etiquetaPermisos," ")}}function M(r,o){if(1&r&&(e.TgZ(0,"div",19),e.YNc(1,O,5,2,"div",20),e.qZA()),2&r){const i=e.oxw(3).$implicit,n=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.Q6J("ngForOf",l.viewPermissions(n[i.field]))}}function D(r,o){if(1&r&&(e.ynx(0),e.TgZ(1,"span",17),e._uU(2,"Roles"),e.qZA(),e.YNc(3,M,2,1,"div",18),e.BQk()),2&r){const i=e.oxw(2).$implicit,n=e.oxw().$implicit;e.xp6(3),e.Q6J("ngIf",n[i.field])}}function R(r,o){if(1&r&&(e.ynx(0),e._uU(1),e.BQk()),2&r){const i=e.oxw(2).$implicit,n=e.oxw().$implicit;e.xp6(1),e.hij(" ",n[i.field]," ")}}function U(r,o){1&r&&(e.ynx(0),e.YNc(1,I,4,1,"ng-container",15),e.YNc(2,D,4,1,"ng-container",15),e.YNc(3,R,2,1,"ng-container",16),e.BQk()),2&r&&(e.xp6(1),e.Q6J("ngSwitchCase","nombre"),e.xp6(1),e.Q6J("ngSwitchCase","permisos"))}function y(r,o){if(1&r&&(e.ynx(0,24),e._UZ(1,"button",25),e.BQk()),2&r){const i=e.oxw(2).$implicit,n=e.oxw();e.xp6(1),e.Q6J("routerLink",n.linkUpdate(i.id))}}function L(r,o){if(1&r&&(e.TgZ(0,"td",12),e.YNc(1,U,4,2,"ng-container",13),e.YNc(2,y,2,1,"ng-container",14),e.qZA()),2&r){const i=o.$implicit;e.Q6J("ngSwitch",i.field),e.xp6(1),e.Q6J("ngIf",!i.isActions),e.xp6(1),e.Q6J("ngIf",i.isActions)}}function B(r,o){if(1&r&&(e.TgZ(0,"tr"),e.YNc(1,L,3,3,"td",11),e.qZA()),2&r){const i=o.columns;e.xp6(1),e.Q6J("ngForOf",i)}}function F(r,o){1&r&&e._UZ(0,"button",29)}function S(r,o){if(1&r){const i=e.EpF();e.TgZ(0,"div",26),e.TgZ(1,"button",27),e.NdJ("click",function(){return e.CHM(i),e.oxw().new()}),e.qZA(),e.YNc(2,F,1,0,"button",28),e.qZA()}if(2&r){const i=e.oxw();e.xp6(2),e.Q6J("ngIf",i.modeRoot)}}let a=(()=>{class r{constructor(i,n,l,c,m,p){this.route=i,this.router=n,this.profileService=l,this.companyService=c,this.loginService=m,this.breadcrumbService=p,this.perPage=10,this.modulos=[]}ngOnInit(){this.breadcrumbService.setItems((0,_.kn)(this.route)),this.profileService.findAllModulesAccess("porEmpresa=true").subscribe(i=>{this.modulos=i}),this.cols=[{field:"nombre",header:"Nombre"},{field:"permisos",header:"Permisos"},{header:"Acciones",isActions:!0}],this.loading=!0,this.loadIdEmpresa().then(()=>{this.companyService.findById(this.idEmpresa).subscribe(i=>{this.empresa=i})})}new(){this.router.navigateByUrl(this.modeRoot?`/empresas/${this.idEmpresa}/perfiles/nuevo`:"/perfiles/nuevo")}loadLazy(i){this.route.params.subscribe(n=>{const l=this.idEmpresa;this.loading=!0;const m=["pageNumber="+i.first/this.perPage,`perPage=${i.rows}`];i.sortOrder&&m.push(`sortOrder=${i.sortOrder}`),i.sortField&&m.push(`sortField=${i.sortField}`),this.profileService.findAllPage(l,m.join("&"),this.modeRoot).subscribe(p=>{this.totalRecords=p.totalElements,this.profiles=p.content,this.loading=!1})})}viewPermissions(i){const n=[];return this.modulos.forEach(l=>{const c=l.permisos.filter(m=>i.find(p=>p.id===m.id));n.push({id:l.id,modulo:l.nombre,permisos:c,etiquetaPermisos:c.map(m=>m.nombre).join(", ")})}),n.filter(l=>l.permisos.length>0)}get modeRoot(){return this.route.snapshot.data.modeRoot}loadIdEmpresa(){return new Promise(i=>{this.modeRoot?this.route.params.subscribe(n=>{this.idEmpresa=n.idEmpresa,i(void 0)}):(this.idEmpresa=this.loginService.getUser().empresa.id,i(void 0))})}linkUpdate(i){return this.modeRoot?`/empresas/${this.idEmpresa}/perfiles/editar/${i}`:`/perfiles/editar/${i}`}}return r.\u0275fac=function(i){return new(i||r)(e.Y36(t.gz),e.Y36(t.F0),e.Y36(g.H),e.Y36(v.J),e.Y36(E.r),e.Y36(P.p))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-perfiles"]],decls:8,vars:8,consts:[[1,"grid"],[1,"col-12"],["dataKey","id",3,"columns","value","lazy","paginator","rows","totalRecords","responsive","autoLayout","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"pSortableColumn",4,"ngFor","ngForOf"],[3,"pSortableColumn"],["ariaLabel","Activa para ordenar","ariaLabelDesc","Activa para ordenar en orden descendente","ariaLabelAsc","Activa para ordenar en orden ascendente",3,"field",4,"ngIf"],["ariaLabel","Activa para ordenar","ariaLabelDesc","Activa para ordenar en orden descendente","ariaLabelAsc","Activa para ordenar en orden ascendente",3,"field"],[3,"ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngIf"],["style","text-align: center",4,"ngIf"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"p-column-title"],["class","grid p-nogutter",4,"ngIf"],[1,"grid","p-nogutter"],["class","col-6 md:col-3",4,"ngFor","ngForOf"],[1,"col-6","md:col-3"],[2,"border","1px solid #d2d2d2","margin","2px","padding","2px"],[1,"text-bold"],[2,"text-align","center"],["pButton","","type","button","icon","pi pi-pencil",1,"p-button-success",3,"routerLink"],[2,"text-align","left"],["type","button","pButton","","icon","fa fa-plus","label","Nuevo",2,"margin-right","0.2rem",3,"click"],["routerLink","/empresas","style","margin-right: 0.4rem","pButton","","type","button","label","Volver","class","p-button-secondary",4,"ngIf"],["routerLink","/empresas","pButton","","type","button","label","Volver",1,"p-button-secondary",2,"margin-right","0.4rem"]],template:function(i,n){1&i&&(e.TgZ(0,"p-card"),e.TgZ(1,"div",0),e.TgZ(2,"div",1),e.TgZ(3,"p-table",2,3),e.NdJ("onLazyLoad",function(c){return n.loadLazy(c)}),e.YNc(5,A,2,1,"ng-template",4),e.YNc(6,B,2,1,"ng-template",5),e.YNc(7,S,3,1,"ng-template",6),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&i&&(e.xp6(3),e.Q6J("columns",n.cols)("value",n.profiles)("lazy",!0)("paginator",!0)("rows",n.perPage)("totalRecords",n.totalRecords)("responsive",!0)("autoLayout",!0))},directives:[T.Z,d.iA,b.jx,u.sg,d.lQ,u.O5,d.fz,u.RF,u.n9,u.ED,f.Hq,t.rH],encapsulation:2}),r})()}}]);