"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[8446],{68446:(y,T,a)=>{a.d(T,{_:()=>b});var P=a(70655),e=a(5e3),l=a(93075),A=a(82817),I=a(85932),M=a(81575),E=a(74202),h=a(47728),$=a(96310),t=a(59783),o=a(20207),c=a(33379),u=a(47745),C=a(40332),_=a(74297),p=a(31424),U=a(69808),m=a(43724),d=a(14036),f=a(88205),g=a(40845);function O(s,i){1&s&&e._UZ(0,"p-message",20)}function D(s,i){1&s&&e._UZ(0,"p-message",24)}const Z=function(){return{width:"100%"}};function L(s,i){if(1&s&&(e.TgZ(0,"div",4),e.TgZ(1,"label",21),e._uU(2,"Area de producci\xf3n (*)"),e.qZA(),e._UZ(3,"p-dropdown",22),e.YNc(4,D,1,0,"p-message",23),e.qZA()),2&s){const r=e.oxw();e.xp6(3),e.Akn(e.DdM(5,Z)),e.Q6J("options",r.areasProductions)("showClear",!0),e.xp6(1),e.Q6J("ngIf",r.modelForm.get("idArea").touched&&(null==r.modelForm.get("idArea").errors?null:r.modelForm.get("idArea").errors.required))}}function B(s,i){1&s&&(e.TgZ(0,"label",25),e._uU(1,"Subir imagen"),e.qZA())}function S(s,i){1&s&&(e.TgZ(0,"label",25),e._uU(1,"Editar imagen"),e.qZA())}function x(s,i){if(1&s&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&s){const r=i.$implicit;e.xp6(1),e.AsE("",r.name," - ",r.size," bytes ")}}function F(s,i){if(1&s&&(e.TgZ(0,"ul"),e.YNc(1,x,2,2,"li",27),e.qZA()),2&s){const r=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",r.uploadedFiles)}}function R(s,i){if(1&s&&e.YNc(0,F,2,1,"ul",26),2&s){const r=e.oxw();e.Q6J("ngIf",r.uploadedFiles.length)}}function W(s,i){if(1&s&&e._UZ(0,"img",28),2&s){const r=e.oxw();e.Q6J("src",r.imagenUrl.value,e.LSH)}}function K(s,i){if(1&s){const r=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){return e.CHM(r),e.oxw().confirmDelete()}),e.qZA()}}function Y(s,i){if(1&s&&e._UZ(0,"button",30),2&s){const r=e.oxw();e.Q6J("routerLink",r.linkVolver)}}class b{constructor(i,r,n,v,J,N,Q,z,q,V,H){this.route=i,this.router=r,this.categoryService=n,this.companyService=v,this.messageService=J,this.loginService=N,this.confirmationService=Q,this.userService=z,this.fb=q,this.breadcrumbService=V,this.restaurantService=H,this.saveCategory=new e.vpe,this.uploadedFiles=[],this.configCompany={}}ngOnInit(){this.configCompany$.subscribe(i=>{this.configCompany=i}),this.isModal||this.breadcrumbService.setItems((0,A.kn)(this.route)),this.builderForm(),this.loadData(),this.loadIdEmpresaAndIdCategoriaPadre().then(()=>{this.companyService.findById(this.idEmpresa).subscribe(i=>{this.empresa=i,this.loadModel()})})}builderForm(){this.modelForm=this.fb.group({nombre:["",[l.kI.required]],idArea:["",[]],imagenUrl:["",[]]})}submitForm(){let i,r;this.formToModel(),this.isEdit?(i=this.categoryService.update(this.idEmpresa,this.model),r="Categor\xeda actualizada correctamente."):(i=this.categoryService.save(this.idEmpresa,this.model),r="Categor\xeda registrada correctamente."),i.subscribe(()=>{this.isModal?this.saveCategory.emit():(this.messageService.add({severity:"success",summary:"Mensaje",detail:r}),this.router.navigateByUrl(this.linkVolver))})}formToModel(){this.model||(this.model={}),this.model.nombre=this.modelForm.value.nombre,this.model.empresa={id:this.idEmpresa},this.model.imagenUrl=this.modelForm.value.imagenUrl,this.model.areaProduccion=this.modelForm.value.idArea?{id:this.modelForm.value.idArea}:void 0,this.isEdit||(0==this.idCategoriaPadre?this.model.principal=!0:(this.model.categoriaPadre={id:this.idCategoriaPadre},this.model.principal=!1))}modelToForm(i){this.modelForm.patchValue({nombre:i.nombre,imagenUrl:i.imagenUrl,idArea:i.areaProduccion?i.areaProduccion.id:void 0})}get textButtonAction(){return this.isEdit?"Actualizar":"Guardar"}get nameModulo(){return this.route.snapshot.data.title}get nombre(){return this.modelForm.get("nombre")}get codigo(){return this.modelForm.get("codigo")}get imagenUrl(){return this.modelForm.get("imagenUrl")}loadModel(){this.isEdit=this.route.snapshot.data.isEdit,this.isEdit&&this.route.params.subscribe(i=>{this.categoryService.findById(i.id).subscribe(n=>{n&&(this.model=n,this.modelToForm(n))})})}confirmDelete(){this.confirmationService.confirm({message:"Estas seguro de eliminar este registro?",accept:()=>{this.categoryService.deleteById(this.idEmpresa,this.model.id).subscribe(()=>{this.messageService.clear(),this.messageService.add({severity:"success",summary:"Mensaje",detail:"Registro eliminado correctamente"}),this.router.navigateByUrl(this.linkVolver)})},acceptLabel:"Si",rejectLabel:"No"})}loadIdEmpresaAndIdCategoriaPadre(){return new Promise(i=>{this.idEmpresa=this.loginService.getUser().empresa.id,this.route?this.route.params.subscribe(r=>{this.idCategoriaPadre=r.idCategoria?r.idCategoria:0,i(void 0)}):(this.idCategoriaPadre=0,i(void 0))})}get linkVolver(){return`/categorias/${this.idCategoriaPadre}`}onFileUpload(i){const r=new FormData,n=i.files[0];r.append("file",n,n.name),this.userService.uploadImage(this.idEmpresa,r).subscribe(v=>{this.modelForm.patchValue({imagenUrl:v.url}),this.messageService.add({severity:"success",summary:"Archivo subido",detail:""})})}loadData(){this.restaurantService.findAllAreaProductions(["paginacion=false"].join("&")).subscribe(r=>{this.areasProductions=r.map(n=>({label:n.nombre,value:n.id}))})}}b.\u0275fac=function(i){return new(i||b)(e.Y36(E.gz),e.Y36(E.F0),e.Y36(h.H),e.Y36($.J),e.Y36(t.ez),e.Y36(o.r),e.Y36(t.YP),e.Y36(c.i),e.Y36(l.qu),e.Y36(u.p),e.Y36(C.T))},b.\u0275cmp=e.Xpm({type:b,selectors:[["app-categoria"]],inputs:{isModal:"isModal"},outputs:{saveCategory:"saveCategory"},decls:28,vars:12,consts:[[1,"grid"],[1,"col-12"],["novalidate","",3,"formGroup","ngSubmit"],[1,"grid","form-group"],[1,"col-12","md:col-6"],["for","nombre",1,"label-form"],["formControlName","nombre","id","nombre","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["severity","error","text","Ingrese nombre",4,"ngIf"],["class","col-12 md:col-6",4,"ngIf"],["class","first label-form",4,"ngIf"],["accept","image/*","chooseLabel","Selecciona una imagen","uploadLabel","Subir imagen","cancelLabel","Cancelar","name","file","maxFileSize","1000000",3,"customUpload","multiple","uploadHandler"],["pTemplate","content"],[2,"margin-top","0.5rem"],[1,"label-form"],["onClick","this.select();","formControlName","imagenUrl","id","imagenUrl","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["style","width: 100%;",3,"src",4,"ngIf"],[1,"col-12",2,"text-align","center"],["pButton","","type","submit",2,"margin-right","0.4rem",3,"disabled","label"],["style","margin-right: 0.4rem","pButton","","type","button","label","Eliminar","class","p-button-danger",3,"click",4,"ngIf"],["style","margin-right: 0.4rem","pButton","","type","button","label","Volver","class","p-button-secondary",3,"routerLink",4,"ngIf"],["severity","error","text","Ingrese nombre"],["for","idArea",1,"label-form"],["formControlName","idArea","id","idArea","placeholder","Seleccione...",3,"options","showClear"],["severity","error","text","Seleccione area de producci\xf3n",4,"ngIf"],["severity","error","text","Seleccione area de producci\xf3n"],[1,"first","label-form"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"width","100%",3,"src"],["pButton","","type","button","label","Eliminar",1,"p-button-danger",2,"margin-right","0.4rem",3,"click"],["pButton","","type","button","label","Volver",1,"p-button-secondary",2,"margin-right","0.4rem",3,"routerLink"]],template:function(i,r){1&i&&(e.TgZ(0,"p-card"),e.TgZ(1,"div",0),e.TgZ(2,"div",1),e.TgZ(3,"form",2),e.NdJ("ngSubmit",function(){return r.submitForm()}),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e.TgZ(6,"label",5),e._uU(7,"Nombre (*)"),e.qZA(),e._UZ(8,"input",6),e.YNc(9,O,1,0,"p-message",7),e.qZA(),e.YNc(10,L,5,6,"div",8),e.TgZ(11,"div",4),e.YNc(12,B,2,0,"label",9),e.YNc(13,S,2,0,"label",9),e.TgZ(14,"div",0),e.TgZ(15,"div",1),e.TgZ(16,"p-fileUpload",10),e.NdJ("uploadHandler",function(v){return r.onFileUpload(v)}),e.YNc(17,R,1,1,"ng-template",11),e.qZA(),e.TgZ(18,"div",12),e.TgZ(19,"label",13),e._uU(20,"URL imagen"),e.qZA(),e._UZ(21,"input",14),e.qZA(),e.qZA(),e.TgZ(22,"div",1),e.YNc(23,W,1,1,"img",15),e.qZA(),e.qZA(),e.qZA(),e.TgZ(24,"div",16),e._UZ(25,"button",17),e.YNc(26,K,1,0,"button",18),e.YNc(27,Y,1,1,"button",19),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&i&&(e.xp6(3),e.Q6J("formGroup",r.modelForm),e.xp6(6),e.Q6J("ngIf",r.nombre.touched&&(null==r.nombre.errors?null:r.nombre.errors.required)),e.xp6(1),e.Q6J("ngIf",r.configCompany.esRestaurante),e.xp6(2),e.Q6J("ngIf",!r.isEdit),e.xp6(1),e.Q6J("ngIf",r.isEdit),e.xp6(3),e.Q6J("customUpload",!0)("multiple",!1),e.xp6(7),e.Q6J("ngIf",r.imagenUrl.value),e.xp6(2),e.Q6J("disabled",!r.modelForm.valid)("label",r.textButtonAction),e.xp6(1),e.Q6J("ngIf",r.isEdit),e.xp6(1),e.Q6J("ngIf",!r.isModal))},directives:[_.Z,l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,p.o,U.O5,m.q,d.Lt,f.p,t.jx,U.sg,g.Hq,E.rH],encapsulation:2}),(0,P.gn)([(0,I.Ph)(M.Z.getConfig)],b.prototype,"configCompany$",void 0)},40332:(y,T,a)=>{a.d(T,{T:()=>E});var P=a(92340),e=a(82817),l=a(5e3),A=a(40520),I=a(96039),M=a(97374);let E=(()=>{class h{constructor(t,o,c){this.http=t,this.qzTrayService=o,this.ticketEscPosService=c,this.baseUrl=P.N.endpointApi}findAllLounges(t){return this.http.get(`${this.baseUrl}/lounges${t?`?${t}`:""}`)}findLoungeById(t){return this.http.get(`${this.baseUrl}/lounges/${t}`)}saveLounge(t){return this.http.post(`${this.baseUrl}/lounges`,t)}updateLounge(t){return this.http.put(`${this.baseUrl}/lounges`,t)}deleteLoungeById(t){return this.http.delete(`${this.baseUrl}/lounges/${t}`)}findAllTables(t){return this.http.get(`${this.baseUrl}/tables${t?`?${t}`:""}`)}findTableById(t){return this.http.get(`${this.baseUrl}/tables/${t}`)}saveTable(t){return this.http.post(`${this.baseUrl}/tables`,t)}updateTable(t){return this.http.put(`${this.baseUrl}/tables`,t)}deleteTableById(t){return this.http.delete(`${this.baseUrl}/tables/${t}`)}findAllOrder(t){return this.http.get(`${this.baseUrl}/orders-restaurant?${t}`)}findOrderById(t){return this.http.get(`${this.baseUrl}/orders-restaurant/${t}`)}updateStatusOnline(t,o){return this.http.patch(`${this.baseUrl}/orders-restaurant/${t}/estado-online?${o}`,null)}updateStatus(t,o){return this.http.patch(`${this.baseUrl}/orders-restaurant/${t}/estado?${o}`,null)}saveChecks(t,o){return this.http.post(`${this.baseUrl}/orders-restaurant/${t}/cuentas`,o)}saveOrder(t){return this.http.post(`${this.baseUrl}/orders-restaurant`,t)}findCommandById(t){return this.http.get(`${this.baseUrl}/commands/${t}`)}saveCommand(t,o){return this.http.post(`${this.baseUrl}/orders-restaurant/${t}/commands`,o)}processCommand(t,o,c,u,C){this.findCommandById(t.id).subscribe(_=>{const p=[];_.items.forEach(m=>{m.producto.categoria&&m.producto.categoria.areaProduccion&&m.producto.categoria.areaProduccion.impresoras.find(d=>d.puntoVenta.id===o.id)&&p.push(m.producto.categoria.areaProduccion),m.grupoProductoOpciones.forEach(d=>{d.producto.categoria&&d.producto.categoria.areaProduccion&&d.producto.categoria.areaProduccion.impresoras.find(f=>f.puntoVenta.id===o.id)&&p.push(d.producto.categoria.areaProduccion)})});const U=[...new Set(p.map(m=>m.id))];console.log(U),U.forEach(m=>{const d=p.find(g=>g.id===m).impresoras.find(g=>g.puntoVenta.id===o.id),f=[`idArea=${m}`,`anulacion=${c}`];u.forEach(g=>f.push(`itemAfectado=${g}`)),this.printCommand(_.id,f.join("&"),d,{escPos:C,paperWidth:d&&d.anchoPapel?d.anchoPapel:void 0})})})}printCommand(t,o,c,u){c&&this.http.get(`${P.N.endpointApi}/public/pdf/command/${t}?${o}`,{responseType:"blob"}).subscribe(_=>{u.imprimirLogoTicket=c.imprimirLogoTicket,u.escPos?this.ticketEscPosService.commandEscPos(t,o,u).subscribe(p=>{this.qzTrayService.queue.next({printer:c,data:p,options:u})}):(0,e.wO)(_).subscribe(p=>{u.flavor="base64",this.qzTrayService.queue.next({printer:c,data:p.base64,options:u})})})}findAllCommands(t){return this.http.get(`${this.baseUrl}/commands?${t}`)}updateCommandDetail(t,o,c){return this.http.patch(`${this.baseUrl}/commands/${t}/items/${o}/estadoComandaDetalle`,c)}expandCommandDetail(t){return this.http.patch(`${this.baseUrl}/commands/items/${t}/expand`,void 0)}findAllAreaProductions(t){return this.http.get(`${this.baseUrl}/production-area${t?`?${t}`:""}`)}saveAreaProduction(t){return this.http.post(`${this.baseUrl}/production-area`,t)}updateAreaProduction(t,o){return this.http.put(`${this.baseUrl}/production-area/${t}`,o)}findAreaProductionById(t){return this.http.get(`${this.baseUrl}/production-area/${t}`)}deleteAreaProductionById(t){return this.http.delete(`${this.baseUrl}/production-area/${t}`)}changeTable(t,o){return this.http.post(`${this.baseUrl}/orders-restaurant/${t}/operations/changeTable`,o)}deleteOrderCheck(t){return this.http.post(`${this.baseUrl}/orders-restaurant/${t}/operations/delete-order-check`,null)}}return h.\u0275fac=function(t){return new(t||h)(l.LFG(A.eN),l.LFG(I.k),l.LFG(M.J))},h.\u0275prov=l.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()}}]);