"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[9377,7121],{5766:(L,b,a)=>{a.d(b,{h:()=>f});var l=a(5e3),C=a(45351);let f=(()=>{class g{constructor(){}get items(){return this._items}set items(u){this._items=u,this.loadActions()}get defaultActionLabel(){return this.items?this.items[0].label:""}get defaultActionIcon(){return this.items?this.items[0].icon:""}ngOnInit(){}defaultAction(){if(this.items&&this.items.length>0){const u=this.items[0].url;u&&window.open(u,"_blank")}}loadActions(){if(this.options=[],this.items){let u=0;this.items.forEach(Z=>{if(u>0){const c=Z.url;this.options.push({label:Z.label,icon:Z.icon,command:()=>{c&&window.open(c,"_blank")}})}u++})}}}return g.\u0275fac=function(u){return new(u||g)},g.\u0275cmp=l.Xpm({type:g,selectors:[["app-actions"]],inputs:{items:"items"},decls:1,vars:3,consts:[["appendTo","body","styleClass","p-button-secondary",3,"label","icon","model","onClick"]],template:function(u,Z){1&u&&(l.TgZ(0,"p-splitButton",0),l.NdJ("onClick",function(){return Z.defaultAction()}),l.qZA()),2&u&&l.Q6J("label",Z.defaultActionLabel)("icon",Z.defaultActionIcon)("model",Z.options)},directives:[C.a],styles:[""]}),g})()},10762:(L,b,a)=>{a.d(b,{U:()=>J});var l=a(5e3),C=a(93075),f=a(45330),g=a(68446);let v=(()=>{class d{constructor(s,p){this.config=s,this.ref=p}ngOnInit(){}categorySaved(){this.ref.close(!0)}}return d.\u0275fac=function(s){return new(s||d)(l.Y36(f.S),l.Y36(f.E7))},d.\u0275cmp=l.Xpm({type:d,selectors:[["app-modal-categoria"]],decls:1,vars:1,consts:[[3,"isModal","saveCategory"]],template:function(s,p){1&s&&(l.TgZ(0,"app-categoria",0),l.NdJ("saveCategory",function(){return p.categorySaved()}),l.qZA()),2&s&&l.Q6J("isModal",!0)},directives:[g._],styles:[""]}),d})();var u=a(47728),Z=a(40845),c=a(65987),_=a(31424),P=a(4119),A=a(15315),t=a(42629);const R=function(){return{width:"50vw"}},N=function(){return{width:"100%"}},D=d=>{const T={key:d.id,label:d.nombre,children:[]};return d.categorias.forEach(s=>{T.children.push(D(s))}),T},q=(d,T)=>{if(!d||!d.length||!T)return;let s;for(let p=0;p<d.length;p++){if(Number(d[p].key)===Number(T)){s=d[p];break}if(s=q(d[p].children,T),s)break}return s},O=(d,T)=>{if(!d||!d.length||!T)return;let s;for(let p=0;p<d.length;p++){if(Number(d[p].id)===Number(T)){s=d[p];break}if(s=O(d[p].categorias,T),s)break}return s};let J=(()=>{class d{constructor(s,p){this.categoryService=s,this.dialogService=p,this.displayModal=!1,this.disabled=!1,this.changeCategory=new l.vpe,this.onChange=y=>{},this.onTouched=y=>{}}ngOnInit(){this.loadCategories().then()}loadCategories(){return new Promise(s=>{this.categoryService.findAllList(["idCategoria=0","paginacion=false"].join("&")).subscribe(y=>{this.categories=[...y],this.categoriesTree=y.map(D),s(void 0)})})}selectCategory(s){this.categoryTree=s,this.category=O(this.categories,s.key),this.displayModal=!1,this.propagateChange()}clearCategory(){this.categoryTree=void 0,this.category=void 0,this.propagateChange()}propagateChange(){this.onChange(this.category),this.changeCategory.emit(this.category)}registerOnChange(s){this.onChange=s}registerOnTouched(s){this.onTouched=s}setDisabledState(s){this.disabled=s}writeValue(s){if(console.log("change categoruy",s),s){const p=()=>{this.categoryTree=q(this.categoriesTree,s.id),this.category=s,this.onChange(s)};this.categoriesTree?p():this.loadCategories().then(()=>{p()})}else this.clearCategory()}openModalAddCategory(){this.dialogService.open(v,{header:"Registrar Categor\xeda",width:"80%"}).onClose.subscribe(p=>{p&&this.loadCategories().then()})}}return d.\u0275fac=function(s){return new(s||d)(l.Y36(u.H),l.Y36(f.xA))},d.\u0275cmp=l.Xpm({type:d,selectors:[["app-selector-categoria"]],inputs:{disabled:"disabled"},outputs:{changeCategory:"changeCategory"},features:[l._Bn([{provide:C.JU,useExisting:(0,l.Gpc)(()=>d),multi:!0}])],decls:7,vars:11,consts:[[1,"p-inputgroup"],["pButton","","type","button","icon","pi pi-eye",3,"click"],["readOnly","true","type","text","pInputText","","placeholder","Selecciona categor\xeda",3,"value","focus"],["tooltipPosition","top","pTooltip","Limpiar","pButton","","type","button","icon","pi pi-times",3,"click"],["appendTo","body","header","Selecciona una categor\xeda",3,"modal","visible","visibleChange"],["label","Nuevo","tooltipPosition","top","pTooltip","Nueva categor\xeda","pButton","","type","button","icon","pi pi-plus",1,"p-button-success","mb-2",3,"click"],["selectionMode","single",3,"value","selection","selectionChange"]],template:function(s,p){1&s&&(l.TgZ(0,"div",0),l.TgZ(1,"button",1),l.NdJ("click",function(){return p.displayModal=!0}),l.qZA(),l.TgZ(2,"input",2),l.NdJ("focus",function(){return p.displayModal=!0}),l.qZA(),l.TgZ(3,"button",3),l.NdJ("click",function(){return p.clearCategory()}),l.qZA(),l.qZA(),l.TgZ(4,"p-dialog",4),l.NdJ("visibleChange",function(I){return p.displayModal=I}),l.TgZ(5,"button",5),l.NdJ("click",function(){return p.openModalAddCategory()}),l.qZA(),l.TgZ(6,"p-tree",6),l.NdJ("selectionChange",function(I){return p.selectCategory(I)})("selectionChange",function(I){return p.categoryTree=I}),l.qZA(),l.qZA()),2&s&&(l.xp6(2),l.Q6J("value",null==p.categoryTree?null:p.categoryTree.label),l.xp6(2),l.Akn(l.DdM(9,R)),l.Q6J("modal",!0)("visible",p.displayModal),l.xp6(2),l.Akn(l.DdM(10,N)),l.Q6J("value",p.categoriesTree)("selection",p.categoryTree))},directives:[Z.Hq,c.H,_.o,P.u,A.V,t.mp],styles:[""]}),d})()},36045:(L,b,a)=>{a.d(b,{P:()=>v});var l=a(5e3),C=a(93075),f=a(12216),g=a(12145);let v=(()=>{class u{constructor(c){this.productService=c,this.filteredProducts=[],this.selectProduct=new l.vpe,this.onChange=_=>{},this.onTouched=_=>{}}ngOnInit(){}filterProducts(c){const A=["paginacion=false",`filterGlobal=${c.query.replace("&","%26")}`,"limit=20"].join("&")+(this.paramsSearch?this.paramsSearch:"");this.productService.findAllList(A).subscribe(t=>{this.filteredProducts=t})}onSelectProduct(c){this.propagateChange()}get product(){if(this.model)return"object"==typeof this.model?this.model:void 0}propagateChange(){this.onChange(this.product),this.onTouched(this.product),this.selectProduct.emit(this.product)}registerOnChange(c){this.onChange=c}registerOnTouched(c){this.onTouched=c}writeValue(c){this.model=c,c&&"object"==typeof c&&(this.model=c)}}return u.\u0275fac=function(c){return new(c||u)(l.Y36(f.M))},u.\u0275cmp=l.Xpm({type:u,selectors:[["app-producto-autocomplete"]],inputs:{paramsSearch:"paramsSearch",placeholder:"placeholder"},outputs:{selectProduct:"selectProduct"},features:[l._Bn([{provide:C.JU,useExisting:(0,l.Gpc)(()=>u),multi:!0}])],decls:1,vars:5,consts:[["field","nombre",3,"ngModel","suggestions","size","placeholder","minLength","onKeyUp","ngModelChange","onSelect","completeMethod"]],template:function(c,_){1&c&&(l.TgZ(0,"p-autoComplete",0),l.NdJ("onKeyUp",function(){return _.propagateChange()})("ngModelChange",function(A){return _.model=A})("onSelect",function(A){return _.onSelectProduct(A)})("completeMethod",function(A){return _.filterProducts(A)}),l.qZA()),2&c&&l.Q6J("ngModel",_.model)("suggestions",_.filteredProducts)("size",30)("placeholder",_.placeholder)("minLength",1)},directives:[g.Qc,C.JJ,C.On],styles:[""]}),u})()},69377:(L,b,a)=>{a.r(b),a.d(b,{InventarioModule:()=>re});var l=a(74202),C=a(54578),f=a(70655),g=a(85932),v=a(81575),u=a(8929),Z=a(30567),c=a(82817),_=a(92340),P=a(7625),A=a(24850),t=a(5e3),R=a(12216),N=a(96310),D=a(20207),q=a(59783),O=a(28566),J=a(40038),d=a(47745),T=a(21602),s=a(74297),p=a(93075),y=a(31424),I=a(10762),z=a(14036),H=a(42841),M=a(69808),G=a(93036),U=a(98952),W=a(70050),X=a(9757),j=a(4119),K=a(40845),k=a(15315);function tt(o,n){1&o&&(t.TgZ(0,"tr"),t.TgZ(1,"th"),t._uU(2,"Lote"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Cantidad"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Caducidad"),t.qZA(),t.qZA())}function et(o,n){1&o&&(t.TgZ(0,"tr"),t.TgZ(1,"th"),t._uU(2,"Serie"),t.qZA(),t.qZA())}function ot(o,n){if(1&o&&(t.YNc(0,tt,7,0,"tr",7),t.YNc(1,et,3,0,"tr",7)),2&o){const e=t.oxw();t.Q6J("ngIf","LOTE"===e.tipoLote),t.xp6(1),t.Q6J("ngIf","SERIE"===e.tipoLote)}}function nt(o,n){if(1&o&&(t.TgZ(0,"tr"),t.TgZ(1,"td",8),t.TgZ(2,"span",9),t._uU(3,"Lote"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"td",8),t.TgZ(6,"span",9),t._uU(7,"Cantidad"),t.qZA(),t._uU(8),t.qZA(),t.TgZ(9,"td",8),t.TgZ(10,"span",9),t._uU(11,"Caducidad"),t.qZA(),t._uU(12),t.ALo(13,"date"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.hij(" ",e.serie," "),t.xp6(4),t.hij(" ",e.cantidad," "),t.xp6(4),t.hij(" ",t.xi3(13,3,e.fechaVencimiento,"dd/MM/yyyy")," ")}}function it(o,n){if(1&o&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t.TgZ(2,"span",9),t._uU(3,"Serie"),t.qZA(),t._uU(4),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.hij(" ",e.serie," ")}}function at(o,n){if(1&o&&(t.YNc(0,nt,14,6,"tr",7),t.YNc(1,it,5,1,"tr",7)),2&o){const e=t.oxw();t.Q6J("ngIf","LOTE"===e.tipoLote),t.xp6(1),t.Q6J("ngIf","SERIE"===e.tipoLote)}}const lt=function(){return{width:"80vw"}};let rt=(()=>{class o{constructor(){this.displayModal=!1}ngOnInit(){}openModal(){this.displayModal=!0}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-ver-lotes"]],inputs:{lotes:"lotes",tipoLote:"tipoLote"},decls:9,vars:9,consts:[["pTooltip","Ver lotes/series","type","button","pButton","","icon","fa fa-barcode",1,"p-button-secondary","m-l-3","m-r-3",3,"click"],["appendTo","body","header","Lotes / Series",3,"visible","modal","draggable","resizable","visibleChange"],[1,"grid"],[1,"col-12","p-fluid"],[3,"value","responsive"],["pTemplate","header"],["pTemplate","body"],[4,"ngIf"],["pEditableColumn",""],[1,"p-column-title"]],template:function(e,i){1&e&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return i.openModal()}),t.qZA(),t.TgZ(1,"p-dialog",1),t.NdJ("visibleChange",function(m){return i.displayModal=m}),t.TgZ(2,"p-card"),t.TgZ(3,"div",2),t.TgZ(4,"div",3),t.TgZ(5,"p-card"),t.TgZ(6,"p-table",4),t.YNc(7,ot,2,2,"ng-template",5),t.YNc(8,at,2,2,"ng-template",6),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Akn(t.DdM(8,lt)),t.Q6J("visible",i.displayModal)("modal",!0)("draggable",!1)("resizable",!1),t.xp6(5),t.Q6J("value",i.lotes)("responsive",!0))},directives:[j.u,K.Hq,k.V,s.Z,U.iA,q.jx,M.O5,U.Wq],pipes:[M.uU],styles:[""]}),o})();var st=a(24394),pt=a(75652),w=a(5766);function ut(o,n){1&o&&(t.TgZ(0,"tr"),t.TgZ(1,"th"),t._uU(2,"Tipo"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Concepto"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Detalle"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Cantidad"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Fecha"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Responsable"),t.qZA(),t.qZA())}function ct(o,n){if(1&o&&(t.TgZ(0,"tr",15),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.ALo(11,"date"),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.qZA()),2&o){const e=n.$implicit;t.Q6J("ngClass","ENTRADA"===e.tipo?"in-inventory":"out-inventory"),t.xp6(2),t.Oqu(e.tipo),t.xp6(2),t.Oqu(e.concepto),t.xp6(2),t.Oqu(e.detalle),t.xp6(2),t.Oqu(e.cantidad),t.xp6(2),t.Oqu(t.xi3(11,7,e.fecha,"dd/MM/yyyy hh:mm a")),t.xp6(3),t.Oqu(e.responsable.nombreCompleto)}}function dt(o,n){if(1&o&&(t.TgZ(0,"div",16),t.TgZ(1,"div"),t._UZ(2,"app-actions",17),t.qZA(),t.TgZ(3,"div"),t.TgZ(4,"b"),t._uU(5,"Num. productos:"),t.qZA(),t._uU(6),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("items",e.actionsExportData),t.xp6(4),t.hij(" ",e.totalRecords," ")}}const $=function(){return{width:"100%"}};class S{constructor(n,e,i,r){this.inventoryService=n,this.datePipe=e,this.ls=i,this.loginService=r,this.unsubscribe$=new u.xQ,this.registrosInventario=[],this.perPage=10,this.tipos=[],this.conceptos=[],this.actionsExportData=[]}get inventario(){if(this.puntoVenta)return this.inventarios.find(n=>n.puntoVenta.id===this.puntoVenta.id)}ngOnInit(){this.storeSubscripcion(),this.tipos=[{value:"ENTRADA",label:"Entrada"},{value:"SALIDA",label:"Salida"}],this.conceptos=[{value:"REGISTRO_INICIAL",label:"Registro inicial"},{value:"VENTA",label:"Venta"},{value:"COMPRA",label:"Compra"},{value:"AJUSTE",label:"Ajuste"},{value:"ANULACION_VENTA",label:"Anulaci\xf3n de venta"},{value:"ANULACION_COMPRA",label:"Anulaci\xf3n de compra"},{value:"EDICION_COMPRA",label:"Edici\xf3n de compra"},{value:"TRANSFERENCIA",label:"Transferencia"}]}storeSubscripcion(){this.puntoVenta$.pipe((0,P.R)(this.unsubscribe$)).subscribe(n=>{this.puntoVenta=n,this.refreshTable()})}loadLazy(n){if(this.lastLazyLoadEvent=n,this.inventario){const i=["pageNumber="+n.first/this.perPage,`perPage=${n.rows}`];this.filtroDesde&&i.push(`filtroDesde=${this.datePipe.transform(this.filtroDesde,"dd-MM-yyyy")}`),this.filtroHasta&&i.push(`filtroHasta=${this.datePipe.transform(this.filtroHasta,"dd-MM-yyyy")}`),this.filtroTipo&&i.push(`tipo=${this.filtroTipo}`),this.filtroConcepto&&i.push(`concepto=${this.filtroConcepto}`),this.filtroDetalle&&i.push(`detalle=${this.filtroDetalle}`),this.setUrlsExport(i.join("&")),this.inventoryService.findAllLogsInventory(this.inventario.id,i.join("&")).subscribe(r=>{this.totalRecords=r.totalElements,this.registrosInventario=r.content})}}refreshTable(){this.lastLazyLoadEvent&&this.loadLazy(this.lastLazyLoadEvent)}setUrlsExport(n){const e=this.loginService.getUser().empresa.uuid,i=`${_.N.endpointApi}/public/export-data/${e}/inventory/${this.inventario.id}`;this.actionsExportData=[{icon:"fa fa-file-excel-o",label:"Exportar a excel",url:`${i}.xlsx?${n}`},{icon:"fa fa-file-pdf-o",label:"Exportar a pdf",url:`${i}.pdf?${n}`}]}}S.\u0275fac=function(n){return new(n||S)(t.Y36(O.V),t.Y36(M.uU),t.Y36(st.E),t.Y36(D.r))},S.\u0275cmp=t.Xpm({type:S,selectors:[["app-inventario-producto-detalle"]],inputs:{inventarios:"inventarios"},decls:31,vars:30,consts:[[1,"m-2"],[1,"first"],[1,"grid"],[1,"col-12"],[1,"grid","p-fluid"],[1,"col-6","md:col-3"],[1,"label-form"],["appendTo","body","name","fechaInicio","dateFormat","dd/mm/yy",3,"showButtonBar","ngModel","locale","onSelect","ngModelChange"],["appendTo","body","name","fechaFin","dateFormat","dd/mm/yy",3,"showButtonBar","ngModel","locale","onSelect","ngModelChange"],["placeholder","Seleccione...",3,"showClear","ngModel","options","onChange","ngModelChange"],["type","text","pInputText","",2,"width","100%",3,"ngModel","input","ngModelChange"],[3,"value","lazy","paginator","rows","totalRecords","onLazyLoad"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"ngClass"],[1,"flex","justify-content-between"],[3,"items"]],template:function(n,e){1&n&&(t.TgZ(0,"p-card",0),t.TgZ(1,"h3",1),t._uU(2,"Registros de inventario"),t.qZA(),t.TgZ(3,"div",2),t.TgZ(4,"div",3),t.TgZ(5,"div",4),t.TgZ(6,"div",5),t.TgZ(7,"label",6),t._uU(8,"Desde"),t.qZA(),t.TgZ(9,"p-calendar",7),t.NdJ("onSelect",function(){return e.refreshTable()})("ngModelChange",function(r){return e.filtroDesde=r}),t.qZA(),t.qZA(),t.TgZ(10,"div",5),t.TgZ(11,"label",6),t._uU(12,"Hasta"),t.qZA(),t.TgZ(13,"p-calendar",8),t.NdJ("onSelect",function(){return e.refreshTable()})("ngModelChange",function(r){return e.filtroHasta=r}),t.qZA(),t.qZA(),t.TgZ(14,"div",5),t.TgZ(15,"label",6),t._uU(16,"Tipo"),t.qZA(),t.TgZ(17,"p-dropdown",9),t.NdJ("onChange",function(){return e.refreshTable()})("ngModelChange",function(r){return e.filtroTipo=r}),t.qZA(),t.qZA(),t.TgZ(18,"div",5),t.TgZ(19,"label",6),t._uU(20,"Concepto"),t.qZA(),t.TgZ(21,"p-dropdown",9),t.NdJ("onChange",function(){return e.refreshTable()})("ngModelChange",function(r){return e.filtroConcepto=r}),t.qZA(),t.qZA(),t.TgZ(22,"div",5),t.TgZ(23,"label",6),t._uU(24,"Detalle"),t.qZA(),t.TgZ(25,"input",10),t.NdJ("input",function(){return e.refreshTable()})("ngModelChange",function(r){return e.filtroDetalle=r}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"div",3),t.TgZ(27,"p-table",11),t.NdJ("onLazyLoad",function(r){return e.loadLazy(r)}),t.YNc(28,ut,13,0,"ng-template",12),t.YNc(29,ct,14,10,"ng-template",13),t.YNc(30,dt,7,2,"ng-template",14),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.xp6(9),t.Akn(t.DdM(26,$)),t.Q6J("showButtonBar",!0)("ngModel",e.filtroDesde)("locale",e.ls.calendarEs),t.xp6(4),t.Akn(t.DdM(27,$)),t.Q6J("showButtonBar",!0)("ngModel",e.filtroHasta)("locale",e.ls.calendarEs),t.xp6(4),t.Akn(t.DdM(28,$)),t.Q6J("showClear",!0)("ngModel",e.filtroTipo)("options",e.tipos),t.xp6(4),t.Akn(t.DdM(29,$)),t.Q6J("showClear",!0)("ngModel",e.filtroConcepto)("options",e.conceptos),t.xp6(4),t.Q6J("ngModel",e.filtroDetalle),t.xp6(2),t.Q6J("value",e.registrosInventario)("lazy",!0)("paginator",!0)("rows",e.perPage)("totalRecords",e.totalRecords))},directives:[s.Z,pt.f,p.JJ,p.On,z.Lt,p.Fj,y.o,U.iA,q.jx,M.mk,w.h],pipes:[M.uU],styles:[""]}),(0,f.gn)([(0,g.Ph)(v.Z.getOffice)],S.prototype,"puntoVenta$",void 0);var gt=a(80267),mt=a(77121);const _t=["dt"];function ht(o,n){if(1&o&&(t.TgZ(0,"span",21),t._uU(1),t.ALo(2,"moneda"),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.label,"moneda"))}}function Zt(o,n){1&o&&(t._uU(0),t.ALo(1,"moneda")),2&o&&t.hij(" ",t.xi3(1,1,n.$implicit.label,"moneda")," ")}function ft(o,n){if(1&o&&(t.TgZ(0,"div",29),t.TgZ(1,"h2",30),t._uU(2),t.ALo(3,"montoDinero"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.hij(" Utilidad: ",t.xi3(3,1,e.totalUtilidad,e.codigoMoneda),"")}}function Tt(o,n){if(1&o&&(t.TgZ(0,"div",27),t.TgZ(1,"h4",28),t._uU(2),t.ALo(3,"montoDinero"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.hij("Total compras: ",t.xi3(3,1,e.totalCompras,e.codigoMoneda),"")}}function vt(o,n){if(1&o&&(t.TgZ(0,"div",1),t.TgZ(1,"p-card"),t.TgZ(2,"div",22),t.YNc(3,ft,4,4,"div",23),t.TgZ(4,"div",24),t.TgZ(5,"div",25),t.YNc(6,Tt,4,4,"div",26),t.TgZ(7,"div",27),t.TgZ(8,"h4",28),t._uU(9),t.ALo(10,"montoDinero"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o){const e=n.$implicit;t.xp6(3),t.Q6J("appPermission","PRODUCTOS_MOSTRAR_PRECIO_COMPRA"),t.xp6(3),t.Q6J("appPermission","PRODUCTOS_MOSTRAR_PRECIO_COMPRA"),t.xp6(3),t.hij("Total ventas: ",t.xi3(10,3,e.totalVentas,e.codigoMoneda),"")}}function Ct(o,n){1&o&&(t.TgZ(0,"tr"),t._UZ(1,"th",31),t.TgZ(2,"th"),t._uU(3,"Nombre"),t.qZA(),t.TgZ(4,"th"),t._uU(5,"Codigo"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"Codigo de barra"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Moneda"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Unidad compra"),t.qZA(),t.TgZ(12,"th"),t._uU(13,"Factor"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"Unidad"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Precio compra"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Precio compra u."),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Precio venta u."),t.qZA(),t.TgZ(22,"th"),t._uU(23,"Utilidad"),t.qZA(),t.TgZ(24,"th"),t._uU(25,"Total compra"),t.qZA(),t.TgZ(26,"th"),t._uU(27,"Total venta"),t.qZA(),t.TgZ(28,"th"),t._uU(29,"Total utilidad"),t.qZA(),t.TgZ(30,"th"),t._uU(31,"Marca"),t.qZA(),t.TgZ(32,"th"),t._uU(33,"Categor\xeda"),t.qZA(),t.TgZ(34,"th",32),t._uU(35,"Stock "),t._UZ(36,"p-sortIcon",33),t.qZA(),t.qZA())}function At(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto?null:e.producto.nombre)}}function yt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto?null:e.producto.codigo)}}function bt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto?null:e.producto.codigoBarra)}}function Pt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto?null:e.producto.moneda)}}function qt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto||null==e.producto.unidadCompra?null:e.producto.unidadCompra.descripcion)}}function Mt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto?null:e.producto.factor)}}function Ut(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto||null==e.producto.unidad?null:e.producto.unidad.descripcion)}}function It(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw(2).$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto?null:e.producto.precioCompra)}}function xt(o,n){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,It,2,1,"span",37),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",null==e||null==e.producto?null:e.producto.precioCompra)}}function Lt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw(2).$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto?null:e.producto.precioCompraUnidad)}}function Dt(o,n){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,Lt,2,1,"span",37),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",null==e||null==e.producto?null:e.producto.precioCompraUnidad)}}function Ot(o,n){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"span"),t._uU(2),t.ALo(3,"montoDinero"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(t.xi3(3,1,null==e||null==e.producto?null:e.producto.utilidad,null==e||null==e.producto?null:e.producto.moneda))}}function St(o,n){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"span"),t._uU(2),t.ALo(3,"montoDinero"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(t.xi3(3,1,null==e||null==e.producto?null:e.producto.valorCompra,null==e||null==e.producto?null:e.producto.moneda))}}function Et(o,n){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"span"),t._uU(2),t.ALo(3,"montoDinero"),t.qZA(),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(t.xi3(3,1,null==e||null==e.producto?null:e.producto.valorUtilidad,null==e||null==e.producto?null:e.producto.moneda))}}function Rt(o,n){if(1&o&&(t.TgZ(0,"span",43),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto||null==e.producto.marca?null:e.producto.marca.nombre)}}function Nt(o,n){if(1&o&&(t.TgZ(0,"span",43),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.producto||null==e.producto.categoria?null:e.producto.categoria.nombre)}}function Jt(o,n){if(1&o&&(t.TgZ(0,"div",44),t._UZ(1,"app-ver-lotes",45),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("tipoLote",null==e||null==e.producto?null:e.producto.tipoLote)("lotes",null==e?null:e.lotes)}}function $t(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td"),t.TgZ(2,"a",34),t._UZ(3,"i",35),t.qZA(),t.qZA(),t.TgZ(4,"td"),t.TgZ(5,"span",36),t._uU(6,"Nombre"),t.qZA(),t.YNc(7,At,2,1,"span",37),t.qZA(),t.TgZ(8,"td"),t.TgZ(9,"span",36),t._uU(10,"Codigo"),t.qZA(),t.YNc(11,yt,2,1,"span",37),t.qZA(),t.TgZ(12,"td"),t.TgZ(13,"span",36),t._uU(14,"Codigo barra"),t.qZA(),t.YNc(15,bt,2,1,"span",37),t.qZA(),t.TgZ(16,"td"),t.TgZ(17,"span",36),t._uU(18,"Moneda"),t.qZA(),t.YNc(19,Pt,2,1,"span",37),t.qZA(),t.TgZ(20,"td"),t.TgZ(21,"span",36),t._uU(22,"Unidad compra"),t.qZA(),t.YNc(23,qt,2,1,"span",37),t.qZA(),t.TgZ(24,"td"),t.TgZ(25,"span",36),t._uU(26,"Factor"),t.qZA(),t.YNc(27,Mt,2,1,"span",37),t.qZA(),t.TgZ(28,"td"),t.TgZ(29,"span",36),t._uU(30,"Unidad"),t.qZA(),t.YNc(31,Ut,2,1,"span",37),t.qZA(),t.TgZ(32,"td"),t.TgZ(33,"span",36),t._uU(34,"Precio compra"),t.qZA(),t.YNc(35,xt,2,1,"div",38),t.qZA(),t.TgZ(36,"td"),t.TgZ(37,"span",36),t._uU(38,"Precio compra u."),t.qZA(),t.YNc(39,Dt,2,1,"div",38),t.qZA(),t.TgZ(40,"td"),t.TgZ(41,"span",36),t._uU(42,"Precio venta u."),t.qZA(),t._UZ(43,"app-precio-producto-detalle",39),t.qZA(),t.TgZ(44,"td"),t.TgZ(45,"span",36),t._uU(46,"Utilidad"),t.qZA(),t.YNc(47,Ot,4,4,"div",38),t.qZA(),t.TgZ(48,"td"),t.TgZ(49,"span",36),t._uU(50,"Valor compra"),t.qZA(),t.YNc(51,St,4,4,"div",38),t.qZA(),t.TgZ(52,"td"),t.TgZ(53,"span",36),t._uU(54,"Valor venta"),t.qZA(),t.TgZ(55,"span"),t._uU(56),t.ALo(57,"montoDinero"),t.qZA(),t.qZA(),t.TgZ(58,"td"),t.TgZ(59,"span",36),t._uU(60,"Valor de utilidad"),t.qZA(),t.YNc(61,Et,4,4,"div",38),t.qZA(),t.TgZ(62,"td"),t.TgZ(63,"span",36),t._uU(64,"Marca"),t.qZA(),t.YNc(65,Rt,2,1,"span",40),t.qZA(),t.TgZ(66,"td"),t.TgZ(67,"span",36),t._uU(68,"Categoria"),t.qZA(),t.YNc(69,Nt,2,1,"span",40),t.qZA(),t.TgZ(70,"td"),t.TgZ(71,"span",36),t._uU(72,"Stock"),t.qZA(),t.TgZ(73,"div"),t.TgZ(74,"app-mostrar-stock",41),t.NdJ("changeStock",function(){return t.CHM(e),t.oxw().resetAndRefreshTable()}),t.qZA(),t.qZA(),t.YNc(75,Jt,2,2,"div",42),t.qZA(),t.qZA()}if(2&o){const e=n.expanded,i=n.$implicit,r=t.oxw();t.xp6(2),t.Q6J("pRowToggler",i),t.xp6(1),t.Q6J("ngClass",e?"pi pi-chevron-down":"pi pi-chevron-right"),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.nombre),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.codigo),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.codigoBarra),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.moneda),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.unidadCompra),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.factor),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.unidad),t.xp6(4),t.Q6J("appPermission","PRODUCTOS_MOSTRAR_PRECIO_COMPRA"),t.xp6(4),t.Q6J("appPermission","PRODUCTOS_MOSTRAR_PRECIO_COMPRA"),t.xp6(4),t.Q6J("puntoVenta",r.puntoVenta)("producto",null==i?null:i.producto),t.xp6(4),t.Q6J("appPermission","PRODUCTOS_MOSTRAR_PRECIO_COMPRA"),t.xp6(4),t.Q6J("appPermission","PRODUCTOS_MOSTRAR_PRECIO_COMPRA"),t.xp6(5),t.Oqu(t.xi3(57,21,null==i||null==i.producto?null:i.producto.valorVenta,null==i||null==i.producto?null:i.producto.moneda)),t.xp6(5),t.Q6J("appPermission","PRODUCTOS_MOSTRAR_PRECIO_COMPRA"),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.marca),t.xp6(4),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.categoria),t.xp6(5),t.Q6J("producto",null==i?null:i.producto),t.xp6(1),t.Q6J("ngIf",null==i||null==i.producto?null:i.producto.loteSerie)}}function wt(o,n){if(1&o&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._UZ(2,"app-inventario-producto-detalle",46),t.qZA(),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.uIk("colspan",18),t.xp6(1),t.Q6J("inventarios",null==e||null==e.producto?null:e.producto.inventarios)}}function Yt(o,n){if(1&o&&(t.TgZ(0,"div",47),t.TgZ(1,"div"),t._UZ(2,"app-actions",48),t.qZA(),t.TgZ(3,"div"),t.TgZ(4,"b"),t._uU(5,"Num. productos:"),t.qZA(),t._uU(6),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("items",e.actionsExportData),t.xp6(4),t.hij(" ",e.totalRecords," ")}}const Y=function(){return{width:"100%"}};class x{constructor(n,e,i,r,m,h,Q,V,B,F){this.route=n,this.router=e,this.productService=i,this.companyService=r,this.loginService=m,this.messageService=h,this.inventoryService=Q,this.brandService=V,this.breadcrumbService=B,this.currencyService=F,this.perPage=10,this.unsubscribe$=new u.xQ,this.marcas=[],this.actionsExportData=[],this.monedas=[],this.totalesInventario=[],this.conStock=!0,this.configCompany={}}ngOnInit(){this.configCompany$.pipe((0,P.R)(this.unsubscribe$)).subscribe(n=>{this.configCompany=n}),this.validarPuntoVenta(),this.breadcrumbService.setItems((0,c.kn)(this.route)),this.loadData()}ngOnDestroy(){this.subsPuntoVenta.unsubscribe()}resetAndRefreshTable(){this.tabla.clear()}validarPuntoVenta(){this.subsPuntoVenta=this.puntoVenta$.subscribe(n=>{this.puntoVenta=n,this.resetAndRefreshTable()})}loadLazy(n){this.lastLazyLoadEvent=n;const i=["pageNumber="+n.first/this.perPage,`perPage=${n.rows}`,`idPuntoVenta=${this.puntoVenta.id}`];n.sortOrder&&i.push(`sortOrder=${n.sortOrder}`),n.sortField&&i.push(`sortField=${n.sortField}`),n.filters.global&&i.push(`clave=${n.filters.global.value}`),this.marca&&i.push(`idMarca=${this.marca.id}`),this.categoria&&i.push(`idCategoria=${this.categoria.id}`),this.moneda&&i.push(`moneda=${this.moneda}`),this.conStock&&i.push(`conStock=${this.conStock}`),this.setUrlsExport(i.join("&"));const r=()=>{this.inventoryService.findAllProductsPage(i.join("&")).pipe((0,A.U)(m=>(m.content.forEach(h=>{h.producto.precioCompra||(h.producto.precioCompra=0),h.producto.utilidad=(0,c.KL)(h.producto,this.puntoVenta,{igv:this.configCompany.igv})-h.producto.precioCompraUnidad,h.producto.valorCompra=h.stock*h.producto.precioCompraUnidad,h.producto.valorVenta=h.stock*(0,c.KL)(h.producto,this.puntoVenta,{igv:this.configCompany.igv}),h.producto.valorUtilidad=h.producto.valorVenta-h.producto.valorCompra}),m))).subscribe(m=>{this.totalRecords=m.totalElements,this.inventories=m.content})};this.conStock?r():this.inventoryService.initByOffice({conStock:!1,idPuntoVenta:this.puntoVenta.id}).subscribe(()=>r()),this.loadTotales(i)}loadTotales(n){this.inventoryService.findTotales(n.join("&")).subscribe(e=>this.totalesInventario=e)}loadIdEmpresa(){return new Promise(n=>{this.idEmpresa=this.loginService.getUser().empresa.id,n(void 0)})}linkUpdate(n){return`/productos/editar/${n}`}downloadTemplate(){window.open("assets/plantilla.xlsx")}loadData(){return new Promise(n=>{(0,Z.D)(this.brandService.findAll(""),this.currencyService.findAll().pipe((0,A.U)(e=>e.map(i=>({label:i.codigoMoneda,value:i.codigoMoneda}))))).subscribe(e=>{this.marcas=e[0],this.monedas=e[1],n(void 0)})})}setUrlsExport(n){const e=this.loginService.getUser().empresa.uuid,i=`${_.N.endpointApi}/public/export-data/${e}/inventory`;this.actionsExportData=[{icon:"fa fa-file-excel-o",label:"Exportar a excel",url:`${i}.xlsx?${n}`},{icon:"fa fa-file-pdf-o",label:"Exportar a pdf",url:`${i}.pdf?${n}`}]}}x.\u0275fac=function(n){return new(n||x)(t.Y36(l.gz),t.Y36(l.F0),t.Y36(R.M),t.Y36(N.J),t.Y36(D.r),t.Y36(q.ez),t.Y36(O.V),t.Y36(J.c),t.Y36(d.p),t.Y36(T.i))},x.\u0275cmp=t.Xpm({type:x,selectors:[["app-inventario-productos"]],viewQuery:function(n,e){if(1&n&&t.Gf(_t,7),2&n){let i;t.iGM(i=t.CRH())&&(e.tabla=i.first)}},decls:35,vars:26,consts:[[1,"grid"],[1,"col-12"],[1,"grid","p-fluid"],[1,"col-6","md:col-4"],[1,"label-form"],["type","text","pInputText","","placeholder","Buscar por nombre o c\xf3digo",1,"derecha",2,"width","100%",3,"ngModel","ngModelChange","input"],[3,"ngModel","changeCategory","ngModelChange"],[1,"md:col-4","col-6"],["placeholder","Seleccione","name","moneda",3,"ngModel","options","showClear","onChange","ngModelChange"],["pTemplate","selectedItem"],["pTemplate","item"],["dataKey","id","id","marca","placeholder","Seleccione...","optionLabel","nombre",3,"options","ngModel","showClear","onChange","ngModelChange"],[1,"md:col-2","col-6"],["onLabel","Si","offLabel","No",3,"ngModel","onChange","ngModelChange"],["class","col-12",4,"ngFor","ngForOf"],["dataKey","id",3,"value","lazy","paginator","rows","totalRecords","responsive","autoLayout","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","summary"],[2,"vertical-align","middle"],[1,"grid","p-nogutter"],["class","col-fixed","style","width: 250px;",4,"appPermission"],[1,"col"],[1,"grid","p-nogutter","p-jc-end"],["class","col-fixed",4,"appPermission"],[1,"col-fixed"],[1,"mt-2","mb-2","ml-4","mr-4"],[1,"col-fixed",2,"width","250px"],[1,"m-0"],[2,"width","3em"],["pSortableColumn","stock"],["field","stock"],["href","#",3,"pRowToggler"],[3,"ngClass"],[1,"p-column-title"],[4,"ngIf"],[4,"appPermission"],[3,"puntoVenta","producto"],["class","capitalized",4,"ngIf"],["mostrar","button",3,"producto","changeStock"],["class","mt-1",4,"ngIf"],[1,"capitalized"],[1,"mt-1"],[3,"tipoLote","lotes"],[3,"inventarios"],[1,"flex","justify-content-between"],[3,"items"]],template:function(n,e){if(1&n){const i=t.EpF();t.TgZ(0,"p-card"),t.TgZ(1,"div",0),t.TgZ(2,"div",1),t.TgZ(3,"div",2),t.TgZ(4,"div",3),t.TgZ(5,"label",4),t._uU(6,"Clave de b\xfasqueda"),t.qZA(),t.TgZ(7,"input",5),t.NdJ("ngModelChange",function(m){return e.filtroGlobal=m})("input",function(m){return t.CHM(i),t.MAs(30).filterGlobal(m.target.value,"contains")}),t.qZA(),t.qZA(),t.TgZ(8,"div",3),t.TgZ(9,"label",4),t._uU(10,"Categor\xeda"),t.qZA(),t.TgZ(11,"app-selector-categoria",6),t.NdJ("changeCategory",function(){return e.resetAndRefreshTable()})("ngModelChange",function(m){return e.categoria=m}),t.qZA(),t.qZA(),t.TgZ(12,"div",7),t.TgZ(13,"label",4),t._uU(14,"Moneda"),t.qZA(),t.TgZ(15,"p-dropdown",8),t.NdJ("onChange",function(){return e.resetAndRefreshTable()})("ngModelChange",function(m){return e.moneda=m}),t.YNc(16,ht,3,4,"ng-template",9),t.YNc(17,Zt,2,4,"ng-template",10),t.qZA(),t.qZA(),t.TgZ(18,"div",7),t.TgZ(19,"label",4),t._uU(20,"Marca"),t.qZA(),t.TgZ(21,"p-dropdown",11),t.NdJ("onChange",function(){return e.resetAndRefreshTable()})("ngModelChange",function(m){return e.marca=m}),t.qZA(),t.qZA(),t.TgZ(22,"div",12),t.TgZ(23,"label",4),t._uU(24,"Mostrar solo productos con stock"),t.qZA(),t.TgZ(25,"div"),t.TgZ(26,"p-toggleButton",13),t.NdJ("onChange",function(){return e.resetAndRefreshTable()})("ngModelChange",function(m){return e.conStock=m}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(27,vt,11,6,"div",14),t.TgZ(28,"div",1),t.TgZ(29,"p-table",15,16),t.NdJ("onLazyLoad",function(m){return e.loadLazy(m)}),t.YNc(31,Ct,37,0,"ng-template",17),t.YNc(32,$t,76,24,"ng-template",18),t.YNc(33,wt,3,2,"ng-template",19),t.YNc(34,Yt,7,2,"ng-template",20),t.qZA(),t.qZA(),t.qZA(),t.qZA()}2&n&&(t.xp6(7),t.Q6J("ngModel",e.filtroGlobal),t.xp6(4),t.Q6J("ngModel",e.categoria),t.xp6(4),t.Akn(t.DdM(23,Y)),t.Q6J("ngModel",e.moneda)("options",e.monedas)("showClear",!0),t.xp6(6),t.Akn(t.DdM(24,Y)),t.Q6J("options",e.marcas)("ngModel",e.marca)("showClear",!0),t.xp6(5),t.Akn(t.DdM(25,Y)),t.Q6J("ngModel",e.conStock),t.xp6(1),t.Q6J("ngForOf",e.totalesInventario),t.xp6(2),t.Q6J("value",e.inventories)("lazy",!0)("paginator",!0)("rows",e.perPage)("totalRecords",e.totalRecords)("responsive",!0)("autoLayout",!0))},directives:[s.Z,p.Fj,y.o,p.JJ,p.On,I.U,z.Lt,q.jx,H.CO,M.sg,G.l,U.iA,U.lQ,U.fz,U.jB,M.mk,M.O5,W.e,X.d,rt,S,w.h],pipes:[gt.s,mt.Z],styles:[""]}),(0,f.gn)([(0,g.Ph)(v.Z.getOffice)],x.prototype,"puntoVenta$",void 0),(0,f.gn)([(0,g.Ph)(v.Z.getConfig)],x.prototype,"configCompany$",void 0);var Qt=a(70906),Vt=a(17102),Bt=a(36045);const Ft=["dt"];function zt(o,n){1&o&&(t.TgZ(0,"tr"),t.TgZ(1,"th"),t._uU(2,"Tipo"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Producto"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Serie/Lote"),t.qZA(),t.TgZ(7,"th",15),t._uU(8,"Cantidad "),t._UZ(9,"p-sortIcon",16),t.qZA(),t.TgZ(10,"th",17),t._uU(11,"Caducidad "),t._UZ(12,"p-sortIcon",18),t.qZA(),t.TgZ(13,"th"),t._uU(14," Acciones "),t.qZA(),t.qZA())}function jt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",null==e?null:e.tipoLote,"")}}function Kt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e||null==e.inventario||null==e.inventario.producto?null:e.inventario.producto.nombre)}}function Ht(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e?null:e.serie)}}function Gt(o,n){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,null==e?null:e.fechaVencimiento,"dd/MM/yyyy"))}}function Wt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td"),t.TgZ(2,"span",19),t._uU(3,"Ti[p"),t.qZA(),t.YNc(4,jt,2,1,"span",20),t.qZA(),t.TgZ(5,"td"),t.TgZ(6,"span",19),t._uU(7,"Producto"),t.qZA(),t.YNc(8,Kt,2,1,"span",20),t.qZA(),t.TgZ(9,"td"),t.TgZ(10,"span",19),t._uU(11,"Codigo"),t.qZA(),t.YNc(12,Ht,2,1,"span",20),t.qZA(),t.TgZ(13,"td"),t.TgZ(14,"span",19),t._uU(15,"Cantidad"),t.qZA(),t.TgZ(16,"span"),t._uU(17),t.qZA(),t.qZA(),t.TgZ(18,"td"),t.TgZ(19,"span",19),t._uU(20,"Caducidad"),t.qZA(),t.YNc(21,Gt,3,4,"span",20),t.qZA(),t.TgZ(22,"td"),t.TgZ(23,"button",21),t.NdJ("click",function(){const m=t.CHM(e).$implicit;return t.oxw().deleteLote(m)}),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=n.$implicit;t.xp6(4),t.Q6J("ngIf",null==e?null:e.tipoLote),t.xp6(4),t.Q6J("ngIf",null==e||null==e.inventario||null==e.inventario.producto?null:e.inventario.producto.nombre),t.xp6(4),t.Q6J("ngIf",null==e?null:e.serie),t.xp6(5),t.Oqu(null==e?null:e.cantidad),t.xp6(4),t.Q6J("ngIf",null==e?null:e.fechaVencimiento)}}function Xt(o,n){if(1&o&&(t.TgZ(0,"div",22),t.TgZ(1,"div"),t._UZ(2,"app-actions",23),t.qZA(),t.TgZ(3,"div"),t.TgZ(4,"b"),t._uU(5,"Num. lotes:"),t.qZA(),t._uU(6),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("items",e.actionsExportData),t.xp6(4),t.hij(" ",e.totalRecords," ")}}class E{constructor(n,e,i,r,m,h,Q,V,B,F,se){this.route=n,this.router=e,this.productService=i,this.companyService=r,this.loginService=m,this.messageService=h,this.inventoryService=Q,this.batchProductService=V,this.brandService=B,this.breadcrumbService=F,this.confirmationService=se,this.actionsExportData=[],this.perPage=10,this.tiposLote=[]}ngOnInit(){this.tipoLote="all",this.tiposLote=[{label:"Todos",value:"all"},{label:"Lote",value:"LOTE"},{label:"Serie",value:"SERIE"}],this.validarPuntoVenta(),this.breadcrumbService.setItems((0,c.kn)(this.route))}ngOnDestroy(){this.subsPuntoVenta.unsubscribe()}resetAndRefreshTable(){this.tabla.clear()}validarPuntoVenta(){this.subsPuntoVenta=this.puntoVenta$.subscribe(n=>{this.puntoVenta=n,this.resetAndRefreshTable()})}loadLazy(n){this.lastLazyLoadEvent=n;const i=["pageNumber="+n.first/this.perPage,`perPage=${n.rows}`,`idPuntoVenta=${this.puntoVenta.id}`];n.sortOrder&&i.push(`sortOrder=${n.sortOrder}`),n.sortField&&i.push(`sortField=${n.sortField}`),n.filters.global&&i.push(`clave=${n.filters.global.value}`),this.producto&&i.push(`idProducto=${this.producto.id}`),"all"!==this.tipoLote&&i.push(`tipo=${this.tipoLote}`),this.cantidad&&i.push(`cantidad=${this.cantidad}`),this.serie&&i.push(`serie=${this.serie}`),this.setUrlsExport(i.join("&")),this.batchProductService.findAllPage(i.join("&")).subscribe(r=>{this.totalRecords=r.totalElements,this.lotes=r.content})}setUrlsExport(n){const e=this.loginService.getUser().empresa.uuid,i=`${_.N.endpointApi}/public/export-data/${e}/batch-products`;this.actionsExportData=[{icon:"fa fa-file-excel-o",label:"Exportar a excel",url:`${i}.xlsx?${n}`},{icon:"fa fa-file-pdf-o",label:"Exportar a pdf",url:`${i}.pdf?${n}`}]}deleteLote(n){this.confirmationService.confirm({message:`\xbfEst\xe1 seguro de eliminar el lote/serie ${n.serie}?`,accept:()=>{this.batchProductService.delete(n.id).subscribe(()=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:"Lote eliminado correctamente"}),this.resetAndRefreshTable()})},acceptLabel:"Si",rejectLabel:"No"})}}E.\u0275fac=function(n){return new(n||E)(t.Y36(l.gz),t.Y36(l.F0),t.Y36(R.M),t.Y36(N.J),t.Y36(D.r),t.Y36(q.ez),t.Y36(O.V),t.Y36(Qt.P),t.Y36(J.c),t.Y36(d.p),t.Y36(q.YP))},E.\u0275cmp=t.Xpm({type:E,selectors:[["app-inventario-lotes"]],viewQuery:function(n,e){if(1&n&&t.Gf(Ft,7),2&n){let i;t.iGM(i=t.CRH())&&(e.tabla=i.first)}},decls:26,vars:12,consts:[[1,"grid"],[1,"col-12"],[1,"grid","p-fluid"],[1,"col-6","md:col-4"],[1,"label-form"],[3,"options","ngModel","onChange","ngModelChange"],["type","text","pInputText","","placeholder","Buscar por serie / lote",2,"width","100%",3,"ngModel","ngModelChange","input"],[1,"md:col-4","col-6"],["type","text","pInputText","","placeholder","Buscar por cantidad",2,"width","100%",3,"ngModel","ngModelChange","input"],["placeholder","Producto",3,"ngModel","selectProduct","ngModelChange"],["dataKey","id",3,"value","lazy","paginator","rows","totalRecords","responsive","autoLayout","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["pSortableColumn","cantidad"],["field","cantidad"],["pSortableColumn","fechaVencimiento"],["field","fechaVencimiento"],[1,"p-column-title"],[4,"ngIf"],["pTooltip","Eliminar","type","button","pButton","","icon","pi pi-trash",1,"p-button-secondary","m-l-3","m-r-3",3,"click"],[1,"flex","justify-content-between"],[3,"items"]],template:function(n,e){1&n&&(t.TgZ(0,"p-card"),t.TgZ(1,"div",0),t.TgZ(2,"div",1),t.TgZ(3,"div",2),t.TgZ(4,"div",3),t.TgZ(5,"label",4),t._uU(6,"Tipo"),t.qZA(),t.TgZ(7,"p-selectButton",5),t.NdJ("onChange",function(){return e.resetAndRefreshTable()})("ngModelChange",function(r){return e.tipoLote=r}),t.qZA(),t.qZA(),t.TgZ(8,"div",3),t.TgZ(9,"label",4),t._uU(10,"Serie / Lote"),t.qZA(),t.TgZ(11,"input",6),t.NdJ("ngModelChange",function(r){return e.serie=r})("input",function(){return e.resetAndRefreshTable()}),t.qZA(),t.qZA(),t.TgZ(12,"div",7),t.TgZ(13,"label",4),t._uU(14,"Cantidad"),t.qZA(),t.TgZ(15,"input",8),t.NdJ("ngModelChange",function(r){return e.cantidad=r})("input",function(){return e.resetAndRefreshTable()}),t.qZA(),t.qZA(),t.TgZ(16,"div",7),t.TgZ(17,"label",4),t._uU(18,"Producto"),t.qZA(),t.TgZ(19,"app-producto-autocomplete",9),t.NdJ("selectProduct",function(){return e.resetAndRefreshTable()})("ngModelChange",function(r){return e.producto=r}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"div",1),t.TgZ(21,"p-table",10,11),t.NdJ("onLazyLoad",function(r){return e.loadLazy(r)}),t.YNc(23,zt,15,0,"ng-template",12),t.YNc(24,Wt,24,5,"ng-template",13),t.YNc(25,Xt,7,2,"ng-template",14),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.xp6(7),t.Q6J("options",e.tiposLote)("ngModel",e.tipoLote),t.xp6(4),t.Q6J("ngModel",e.serie),t.xp6(4),t.Q6J("ngModel",e.cantidad),t.xp6(4),t.Q6J("ngModel",e.producto),t.xp6(2),t.Q6J("value",e.lotes)("lazy",!0)("paginator",!0)("rows",e.perPage)("totalRecords",e.totalRecords)("responsive",!0)("autoLayout",!0))},directives:[s.Z,Vt.UN,p.JJ,p.On,p.Fj,y.o,Bt.P,U.iA,q.jx,U.lQ,U.fz,M.O5,j.u,K.Hq,w.h],pipes:[M.uU],styles:[""]}),(0,f.gn)([(0,g.Ph)(v.Z.getOffice)],E.prototype,"puntoVenta$",void 0);const kt=[{path:"",component:x,canActivate:[C.P],data:{breadcrumb:[{label:"Operaciones"},{label:"Inventario"},{label:"Inventario de productos"}]}},{path:"lotes",component:E,canActivate:[C.P],data:{breadcrumb:[{label:"Operaciones"},{label:"Inventario"},{label:"Lotes y series"}]}}];let te=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[l.Bz.forChild(kt)],l.Bz]}),o})();var ee=a(20958),oe=a(19406),ne=a(45330),ie=a(16672),ae=a(21767),le=a(99266);let re=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[ne.xA],imports:[[te,ee.m,ie.u,ae.Z,oe.P,le.w]]}),o})()},93036:(L,b,a)=>{a.d(b,{l:()=>f});var l=a(5e3),C=a(20207);let f=(()=>{class g{constructor(u,Z,c,_){this.element=u,this.templateRef=Z,this.viewContainer=c,this.loginService=_}set appPermission(u){this.loginService.hasPermission(u)?this.viewContainer.createEmbeddedView(this.templateRef):this.viewContainer.clear()}}return g.\u0275fac=function(u){return new(u||g)(l.Y36(l.SBq),l.Y36(l.Rgc),l.Y36(l.s_b),l.Y36(C.r))},g.\u0275dir=l.lG2({type:g,selectors:[["","appPermission",""]],inputs:{appPermission:"appPermission"}}),g})()},65987:(L,b,a)=>{a.d(b,{H:()=>f});var l=a(63191),C=a(5e3);let f=(()=>{class g{constructor(){this._isReadonly=!1}set appReadonly(u){this._isReadonly=(0,l.Ig)(u)}}return g.\u0275fac=function(u){return new(u||g)},g.\u0275dir=C.lG2({type:g,selectors:[["","readonly",""],["","readOnly",""]],inputs:{appReadonly:"appReadonly"}}),g})()},77121:(L,b,a)=>{a.d(b,{Z:()=>f});var l=a(80267),C=a(5e3);let f=(()=>{class g{transform(u,Z,c){u||(u=0),c?!c&&c>4&&(c=4):c=2;const _=l.Z.find(A=>A.codigoMoneda===Z);return`${_?_.simbolo:"Desc."} ${parseFloat(u).toFixed(c)}`}}return g.\u0275fac=function(u){return new(u||g)},g.\u0275pipe=C.Yjl({name:"montoDinero",type:g,pure:!0}),g})()}}]);