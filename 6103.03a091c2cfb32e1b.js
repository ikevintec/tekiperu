"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[6103,7121],{5766:(P,A,a)=>{a.d(A,{h:()=>h});var r=a(5e3),f=a(45351);let h=(()=>{class d{constructor(){}get items(){return this._items}set items(s){this._items=s,this.loadActions()}get defaultActionLabel(){return this.items?this.items[0].label:""}get defaultActionIcon(){return this.items?this.items[0].icon:""}ngOnInit(){}defaultAction(){if(this.items&&this.items.length>0){const s=this.items[0].url;s&&window.open(s,"_blank")}}loadActions(){if(this.options=[],this.items){let s=0;this.items.forEach(T=>{if(s>0){const u=T.url;this.options.push({label:T.label,icon:T.icon,command:()=>{u&&window.open(u,"_blank")}})}s++})}}}return d.\u0275fac=function(s){return new(s||d)},d.\u0275cmp=r.Xpm({type:d,selectors:[["app-actions"]],inputs:{items:"items"},decls:1,vars:3,consts:[["appendTo","body","styleClass","p-button-secondary",3,"label","icon","model","onClick"]],template:function(s,T){1&s&&(r.TgZ(0,"p-splitButton",0),r.NdJ("onClick",function(){return T.defaultAction()}),r.qZA()),2&s&&r.Q6J("label",T.defaultActionLabel)("icon",T.defaultActionIcon)("model",T.options)},directives:[f.a],styles:[""]}),d})()},10762:(P,A,a)=>{a.d(A,{U:()=>q});var r=a(5e3),f=a(93075),h=a(45330),d=a(68446);let Z=(()=>{class g{constructor(p,c){this.config=p,this.ref=c}ngOnInit(){}categorySaved(){this.ref.close(!0)}}return g.\u0275fac=function(p){return new(p||g)(r.Y36(h.S),r.Y36(h.E7))},g.\u0275cmp=r.Xpm({type:g,selectors:[["app-modal-categoria"]],decls:1,vars:1,consts:[[3,"isModal","saveCategory"]],template:function(p,c){1&p&&(r.TgZ(0,"app-categoria",0),r.NdJ("saveCategory",function(){return c.categorySaved()}),r.qZA()),2&p&&r.Q6J("isModal",!0)},directives:[d._],styles:[""]}),g})();var s=a(47728),T=a(40845),u=a(65987),_=a(31424),b=a(4119),e=a(15315),D=a(42629);const F=function(){return{width:"50vw"}},$=function(){return{width:"100%"}},E=g=>{const C={key:g.id,label:g.nombre,children:[]};return g.categorias.forEach(p=>{C.children.push(E(p))}),C},R=(g,C)=>{if(!g||!g.length||!C)return;let p;for(let c=0;c<g.length;c++){if(Number(g[c].key)===Number(C)){p=g[c];break}if(p=R(g[c].children,C),p)break}return p},L=(g,C)=>{if(!g||!g.length||!C)return;let p;for(let c=0;c<g.length;c++){if(Number(g[c].id)===Number(C)){p=g[c];break}if(p=L(g[c].categorias,C),p)break}return p};let q=(()=>{class g{constructor(p,c){this.categoryService=p,this.dialogService=c,this.displayModal=!1,this.disabled=!1,this.changeCategory=new r.vpe,this.onChange=M=>{},this.onTouched=M=>{}}ngOnInit(){this.loadCategories().then()}loadCategories(){return new Promise(p=>{this.categoryService.findAllList(["idCategoria=0","paginacion=false"].join("&")).subscribe(M=>{this.categories=[...M],this.categoriesTree=M.map(E),p(void 0)})})}selectCategory(p){this.categoryTree=p,this.category=L(this.categories,p.key),this.displayModal=!1,this.propagateChange()}clearCategory(){this.categoryTree=void 0,this.category=void 0,this.propagateChange()}propagateChange(){this.onChange(this.category),this.changeCategory.emit(this.category)}registerOnChange(p){this.onChange=p}registerOnTouched(p){this.onTouched=p}setDisabledState(p){this.disabled=p}writeValue(p){if(console.log("change categoruy",p),p){const c=()=>{this.categoryTree=R(this.categoriesTree,p.id),this.category=p,this.onChange(p)};this.categoriesTree?c():this.loadCategories().then(()=>{c()})}else this.clearCategory()}openModalAddCategory(){this.dialogService.open(Z,{header:"Registrar Categor\xeda",width:"80%"}).onClose.subscribe(c=>{c&&this.loadCategories().then()})}}return g.\u0275fac=function(p){return new(p||g)(r.Y36(s.H),r.Y36(h.xA))},g.\u0275cmp=r.Xpm({type:g,selectors:[["app-selector-categoria"]],inputs:{disabled:"disabled"},outputs:{changeCategory:"changeCategory"},features:[r._Bn([{provide:f.JU,useExisting:(0,r.Gpc)(()=>g),multi:!0}])],decls:7,vars:11,consts:[[1,"p-inputgroup"],["pButton","","type","button","icon","pi pi-eye",3,"click"],["readOnly","true","type","text","pInputText","","placeholder","Selecciona categor\xeda",3,"value","focus"],["tooltipPosition","top","pTooltip","Limpiar","pButton","","type","button","icon","pi pi-times",3,"click"],["appendTo","body","header","Selecciona una categor\xeda",3,"modal","visible","visibleChange"],["label","Nuevo","tooltipPosition","top","pTooltip","Nueva categor\xeda","pButton","","type","button","icon","pi pi-plus",1,"p-button-success","mb-2",3,"click"],["selectionMode","single",3,"value","selection","selectionChange"]],template:function(p,c){1&p&&(r.TgZ(0,"div",0),r.TgZ(1,"button",1),r.NdJ("click",function(){return c.displayModal=!0}),r.qZA(),r.TgZ(2,"input",2),r.NdJ("focus",function(){return c.displayModal=!0}),r.qZA(),r.TgZ(3,"button",3),r.NdJ("click",function(){return c.clearCategory()}),r.qZA(),r.qZA(),r.TgZ(4,"p-dialog",4),r.NdJ("visibleChange",function(U){return c.displayModal=U}),r.TgZ(5,"button",5),r.NdJ("click",function(){return c.openModalAddCategory()}),r.qZA(),r.TgZ(6,"p-tree",6),r.NdJ("selectionChange",function(U){return c.selectCategory(U)})("selectionChange",function(U){return c.categoryTree=U}),r.qZA(),r.qZA()),2&p&&(r.xp6(2),r.Q6J("value",null==c.categoryTree?null:c.categoryTree.label),r.xp6(2),r.Akn(r.DdM(9,F)),r.Q6J("modal",!0)("visible",c.displayModal),r.xp6(2),r.Akn(r.DdM(10,$)),r.Q6J("value",c.categoriesTree)("selection",c.categoryTree))},directives:[T.Hq,u.H,_.o,b.u,e.V,D.mp],styles:[""]}),g})()},99266:(P,A,a)=>{a.d(A,{w:()=>h});var r=a(20958),f=a(5e3);let h=(()=>{class d{}return d.\u0275fac=function(s){return new(s||d)},d.\u0275mod=f.oAB({type:d}),d.\u0275inj=f.cJS({imports:[[r.m]]}),d})()},16672:(P,A,a)=>{a.d(A,{u:()=>h});var r=a(20958),f=a(5e3);let h=(()=>{class d{}return d.\u0275fac=function(s){return new(s||d)},d.\u0275mod=f.oAB({type:d}),d.\u0275inj=f.cJS({imports:[[r.m]]}),d})()},36045:(P,A,a)=>{a.d(A,{P:()=>Z});var r=a(5e3),f=a(93075),h=a(12216),d=a(12145);let Z=(()=>{class s{constructor(u){this.productService=u,this.filteredProducts=[],this.selectProduct=new r.vpe,this.onChange=_=>{},this.onTouched=_=>{}}ngOnInit(){}filterProducts(u){const e=["paginacion=false",`filterGlobal=${u.query.replace("&","%26")}`,"limit=20"].join("&")+(this.paramsSearch?this.paramsSearch:"");this.productService.findAllList(e).subscribe(D=>{this.filteredProducts=D})}onSelectProduct(u){this.propagateChange()}get product(){if(this.model)return"object"==typeof this.model?this.model:void 0}propagateChange(){this.onChange(this.product),this.onTouched(this.product),this.selectProduct.emit(this.product)}registerOnChange(u){this.onChange=u}registerOnTouched(u){this.onTouched=u}writeValue(u){this.model=u,u&&"object"==typeof u&&(this.model=u)}}return s.\u0275fac=function(u){return new(u||s)(r.Y36(h.M))},s.\u0275cmp=r.Xpm({type:s,selectors:[["app-producto-autocomplete"]],inputs:{paramsSearch:"paramsSearch",placeholder:"placeholder"},outputs:{selectProduct:"selectProduct"},features:[r._Bn([{provide:f.JU,useExisting:(0,r.Gpc)(()=>s),multi:!0}])],decls:1,vars:5,consts:[["field","nombre",3,"ngModel","suggestions","size","placeholder","minLength","onKeyUp","ngModelChange","onSelect","completeMethod"]],template:function(u,_){1&u&&(r.TgZ(0,"p-autoComplete",0),r.NdJ("onKeyUp",function(){return _.propagateChange()})("ngModelChange",function(e){return _.model=e})("onSelect",function(e){return _.onSelectProduct(e)})("completeMethod",function(e){return _.filterProducts(e)}),r.qZA()),2&u&&r.Q6J("ngModel",_.model)("suggestions",_.filteredProducts)("size",30)("placeholder",_.placeholder)("minLength",1)},directives:[d.Qc,f.JJ,f.On],styles:[""]}),s})()},19406:(P,A,a)=>{a.d(A,{P:()=>Z});var r=a(20958),f=a(99266),h=a(16672),d=a(5e3);let Z=(()=>{class s{}return s.\u0275fac=function(u){return new(u||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[[r.m,f.w,h.u]]}),s})()},76103:(P,A,a)=>{a.r(A),a.d(A,{ReportesModule:()=>ze});var r=a(74202),f=a(54578),h=a(70655),d=a(8929),Z=a(30567),s=a(85932),T=a(81575),u=a(82817),_=a(66239),b=a(92340),e=a(5e3),D=a(1203),F=a(96310),$=a(33379),E=a(20207),R=a(69808),L=a(24876),q=a(59783),g=a(2314),C=a(24394),p=a(47745),c=a(21602),M=a(86529),U=a(74297),k=a(14036),O=a(93075),ee=a(17102),G=a(75652),K=a(86526),te=a(31424),oe=a(10762),ne=a(36045),ie=a(79142),N=a(98952),ae=a(4119),z=a(5766),le=a(15315),re=a(20657),se=a(10930),pe=a(40845),W=a(80267),X=a(77121);const de=["fileUploadEmail"],ce=["dt"],V=function(){return{width:"100%"}};function ue(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",4),e.TgZ(1,"label",5),e._uU(2,"Punto de venta"),e.qZA(),e.TgZ(3,"p-dropdown",31),e.NdJ("onChange",function(){return e.CHM(t),e.oxw().changePuntoVenta()})("ngModelChange",function(l){return e.CHM(t),e.oxw().filtroPuntoVenta=l}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Akn(e.DdM(5,V)),e.Q6J("showClear",!0)("ngModel",t.filtroPuntoVenta)("options",t.puntosVenta)}}function ge(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",4),e.TgZ(1,"label",5),e._uU(2,"Caja"),e.qZA(),e.TgZ(3,"p-dropdown",32),e.NdJ("onChange",function(){return e.CHM(t),e.oxw().resetAndRefreshTable()})("ngModelChange",function(l){return e.CHM(t),e.oxw().filtroEstacionVenta=l}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Akn(e.DdM(4,V)),e.Q6J("ngModel",t.filtroEstacionVenta)("options",t.estacionesVenta)}}function me(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",8),e.TgZ(1,"label",5),e._uU(2,"Desde"),e.qZA(),e.TgZ(3,"p-calendar",33),e.NdJ("onSelect",function(){return e.CHM(t),e.oxw().resetAndRefreshTable()})("ngModelChange",function(l){return e.CHM(t),e.oxw().filtroDesde=l}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Akn(e.DdM(5,V)),e.Q6J("ngModel",t.filtroDesde)("showTime",!0)("locale",t.ls.calendarEs)}}function he(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",8),e.TgZ(1,"label",5),e._uU(2,"Hasta"),e.qZA(),e.TgZ(3,"p-calendar",34),e.NdJ("onSelect",function(){return e.CHM(t),e.oxw().resetAndRefreshTable()})("ngModelChange",function(l){return e.CHM(t),e.oxw().filtroHasta=l}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Akn(e.DdM(5,V)),e.Q6J("ngModel",t.filtroHasta)("showTime",!0)("locale",t.ls.calendarEs)}}function _e(i,n){if(1&i&&(e.TgZ(0,"span",35),e._uU(1),e.ALo(2,"moneda"),e.qZA()),2&i){const t=n.$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,t.label,"moneda"))}}function fe(i,n){1&i&&(e._uU(0),e.ALo(1,"moneda")),2&i&&e.hij(" ",e.xi3(1,1,n.$implicit.label,"moneda")," ")}function Ze(i,n){if(1&i&&(e.TgZ(0,"div",37),e.TgZ(1,"div",38),e.TgZ(2,"h2",39),e._uU(3),e.ALo(4,"montoDinero"),e.qZA(),e.qZA(),e.TgZ(5,"div",40),e._UZ(6,"p-tag",41),e.ALo(7,"montoDinero"),e._UZ(8,"p-tag",41),e.ALo(9,"montoDinero"),e._UZ(10,"p-tag",41),e.ALo(11,"montoDinero"),e._UZ(12,"p-tag",42),e.ALo(13,"montoDinero"),e._UZ(14,"p-tag",41),e.ALo(15,"montoDinero"),e.qZA(),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(3),e.hij("Total por comprobante: ",e.xi3(4,6,t.totalCalculado,t.codigoMoneda),""),e.xp6(3),e.MGl("value","Facturas: ",e.xi3(7,9,t.totalFacturas,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Boletas: ",e.xi3(9,12,t.totalBoletas,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Notas de venta: ",e.xi3(11,15,t.totalNotasVenta,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Notas de cr\xe9dito: ",e.xi3(13,18,t.totalNotasCredito,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Notas de d\xe9bito: ",e.xi3(15,21,t.totalNotasDebito,t.codigoMoneda),"")}}function Te(i,n){if(1&i&&(e.ynx(0),e.YNc(1,Ze,16,24,"div",36),e.BQk()),2&i){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.totalCalculado)}}function Ce(i,n){if(1&i&&(e.TgZ(0,"div",37),e.TgZ(1,"div",38),e.TgZ(2,"h2",39),e._uU(3),e.ALo(4,"montoDinero"),e.qZA(),e.qZA(),e.TgZ(5,"div",40),e._UZ(6,"p-tag",41),e.ALo(7,"montoDinero"),e._UZ(8,"p-tag",41),e.ALo(9,"montoDinero"),e._UZ(10,"p-tag",41),e.ALo(11,"montoDinero"),e._UZ(12,"p-tag",42),e.ALo(13,"montoDinero"),e._UZ(14,"p-tag",41),e.ALo(15,"montoDinero"),e.qZA(),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(3),e.hij("Total por item: ",e.xi3(4,6,t.totalCalculado,t.codigoMoneda),""),e.xp6(3),e.MGl("value","Facturas: ",e.xi3(7,9,t.totalFacturas,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Boletas: ",e.xi3(9,12,t.totalBoletas,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Notas de venta: ",e.xi3(11,15,t.totalNotasVenta,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Notas de cr\xe9dito: ",e.xi3(13,18,t.totalNotasCredito,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Notas de d\xe9bito: ",e.xi3(15,21,t.totalNotasDebito,t.codigoMoneda),"")}}function Ae(i,n){if(1&i&&(e.ynx(0),e.YNc(1,Ce,16,24,"div",36),e.BQk()),2&i){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.totalCalculado)}}function ve(i,n){if(1&i&&(e.TgZ(0,"div",37),e.TgZ(1,"div",38),e.TgZ(2,"h2",39),e._uU(3),e.ALo(4,"montoDinero"),e.qZA(),e.qZA(),e.TgZ(5,"div",40),e._UZ(6,"p-tag",41),e.ALo(7,"montoDinero"),e._UZ(8,"p-tag",42),e.ALo(9,"montoDinero"),e.qZA(),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(3),e.hij("Total utilidad: ",e.xi3(4,3,t.totalCalculado,t.codigoMoneda),""),e.xp6(3),e.MGl("value","Monto ventas: ",e.xi3(7,6,t.totalVentas,t.codigoMoneda),""),e.xp6(2),e.MGl("value","Monto compras: ",e.xi3(9,9,t.totalCompras,t.codigoMoneda),"")}}function Me(i,n){if(1&i&&(e.ynx(0),e.YNc(1,ve,10,12,"div",36),e.BQk()),2&i){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.totalCalculado)}}function be(i,n){1&i&&(e.TgZ(0,"tr"),e._UZ(1,"th",43),e.TgZ(2,"th"),e._uU(3,"Fecha"),e.qZA(),e.TgZ(4,"th"),e._uU(5,"Comprobante"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Cliente"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Moneda"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Total venta"),e.qZA(),e.TgZ(12,"th",44),e._uU(13,"Producto "),e._UZ(14,"p-sortIcon",45),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Cantidad"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"P. Compra U."),e.qZA(),e.TgZ(19,"th"),e._uU(20,"P. Venta U."),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Categor\xeda"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Total prod."),e.qZA(),e.qZA())}function ye(i,n){if(1&i&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e.TgZ(2,"div",0),e.TgZ(3,"div",46),e.TgZ(4,"h3",47),e._uU(5,"Punto de venta"),e.qZA(),e.TgZ(6,"p",48),e.TgZ(7,"span"),e._uU(8),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"div",46),e.TgZ(10,"h3",47),e._uU(11,"Estaci\xf3n"),e.qZA(),e.TgZ(12,"p",48),e.TgZ(13,"span"),e._uU(14),e.qZA(),e.qZA(),e.qZA(),e.TgZ(15,"div",46),e.TgZ(16,"h3",47),e._uU(17,"Tipo venta"),e.qZA(),e.TgZ(18,"p",48),e.TgZ(19,"span"),e._uU(20),e.qZA(),e.qZA(),e.qZA(),e.TgZ(21,"div",46),e.TgZ(22,"h3",47),e._uU(23,"Vendedor"),e.qZA(),e.TgZ(24,"p",48),e.TgZ(25,"span"),e._uU(26),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&i){const t=n.$implicit;e.xp6(1),e.uIk("colspan",18),e.xp6(7),e.Oqu(null==t||null==t.ticket||null==t.ticket.puntoVenta?null:t.ticket.puntoVenta.nombre),e.xp6(6),e.Oqu(null==t||null==t.ticket||null==t.ticket.estacionVenta?null:t.ticket.estacionVenta.nombre),e.xp6(6),e.Oqu(null==t||null==t.ticket?null:t.ticket.tipoVenta),e.xp6(6),e.Oqu(null==t||null==t.ticket||null==t.ticket.vendedor?null:t.ticket.vendedor.nombreCompleto)}}function Re(i,n){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"montoDinero"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,null==t||null==t.ticket?null:t.ticket.totalVenta,null==t||null==t.ticket?null:t.ticket.codigoMoneda))}}function Pe(i,n){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"montoDinero"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" (Gratuita: ",e.xi3(2,1,null==t||null==t.ticket?null:t.ticket.totalValorVentaGratuita,null==t||null==t.ticket?null:t.ticket.codigoMoneda)," )")}}function Ue(i,n){if(1&i&&(e.TgZ(0,"span",55),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.descripcion)}}function Se(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td"),e.TgZ(2,"a",49),e._UZ(3,"i",50),e.qZA(),e.qZA(),e.TgZ(4,"td"),e.TgZ(5,"span",51),e._uU(6,"Fecha"),e.qZA(),e.TgZ(7,"span"),e._uU(8),e.qZA(),e.qZA(),e.TgZ(9,"td"),e.TgZ(10,"span",51),e._uU(11,"Comprobante"),e.qZA(),e._uU(12),e.ALo(13,"tipoDocumento"),e.qZA(),e.TgZ(14,"td"),e.TgZ(15,"span",51),e._uU(16,"Cliente"),e.qZA(),e._uU(17),e.qZA(),e.TgZ(18,"td"),e.TgZ(19,"span",51),e._uU(20,"Moneda"),e.qZA(),e._uU(21),e.qZA(),e.TgZ(22,"td"),e.TgZ(23,"span",51),e._uU(24,"Total"),e.qZA(),e.YNc(25,Re,3,4,"span",52),e.YNc(26,Pe,3,4,"span",52),e.qZA(),e.TgZ(27,"td"),e.TgZ(28,"span",51),e._uU(29,"Producto"),e.qZA(),e.YNc(30,Ue,2,1,"span",53),e._uU(31),e.qZA(),e.TgZ(32,"td"),e.TgZ(33,"span",51),e._uU(34,"Cantidad"),e.qZA(),e._uU(35),e.qZA(),e.TgZ(36,"td"),e.TgZ(37,"span",51),e._uU(38,"P. Compra U."),e.qZA(),e._uU(39),e.TgZ(40,"i",54),e.NdJ("click",function(){const m=e.CHM(t).$implicit;return e.oxw().editPurchaseProductPrice(m)}),e.qZA(),e.qZA(),e.TgZ(41,"td"),e.TgZ(42,"span",51),e._uU(43,"P. Venta U."),e.qZA(),e._uU(44),e.qZA(),e.TgZ(45,"td"),e.TgZ(46,"span",51),e._uU(47,"Categor\xeda"),e.qZA(),e._uU(48),e.qZA(),e.TgZ(49,"td"),e.TgZ(50,"span",51),e._uU(51,"Total prod."),e.qZA(),e._uU(52),e.ALo(53,"montoDinero"),e.qZA(),e.qZA()}if(2&i){const t=n.expanded,o=n.$implicit;e.xp6(2),e.Q6J("pRowToggler",o),e.xp6(1),e.Q6J("ngClass",t?"pi pi-chevron-down":"pi pi-chevron-right"),e.xp6(5),e.Oqu(null==o||null==o.ticket?null:o.ticket.fechaEmision),e.xp6(4),e.lnq(" ",e.lcZ(13,17,null==o||null==o.ticket?null:o.ticket.tipoComprobante)," - (",null==o||null==o.ticket?null:o.ticket.serie,"-",null==o||null==o.ticket?null:o.ticket.numero,") "),e.xp6(5),e.hij(" ",null==o||null==o.ticket?null:o.ticket.denominacionReceptor," "),e.xp6(4),e.hij(" ",null==o||null==o.ticket?null:o.ticket.codigoMoneda," "),e.xp6(4),e.Q6J("ngIf",null==o||null==o.ticket?null:o.ticket.totalVenta),e.xp6(1),e.Q6J("ngIf",null==o||null==o.ticket?null:o.ticket.totalValorVentaGratuita),e.xp6(4),e.Q6J("ngIf",!(null!=o&&o.producto)),e.xp6(1),e.hij(" ",null==o||null==o.producto?null:o.producto.nombre," "),e.xp6(4),e.hij(" ",null==o?null:o.cantidad," "),e.xp6(4),e.hij(" ",null==o?null:o.precioCompraUnitario," "),e.xp6(5),e.hij(" ",null==o?null:o.precioVentaUnitario," "),e.xp6(4),e.hij(" ",null==o||null==o.producto||null==o.producto.categoria?null:o.producto.categoria.nombre," "),e.xp6(4),e.hij(" ",e.xi3(53,19,null==o?null:o.precioTotal,null==o||null==o.ticket?null:o.ticket.codigoMoneda)," ")}}function qe(i,n){if(1&i&&(e.TgZ(0,"div",56),e.TgZ(1,"div"),e._UZ(2,"app-actions",57),e.qZA(),e.TgZ(3,"div"),e.TgZ(4,"b"),e._uU(5,"Resultados:"),e.qZA(),e._uU(6),e.qZA(),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("items",t.actionsExportData),e.xp6(4),e.hij(" ",t.totalRecords," ")}}function Ve(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"h3"),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div",58),e.TgZ(5,"label",59),e._uU(6,"Precio de compra (*)"),e.qZA(),e.qZA(),e.TgZ(7,"div",60),e.TgZ(8,"input",61),e.NdJ("ngModelChange",function(l){return e.CHM(t),e.oxw().edicionPrecioCompraUnitario.precioCompraUnitario=l}),e.qZA(),e.qZA(),e.TgZ(9,"div",58),e.TgZ(10,"label",59),e._uU(11,"Editar todas las coincidencias? (*)"),e.qZA(),e.qZA(),e.TgZ(12,"div",60),e.TgZ(13,"p-inputSwitch",62),e.NdJ("ngModelChange",function(l){return e.CHM(t),e.oxw().edicionPrecioCompraUnitario.cambiarPares=l}),e.qZA(),e.qZA(),e.TgZ(14,"div",63),e.TgZ(15,"button",64),e.NdJ("click",function(){return e.CHM(t),e.oxw().saveEditPurchaseProductPrice()}),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Oqu(t.edicionPrecioCompraUnitario.ticketDetail.descripcion),e.xp6(5),e.Q6J("ngModel",t.edicionPrecioCompraUnitario.precioCompraUnitario),e.xp6(5),e.Q6J("ngModel",t.edicionPrecioCompraUnitario.cambiarPares)}}const xe=function(){return{label:"Si",value:!0}},De=function(){return{label:"No",value:!1}},Ee=function(i,n){return[i,n]},Oe=function(){return{width:"50vw"}};class S{constructor(n,t,o,l,m,v,y,I,w,Y,Q,j,B,H,We,Xe,et,tt){this.route=n,this.router=t,this.ticketService=o,this.companyService=l,this.userService=m,this.loginService=v,this.datePipe=y,this.storageService=I,this.messageService=w,this.tdPipe=Y,this.tipoDocumentoPipe=Q,this.store=j,this.ls=B,this.breadcrumbService=H,this.currencyService=We,this.saleStationService=Xe,this.listas=et,this.confirmationService=tt,this.unsubscribe$=new d.xQ,this.ticketsDetails=[],this.perPage=10,this.modoFiltroRangoFechas=!0,this.filtroEstadoAnulacion=!1,this.filtroCanal="PLATFORM",this.filtroTipoComprobante=[],this.puntosVenta=[],this.estacionesVenta=[],this.usuarios=[],this.tiposComprobantes=[],this.monedas=[],this.totales=[],this.totalesUtilidad=[],this.totalesPorDetalle=[],this.metodosPago=[],this.metodosPagoSelect=[],this.visibleEditPurchaseProductPrice=!1}ngOnInit(){this.breadcrumbService.setItems((0,u.kn)(this.route)),this.tiposComprobantes=[{value:"01",label:"Factura"},{value:"03",label:"Boleta"},{value:"07",label:"Nota de cr\xe9dito"},{value:"08",label:"Nota de d\xe9bito"},{value:"NV",label:"Nota de venta"}];const n=new Date;this.filtroDesde=new Date(n.getFullYear(),n.getMonth(),1,0,0,0),this.filtroHasta=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59),this.integracionApi=this.loginService.getUser().empresa.integracionApi,this.configCompany$.pipe((0,_.Rs)(this.unsubscribe$)).subscribe(t=>{this.configCompany=t,this.loadData(),this.validarPuntoVenta(),this.changeModoFiltroRangoFechas(),this.loadSaleStation(),this.loadPaymentsMethods()})}editPurchaseProductPrice(n){this.edicionPrecioCompraUnitario={ticketDetail:n,precioCompraUnitario:n.precioCompraUnitario,cambiarPares:!0},this.visibleEditPurchaseProductPrice=!0}saveEditPurchaseProductPrice(){this.confirmationService.confirm({message:"\xbfEst\xe1 seguro de editar el precio de compra en la venta actual?",accept:()=>{this.ticketService.editPurchaseUnitPrice(this.edicionPrecioCompraUnitario.ticketDetail.id,this.edicionPrecioCompraUnitario).subscribe(()=>{this.resetAndRefreshTable(),this.edicionPrecioCompraUnitario=void 0,this.visibleEditPurchaseProductPrice=!1})},acceptLabel:"Si",rejectLabel:"No"})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}resetAndRefreshTable(){this.tabla.clear()}changeModoFiltroRangoFechas(){if(this.modoFiltroRangoFechas){const n=new Date;this.filtroDesde=new Date(n.getFullYear(),n.getMonth(),1,0,0,0),this.filtroHasta=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59)}else this.filtroDesde=null,this.filtroHasta=null;this.resetAndRefreshTable()}validarPuntoVenta(){this.puntoVenta$.pipe((0,_.Rs)(this.unsubscribe$)).subscribe(n=>{this.filtroPuntoVenta=n,this.resetAndRefreshTable()}),this.estacionVenta$.pipe((0,_.Rs)(this.unsubscribe$)).subscribe(n=>{this.estacionVenta=n})}loadLazy(n){const o=[`filtroCanal=${this.filtroCanal}`,"pageNumber="+n.first/this.perPage,`perPage=${n.rows}`];void 0!==this.filtroEstadoAnulacion&&o.push(`filtroEstadoAnulacion=${this.filtroEstadoAnulacion}`),this.filtroDesde&&o.push(`filtroDesde=${this.datePipe.transform(this.filtroDesde,"dd-MM-yyyy H:mm:ss")}`),this.filtroHasta&&o.push(`filtroHasta=${this.datePipe.transform(this.filtroHasta,"dd-MM-yyyy H:mm:ss")}`),this.filtroTipoComprobante&&this.filtroTipoComprobante.forEach(l=>{o.push(`filtroTipoComprobante=${l}`)}),this.filtroRuc&&o.push(`filtroRuc=${this.filtroRuc}`),this.filtroSerie&&o.push(`filtroSerie=${this.filtroSerie}`),this.filtroNumero&&o.push(`filtroNumero=${this.filtroNumero}`),this.filtroPuntoVenta&&"PLATFORM"===this.filtroCanal&&o.push(`idPuntoVenta=${this.filtroPuntoVenta.id}`),this.filtroEstacionVenta&&"PLATFORM"===this.filtroCanal&&o.push(`idEstacionVenta=${this.filtroEstacionVenta.id}`),this.filtroMoneda&&o.push(`filtroMoneda=${this.filtroMoneda}`),this.filtroTipoVenta&&o.push(`filtroTipoVenta=${this.filtroTipoVenta}`),this.categoria&&o.push(`idCategoria=${this.categoria.id}`),this.filtroProducto&&o.push(`idProducto=${this.filtroProducto.id}`),this.filtroVendedor&&o.push(`idVendedor=${this.filtroVendedor}`),this.metodosPagoSelect.forEach(l=>o.push(`idMetodoPago=${l}`)),n.sortOrder&&o.push(`sortOrder=${n.sortOrder}`),n.sortField&&o.push(`sortField=${n.sortField}`),this.setUrlsExport(o),this.ticketService.findAllTicketDetailsPage(o.join("&")).subscribe(l=>{this.totalRecords=l.totalElements,this.ticketsDetails=l.content}),this.loadTotales(o,!1),this.loadTotales(o,!0),this.loadTotalesUtilidad(o)}loadTotales(n,t){this.currencyService.findAll().subscribe(o=>{const l=o.map(m=>{const v=[...n,`filtroMoneda=${m.codigoMoneda}`,`porDetalle=${t}`];return this.ticketService.totales(v.join("&")).pipe((0,_.UI)(y=>Object.assign(Object.assign({},y),y&&{totalCalculado:y.totalBoletas+y.totalFacturas+y.totalNotasVenta+y.totalNotasDebito-y.totalNotasCredito})))});(0,Z.D)(l).subscribe(m=>{t?this.totalesPorDetalle=m.filter(v=>v.codigoMoneda):this.totales=m.filter(v=>v.codigoMoneda)})})}loadTotalesUtilidad(n){this.currencyService.findAll().subscribe(t=>{const o=t.map(l=>{const m=[...n,`filtroMoneda=${l.codigoMoneda}`];return this.ticketService.totalesUtilidad(m.join("&")).pipe((0,_.UI)(v=>Object.assign(Object.assign({},v),v&&{totalCalculado:v.totalVentas-v.totalCompras})))});(0,Z.D)(o).subscribe(l=>{this.totalesUtilidad=l.filter(m=>m.codigoMoneda)})})}setUrlsExport(n){const t=this.loginService.getUser().empresa.uuid,o=`${b.N.endpointApi}/public/export-data/${t}/tickets-details`;this.actionsExportData=[{icon:"fa fa-file-excel-o",label:"Exportar a excel",url:`${o}.xlsx?${n.join("&")}`},{icon:"fa fa-file-pdf-o",label:"Exportar a pdf",url:`${o}.pdf?${n.join("&")}`}]}loadData(){this.puntosVenta=this.loginService.getPuntosVentaUsuario(),this.currencyService.findAll().pipe((0,_.UI)(n=>n.map(t=>({label:t.codigoMoneda,value:t.codigoMoneda})))).subscribe(n=>this.monedas=n),this.userService.findAll(null,!1).pipe((0,_.UI)(n=>n.map(t=>({label:`${t.nombres} ${t.apellidos}`,value:t.id})))).subscribe(n=>this.usuarios=n)}changePuntoVenta(){this.loadSaleStation(),this.resetAndRefreshTable()}loadSaleStation(){this.filtroEstacionVenta=void 0;const n=["paginacion=false"];this.filtroPuntoVenta&&n.push(`idPuntoVenta=${this.filtroPuntoVenta.id}`),this.saleStationService.findAll(n.join("&")).subscribe(t=>this.estacionesVenta=t)}loadPaymentsMethods(){this.configCompany&&(this.metodosPago=this.configCompany.formasPago.filter(n=>"EFECTIVO"===n.formaPago||"INGRESO"===n.tipoMovimiento).map(n=>({label:n.nombre,value:n.id})))}}S.\u0275fac=function(n){return new(n||S)(e.Y36(r.gz),e.Y36(r.F0),e.Y36(D.w),e.Y36(F.J),e.Y36($.i),e.Y36(E.r),e.Y36(R.uU),e.Y36(L.V),e.Y36(q.ez),e.Y36(g.B),e.Y36(g.B),e.Y36(s.yh),e.Y36(C.E),e.Y36(p.p),e.Y36(c.i),e.Y36(M.i),e.Y36(C.E),e.Y36(q.YP))},S.\u0275cmp=e.Xpm({type:S,selectors:[["app-reporte-ventas"]],viewQuery:function(n,t){if(1&n&&(e.Gf(de,5),e.Gf(ce,7)),2&n){let o;e.iGM(o=e.CRH())&&(t.fileUploadEmail=o.first),e.iGM(o=e.CRH())&&(t.tabla=o.first)}},decls:69,vars:55,consts:[[1,"grid"],[1,"col-12"],[1,"grid","p-fluid"],["class","col-6 md:col-2 lg:col-1",4,"ngIf"],[1,"col-6","md:col-2","lg:col-1"],[1,"label-form"],["name","filtroModoFecha",3,"options","ngModel","ngModelChange","onChange"],["class","col-6 md:col-3 lg:col-2",4,"ngIf"],[1,"col-6","md:col-3","lg:col-2"],["filter","true","placeholder","Seleccione vendedor",3,"showClear","ngModel","options","onChange","ngModelChange"],["defaultLabel","Seleccione tipo de comprobante",3,"options","ngModel","onChange","ngModelChange"],["name","numeroDocumento","type","text","pInputText","",2,"width","100%",3,"ngModel","input","ngModelChange"],["name","serie","type","text","pInputText","",2,"width","100%",3,"ngModel","input","ngModelChange"],["name","numero","type","text","pInputText","",2,"width","100%",3,"ngModel","input","ngModelChange"],["placeholder","Seleccione","name","moneda",3,"ngModel","options","showClear","onChange","ngModelChange"],["pTemplate","selectedItem"],["pTemplate","item"],["filter","true","placeholder","Seleccione tipo venta",3,"showClear","ngModel","options","onChange","ngModelChange"],[3,"ngModel","changeCategory","ngModelChange"],["placeholder","Producto",3,"ngModel","selectProduct","ngModelChange"],["defaultLabel","Seleccione metodo de pago","maxSelectedLabels","5",3,"options","ngModel","onChange","ngModelChange"],[1,"col-12","mb-0"],[4,"ngFor","ngForOf"],["dataKey","id",3,"value","lazy","paginator","rows","totalRecords","responsive","autoLayout","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","rowexpansion"],["pTemplate","body"],["pTemplate","summary"],["appendTo","body","header","Editar precio de compra de producto",3,"visible","modal","resizable","visibleChange"],["class","grid",4,"ngIf"],["dataKey","id","placeholder","Seleccione...","optionLabel","nombre","name","puntoVenta",3,"showClear","ngModel","options","onChange","ngModelChange"],["dataKey","id","placeholder","Seleccione...","optionLabel","nombre","name","estacionVenta",3,"ngModel","options","onChange","ngModelChange"],["name","fechaInicio","dateFormat","dd/mm/yy",3,"ngModel","showTime","locale","onSelect","ngModelChange"],["name","fechaFin","dateFormat","dd/mm/yy",3,"ngModel","showTime","locale","onSelect","ngModelChange"],[2,"vertical-align","middle"],["class","grid p-nogutter",4,"ngIf"],[1,"grid","p-nogutter"],[1,"col-fixed","pb-0",2,"width","300px"],[1,"m-0"],[1,"col","pb-0","flex","justify-content-end","flex-wrap"],["styleClass","ml-2","severity","info",3,"value"],["styleClass","ml-2","severity","danger",3,"value"],[2,"width","3em"],["pSortableColumn","producto"],["field","producto"],[1,"col"],[1,"mb-0"],[1,"mt-1"],["href","#",3,"pRowToggler"],[3,"ngClass"],[1,"p-column-title"],[4,"ngIf"],["class","product-not-exist","pTooltip","Producto no registrado",4,"ngIf"],[1,"pi","pi-pencil","cursor-pointer",3,"click"],["pTooltip","Producto no registrado",1,"product-not-exist"],[1,"flex","justify-content-between"],[3,"items"],[1,"col-12","md:col-2"],["for","pcu",1,"label-form"],[1,"col-12","md:col-4"],["pKeyFilter","num","type","text","id","pcu","pInputText","",2,"width","100%","margin-bottom","0.2em",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],[1,"col-12","flex","justify-content-center","flex-wrap"],["type","button","pButton","","label","Actualizar",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"p-card"),e.TgZ(1,"div",0),e.TgZ(2,"div",1),e.TgZ(3,"div",2),e.YNc(4,ue,4,6,"div",3),e.YNc(5,ge,4,5,"div",3),e.TgZ(6,"div",4),e.TgZ(7,"label",5),e._uU(8,"Por Fecha"),e.qZA(),e.TgZ(9,"p-selectButton",6),e.NdJ("ngModelChange",function(l){return t.modoFiltroRangoFechas=l})("onChange",function(){return t.changeModoFiltroRangoFechas()}),e.qZA(),e.qZA(),e.YNc(10,me,4,6,"div",7),e.YNc(11,he,4,6,"div",7),e.TgZ(12,"div",8),e.TgZ(13,"label",5),e._uU(14,"Vendedor"),e.qZA(),e.TgZ(15,"p-dropdown",9),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroVendedor=l}),e.qZA(),e.qZA(),e.TgZ(16,"div",4),e.TgZ(17,"label",5),e._uU(18,"Tipo"),e.qZA(),e.TgZ(19,"p-multiSelect",10),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroTipoComprobante=l}),e.qZA(),e.qZA(),e.TgZ(20,"div",8),e.TgZ(21,"label",5),e._uU(22,"Cliente"),e.qZA(),e.TgZ(23,"input",11),e.NdJ("input",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroRuc=l}),e.qZA(),e.qZA(),e.TgZ(24,"div",4),e.TgZ(25,"label",5),e._uU(26,"Serie"),e.qZA(),e.TgZ(27,"input",12),e.NdJ("input",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroSerie=l}),e.qZA(),e.qZA(),e.TgZ(28,"div",4),e.TgZ(29,"label",5),e._uU(30,"N\xfamero"),e.qZA(),e.TgZ(31,"input",13),e.NdJ("input",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroNumero=l}),e.qZA(),e.qZA(),e.TgZ(32,"div",4),e.TgZ(33,"label",5),e._uU(34,"Moneda"),e.qZA(),e.TgZ(35,"p-dropdown",14),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroMoneda=l}),e.YNc(36,_e,3,4,"ng-template",15),e.YNc(37,fe,2,4,"ng-template",16),e.qZA(),e.qZA(),e.TgZ(38,"div",4),e.TgZ(39,"label",5),e._uU(40,"Tipo venta"),e.qZA(),e.TgZ(41,"p-dropdown",17),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroTipoVenta=l}),e.qZA(),e.qZA(),e.TgZ(42,"div",8),e.TgZ(43,"label",5),e._uU(44,"Categor\xeda"),e.qZA(),e.TgZ(45,"app-selector-categoria",18),e.NdJ("changeCategory",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.categoria=l}),e.qZA(),e.qZA(),e.TgZ(46,"div",8),e.TgZ(47,"label",5),e._uU(48,"Producto"),e.qZA(),e.TgZ(49,"app-producto-autocomplete",19),e.NdJ("selectProduct",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroProducto=l}),e.qZA(),e.qZA(),e.TgZ(50,"div",8),e.TgZ(51,"label",5),e._uU(52,"Metodo de pago"),e.qZA(),e.TgZ(53,"p-multiSelect",20),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.metodosPagoSelect=l}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(54,"div",21),e.YNc(55,Te,2,1,"ng-container",22),e.qZA(),e.TgZ(56,"div",21),e.YNc(57,Ae,2,1,"ng-container",22),e.qZA(),e.TgZ(58,"div",1),e.YNc(59,Me,2,1,"ng-container",22),e.qZA(),e.TgZ(60,"div",1),e.TgZ(61,"p-table",23,24),e.NdJ("onLazyLoad",function(l){return t.loadLazy(l)}),e.YNc(63,be,25,0,"ng-template",25),e.YNc(64,ye,27,5,"ng-template",26),e.YNc(65,Se,54,22,"ng-template",27),e.YNc(66,qe,7,2,"ng-template",28),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(67,"p-dialog",29),e.NdJ("visibleChange",function(l){return t.visibleEditPurchaseProductPrice=l}),e.YNc(68,Ve,16,3,"div",30),e.qZA()),2&n&&(e.xp6(4),e.Q6J("ngIf","PLATFORM"===t.filtroCanal),e.xp6(1),e.Q6J("ngIf","PLATFORM"===t.filtroCanal),e.xp6(4),e.Q6J("options",e.WLB(48,Ee,e.DdM(46,xe),e.DdM(47,De)))("ngModel",t.modoFiltroRangoFechas),e.xp6(1),e.Q6J("ngIf",t.modoFiltroRangoFechas),e.xp6(1),e.Q6J("ngIf",t.modoFiltroRangoFechas),e.xp6(4),e.Akn(e.DdM(51,V)),e.Q6J("showClear",!0)("ngModel",t.filtroVendedor)("options",t.usuarios),e.xp6(4),e.Q6J("options",t.tiposComprobantes)("ngModel",t.filtroTipoComprobante),e.xp6(4),e.Q6J("ngModel",t.filtroRuc),e.xp6(4),e.Q6J("ngModel",t.filtroSerie),e.xp6(4),e.Q6J("ngModel",t.filtroNumero),e.xp6(4),e.Akn(e.DdM(52,V)),e.Q6J("ngModel",t.filtroMoneda)("options",t.monedas)("showClear",!0),e.xp6(6),e.Akn(e.DdM(53,V)),e.Q6J("showClear",!0)("ngModel",t.filtroTipoVenta)("options",t.listas.tiposVenta),e.xp6(4),e.Q6J("ngModel",t.categoria),e.xp6(4),e.Q6J("ngModel",t.filtroProducto),e.xp6(4),e.Q6J("options",t.metodosPago)("ngModel",t.metodosPagoSelect),e.xp6(2),e.Q6J("ngForOf",t.totales),e.xp6(2),e.Q6J("ngForOf",t.totalesPorDetalle),e.xp6(2),e.Q6J("ngForOf",t.totalesUtilidad),e.xp6(2),e.Q6J("value",t.ticketsDetails)("lazy",!0)("paginator",!0)("rows",t.perPage)("totalRecords",t.totalRecords)("responsive",!0)("autoLayout",!0),e.xp6(6),e.Akn(e.DdM(54,Oe)),e.Q6J("visible",t.visibleEditPurchaseProductPrice)("modal",!0)("resizable",!1),e.xp6(1),e.Q6J("ngIf",t.edicionPrecioCompraUnitario))},directives:[U.Z,R.O5,k.Lt,O.JJ,O.On,ee.UN,G.f,K.NU,O.Fj,te.o,q.jx,oe.U,ne.P,R.sg,ie.V,N.iA,N.lQ,N.fz,N.jB,R.mk,ae.u,z.h,le.V,re.Fr,se.Ql,pe.Hq],pipes:[W.s,X.Z,g.B],styles:[".product-not-exist[_ngcontent-%COMP%]{color:#c91d1d;text-decoration:line-through}"]}),(0,h.gn)([(0,s.Ph)(T.Z.getOffice)],S.prototype,"puntoVenta$",void 0),(0,h.gn)([(0,s.Ph)(T.Z.getSaleStation)],S.prototype,"estacionVenta$",void 0),(0,h.gn)([(0,s.Ph)(T.Z.getConfig)],S.prototype,"configCompany$",void 0);var Ne=a(80581),Je=a(77966);const Fe=["dt"];function Le(i,n){if(1&i&&(e.TgZ(0,"span",22),e._uU(1),e.ALo(2,"moneda"),e.qZA()),2&i){const t=n.$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,t.label,"moneda"))}}function $e(i,n){1&i&&(e._uU(0),e.ALo(1,"moneda")),2&i&&e.hij(" ",e.xi3(1,1,n.$implicit.label,"moneda")," ")}function Ie(i,n){if(1&i&&(e.TgZ(0,"div",1),e.TgZ(1,"p-card"),e.TgZ(2,"div",23),e.TgZ(3,"div",24),e.TgZ(4,"h2",25),e._uU(5),e.ALo(6,"montoDinero"),e.qZA(),e.qZA(),e.TgZ(7,"div",26),e.TgZ(8,"div",27),e.TgZ(9,"div",28),e.TgZ(10,"h4",29),e._uU(11),e.ALo(12,"montoDinero"),e.qZA(),e.qZA(),e.TgZ(13,"div",28),e.TgZ(14,"h4",29),e._uU(15),e.ALo(16,"montoDinero"),e.qZA(),e.qZA(),e.TgZ(17,"div",28),e.TgZ(18,"h4",30),e._uU(19),e.ALo(20,"montoDinero"),e.qZA(),e.qZA(),e.TgZ(21,"div",28),e.TgZ(22,"h4",30),e._uU(23),e.ALo(24,"montoDinero"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&i){const t=n.$implicit;e.xp6(5),e.hij("Ingr. - Egre.: ",e.xi3(6,5,t.totalIngresosVsEgresos,t.codigoMoneda),""),e.xp6(6),e.hij("Ventas: ",e.xi3(12,8,t.totalVentas,t.codigoMoneda),""),e.xp6(4),e.hij("Otros ingresos: ",e.xi3(16,11,t.totalOtrosIngresos,t.codigoMoneda),""),e.xp6(4),e.hij("Compras: ",e.xi3(20,14,t.totalCompras,t.codigoMoneda),""),e.xp6(4),e.hij("Otros egresos: ",e.xi3(24,17,t.totalOtrosEgresos,t.codigoMoneda),"")}}function we(i,n){1&i&&(e.TgZ(0,"tr"),e.TgZ(1,"th"),e._uU(2,"Punto venta"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Estaci\xf3n"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Fecha"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Tipo movimiento"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Concepto"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Descripci\xf3n"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Moneda"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Monto"),e.qZA(),e.qZA())}function Ye(i,n){if(1&i&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e.TgZ(2,"span",31),e._uU(3,"Punto venta"),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.qZA(),e.qZA(),e.TgZ(6,"td"),e.TgZ(7,"span",31),e._uU(8,"Estaci\xf3n"),e.qZA(),e.TgZ(9,"span"),e._uU(10),e.qZA(),e.qZA(),e.TgZ(11,"td"),e.TgZ(12,"span",31),e._uU(13,"Fecha"),e.qZA(),e.TgZ(14,"span"),e._uU(15),e.ALo(16,"date"),e.qZA(),e.qZA(),e.TgZ(17,"td"),e.TgZ(18,"span",31),e._uU(19,"Tipo"),e.qZA(),e.TgZ(20,"span"),e._uU(21),e.qZA(),e.qZA(),e.TgZ(22,"td"),e.TgZ(23,"span",31),e._uU(24,"Concepto"),e.qZA(),e.TgZ(25,"span"),e._uU(26),e.ALo(27,"conceptoMovimiento"),e.qZA(),e.qZA(),e.TgZ(28,"td"),e.TgZ(29,"span",31),e._uU(30,"Descripci\xf3n"),e.qZA(),e.TgZ(31,"span"),e._uU(32),e.qZA(),e.qZA(),e.TgZ(33,"td"),e.TgZ(34,"span",31),e._uU(35,"Moneda"),e.qZA(),e.TgZ(36,"span"),e._uU(37),e.qZA(),e.qZA(),e.TgZ(38,"td"),e.TgZ(39,"span",31),e._uU(40,"Monto"),e.qZA(),e.TgZ(41,"span"),e._uU(42),e.ALo(43,"montoDinero"),e.qZA(),e.qZA(),e.qZA()),2&i){const t=n.$implicit;e.xp6(5),e.Oqu(null==t||null==t.cashRegister||null==t.cashRegister.puntoVenta?null:t.cashRegister.puntoVenta.nombre),e.xp6(5),e.Oqu(null==t||null==t.cashRegister||null==t.cashRegister.estacionVenta?null:t.cashRegister.estacionVenta.nombre),e.xp6(5),e.Oqu(e.xi3(16,8,null==t?null:t.fechaMovimiento,"dd/MM/yyyy hh:mm a")),e.xp6(6),e.Oqu(null==t?null:t.tipoMovimientoCaja),e.xp6(5),e.Oqu(e.lcZ(27,11,null==t?null:t.conceptoMovimientoCaja)),e.xp6(6),e.Oqu(null==t?null:t.descripcion),e.xp6(5),e.Oqu(null==t?null:t.monedaMovimientoCaja),e.xp6(5),e.Oqu(e.xi3(43,13,null==t?null:t.monto,null==t?null:t.monedaMovimientoCaja))}}function Qe(i,n){if(1&i&&(e.TgZ(0,"div",32),e.TgZ(1,"div"),e._UZ(2,"app-actions",33),e.qZA(),e.TgZ(3,"div"),e.TgZ(4,"b"),e._uU(5,"Resultados:"),e.qZA(),e._uU(6),e.qZA(),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("items",t.actionsExportData),e.xp6(4),e.hij(" ",t.totalRecords," ")}}const J=function(){return{width:"100%"}};class x{constructor(n,t,o,l,m,v,y,I,w,Y,Q,j,B,H){this.route=n,this.router=t,this.ticketService=o,this.companyService=l,this.datePipe=m,this.messageService=v,this.store=y,this.ls=I,this.breadcrumbService=w,this.currencyService=Y,this.saleStationService=Q,this.cashRegisterService=j,this.loginService=B,this.listas=H,this.unsubscribe$=new d.xQ,this.cashRegisterDetails=[],this.puntosVenta=[],this.estacionesVenta=[],this.monedas=[],this.perPage=10,this.tipos=[],this.tiposSelected=[],this.conceptos=[],this.conceptosSelected=[],this.totales=[]}ngOnInit(){this.breadcrumbService.setItems((0,u.kn)(this.route)),this.tipos=[{label:"Ingreso",value:"INGRESO"},{label:"Egreso",value:"EGRESO"}],this.conceptos=[{label:"Ventas",value:"VENTAS"},{label:"Otros ingresos",value:"OTROS_INGRESOS"},{label:"Compras",value:"COMPRAS"},{label:"Otros egresos",value:"OTROS_EGRESOS"}],this.tipos.forEach(n=>this.tiposSelected.push(n.value)),this.conceptos.forEach(n=>this.conceptosSelected.push(n.value)),this.setFechasDefault(),this.loadData(),this.validarPuntoVenta(),this.loadSaleStation()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}setFechasDefault(){const n=new Date;this.filtroDesde=new Date(n.getFullYear(),n.getMonth(),1),this.filtroHasta=new Date(n.getFullYear(),n.getMonth()+1,0)}changePuntoVenta(){this.loadSaleStation(),this.resetAndRefreshTable()}resetAndRefreshTable(){this.tabla.clear()}loadSaleStation(){this.estacionVenta=void 0;const n=["paginacion=false"];this.puntoVenta&&n.push(`idPuntoVenta=${this.puntoVenta.id}`),this.saleStationService.findAll(n.join("&")).subscribe(t=>this.estacionesVenta=t)}validarPuntoVenta(){this.puntoVenta$.pipe((0,_.Rs)(this.unsubscribe$)).subscribe(n=>{this.puntoVenta=n,this.resetAndRefreshTable()})}loadData(){this.puntosVenta=this.loginService.getPuntosVentaUsuario(),this.currencyService.findAll().pipe((0,_.UI)(n=>n.map(t=>({label:t.codigoMoneda,value:t.codigoMoneda})))).subscribe(n=>this.monedas=n)}loadLazy(n){const o=["pageNumber="+n.first/this.perPage,`perPage=${n.rows}`];this.filtroDesde&&o.push(`filtroDesde=${this.datePipe.transform(this.filtroDesde,"dd-MM-yyyy")}`),this.filtroHasta&&o.push(`filtroHasta=${this.datePipe.transform(this.filtroHasta,"dd-MM-yyyy")}`),this.puntoVenta&&o.push(`idPuntoVenta=${this.puntoVenta.id}`),this.estacionVenta&&o.push(`idEstacionVenta=${this.estacionVenta.id}`),this.filtroMoneda&&o.push(`moneda=${this.filtroMoneda}`),this.tiposSelected.forEach(l=>o.push(`tipo=${l}`)),this.conceptosSelected.forEach(l=>o.push(`concepto=${l}`)),n.sortOrder&&o.push(`sortOrder=${n.sortOrder}`),n.sortField&&o.push(`sortField=${n.sortField}`),this.setUrlsExport(o),this.cashRegisterService.findAllDetailsPage(o.join("&")).subscribe(l=>{this.totalRecords=l.totalElements,this.cashRegisterDetails=l.content}),this.loadTotales(o)}loadTotales(n){this.currencyService.findAll().subscribe(t=>{const o=t.map(l=>{const m=[...n,`moneda=${l.codigoMoneda}`];return this.cashRegisterService.totales(m.join("&")).pipe((0,_.UI)(v=>Object.assign(Object.assign({},v),{totalIngresosVsEgresos:v.totalIngresos+v.totalEgresos})))});(0,Z.D)(o).subscribe(l=>{this.totales=l.filter(m=>m.codigoMoneda)})})}setUrlsExport(n){const t=this.loginService.getUser().empresa.uuid,o=`${b.N.endpointApi}/public/export-data/${t}/cash-register-detail`;this.actionsExportData=[{icon:"fa fa-file-excel-o",label:"Exportar a excel",url:`${o}.xlsx?${n.join("&")}`},{icon:"fa fa-file-pdf-o",label:"Exportar a pdf",url:`${o}.pdf?${n.join("&")}`}]}}x.\u0275fac=function(n){return new(n||x)(e.Y36(r.gz),e.Y36(r.F0),e.Y36(D.w),e.Y36(F.J),e.Y36(R.uU),e.Y36(q.ez),e.Y36(s.yh),e.Y36(C.E),e.Y36(p.p),e.Y36(c.i),e.Y36(M.i),e.Y36(Ne.B),e.Y36(E.r),e.Y36(C.E))},x.\u0275cmp=e.Xpm({type:x,selectors:[["app-reporte-movimientos"]],viewQuery:function(n,t){if(1&n&&e.Gf(Fe,7),2&n){let o;e.iGM(o=e.CRH())&&(t.tabla=o.first)}},decls:41,vars:40,consts:[[1,"grid"],[1,"col-12"],[1,"grid","p-fluid"],[1,"col-6","md:col-2","lg:col-1"],[1,"label-form"],["dataKey","id","placeholder","Seleccione...","optionLabel","nombre","name","puntoVenta",3,"showClear","ngModel","options","onChange","ngModelChange"],["dataKey","id","placeholder","Seleccione...","optionLabel","nombre","name","estacionVenta",3,"showClear","ngModel","options","onChange","ngModelChange"],[1,"col-6","md:col-3","lg:col-2"],["name","fechaInicio","dateFormat","dd/mm/yy",3,"ngModel","locale","onSelect","ngModelChange"],["name","fechaFin","dateFormat","dd/mm/yy",3,"ngModel","locale","onSelect","ngModelChange"],["placeholder","Seleccione","name","moneda",3,"ngModel","options","showClear","onChange","ngModelChange"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"col-6","md:col-4","lg:col-2"],["defaultLabel","Seleccione tipo","selectedItemsLabel","{0} items",3,"options","ngModel","onChange","ngModelChange"],["maxSelectedLabels","5","defaultLabel","Seleccione concepto","selectedItemsLabel","{0} items",3,"options","ngModel","onChange","ngModelChange"],["class","col-12",4,"ngFor","ngForOf"],["dataKey","id",3,"value","lazy","paginator","rows","totalRecords","responsive","autoLayout","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[2,"vertical-align","middle"],[1,"grid","p-nogutter"],[1,"col-fixed",2,"width","300px"],[1,"m-0"],[1,"col"],[1,"grid","p-nogutter","p-jc-end"],[1,"col-fixed"],[1,"mt-2","mb-2","ml-4","mr-4",2,"color","#1c7430"],[1,"mt-2","mb-2","ml-4","mr-4",2,"color","#9c4a52"],[1,"p-column-title"],[1,"flex","justify-content-between"],[3,"items"]],template:function(n,t){1&n&&(e.TgZ(0,"p-card"),e.TgZ(1,"div",0),e.TgZ(2,"div",1),e.TgZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"label",4),e._uU(6,"Punto de venta"),e.qZA(),e.TgZ(7,"p-dropdown",5),e.NdJ("onChange",function(){return t.changePuntoVenta()})("ngModelChange",function(l){return t.puntoVenta=l}),e.qZA(),e.qZA(),e.TgZ(8,"div",3),e.TgZ(9,"label",4),e._uU(10,"Estaci\xf3n"),e.qZA(),e.TgZ(11,"p-dropdown",6),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.estacionVenta=l}),e.qZA(),e.qZA(),e.TgZ(12,"div",7),e.TgZ(13,"label",4),e._uU(14,"Desde"),e.qZA(),e.TgZ(15,"p-calendar",8),e.NdJ("onSelect",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroDesde=l}),e.qZA(),e.qZA(),e.TgZ(16,"div",7),e.TgZ(17,"label",4),e._uU(18,"Hasta"),e.qZA(),e.TgZ(19,"p-calendar",9),e.NdJ("onSelect",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroHasta=l}),e.qZA(),e.qZA(),e.TgZ(20,"div",3),e.TgZ(21,"label",4),e._uU(22,"Moneda"),e.qZA(),e.TgZ(23,"p-dropdown",10),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.filtroMoneda=l}),e.YNc(24,Le,3,4,"ng-template",11),e.YNc(25,$e,2,4,"ng-template",12),e.qZA(),e.qZA(),e.TgZ(26,"div",13),e.TgZ(27,"label",4),e._uU(28,"Tipo"),e.qZA(),e.TgZ(29,"p-multiSelect",14),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.tiposSelected=l}),e.qZA(),e.qZA(),e.TgZ(30,"div",13),e.TgZ(31,"label",4),e._uU(32,"Concepto"),e.qZA(),e.TgZ(33,"p-multiSelect",15),e.NdJ("onChange",function(){return t.resetAndRefreshTable()})("ngModelChange",function(l){return t.conceptosSelected=l}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(34,Ie,25,20,"div",16),e.TgZ(35,"div",1),e.TgZ(36,"p-table",17,18),e.NdJ("onLazyLoad",function(l){return t.loadLazy(l)}),e.YNc(38,we,17,0,"ng-template",19),e.YNc(39,Ye,44,16,"ng-template",20),e.YNc(40,Qe,7,2,"ng-template",21),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(7),e.Akn(e.DdM(35,J)),e.Q6J("showClear",!0)("ngModel",t.puntoVenta)("options",t.puntosVenta),e.xp6(4),e.Akn(e.DdM(36,J)),e.Q6J("showClear",!0)("ngModel",t.estacionVenta)("options",t.estacionesVenta),e.xp6(4),e.Akn(e.DdM(37,J)),e.Q6J("ngModel",t.filtroDesde)("locale",t.ls.calendarEs),e.xp6(4),e.Akn(e.DdM(38,J)),e.Q6J("ngModel",t.filtroHasta)("locale",t.ls.calendarEs),e.xp6(4),e.Akn(e.DdM(39,J)),e.Q6J("ngModel",t.filtroMoneda)("options",t.monedas)("showClear",!0),e.xp6(6),e.Q6J("options",t.tipos)("ngModel",t.tiposSelected),e.xp6(4),e.Q6J("options",t.conceptos)("ngModel",t.conceptosSelected),e.xp6(1),e.Q6J("ngForOf",t.totales),e.xp6(2),e.Q6J("value",t.cashRegisterDetails)("lazy",!0)("paginator",!0)("rows",t.perPage)("totalRecords",t.totalRecords)("responsive",!0)("autoLayout",!0))},directives:[U.Z,k.Lt,O.JJ,O.On,G.f,q.jx,K.NU,R.sg,N.iA,z.h],pipes:[W.s,X.Z,R.uU,Je.x],styles:[""]}),(0,h.gn)([(0,s.Ph)(T.Z.getOffice)],x.prototype,"puntoVenta$",void 0),(0,h.gn)([(0,s.Ph)(T.Z.getSaleStation)],x.prototype,"estacionVenta$",void 0);const je=[{path:"reporte-ventas",component:S,canActivate:[f.P],data:{breadcrumb:[{label:"Reportes"},{label:"Reporte de ventas"}]}},{path:"reporte-movimientos",component:x,canActivate:[f.P],data:{breadcrumb:[{label:"Reportes"},{label:"Reporte de movimientos"}]}}];let Be=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[r.Bz.forChild(je)],r.Bz]}),i})();var He=a(20958),ke=a(19406),Ge=a(45330),Ke=a(21767);let ze=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Ge.xA],imports:[[Be,He.m,Ke.Z,ke.P]]}),i})()},65987:(P,A,a)=>{a.d(A,{H:()=>h});var r=a(63191),f=a(5e3);let h=(()=>{class d{constructor(){this._isReadonly=!1}set appReadonly(s){this._isReadonly=(0,r.Ig)(s)}}return d.\u0275fac=function(s){return new(s||d)},d.\u0275dir=f.lG2({type:d,selectors:[["","readonly",""],["","readOnly",""]],inputs:{appReadonly:"appReadonly"}}),d})()},77966:(P,A,a)=>{a.d(A,{x:()=>f});var r=a(5e3);let f=(()=>{class h{transform(Z,s){switch(Z){case"APERTURA_CAJA":return"Apertura de caja";case"VENTAS":return"Ventas contado";case"OTROS_INGRESOS":return"Otros ingresos";case"COMPRAS":return"Compras contado";case"OTROS_EGRESOS":return"Otros egresos";case"RETIRO_CAJA":return"Retiros de caja";default:return""}}}return h.\u0275fac=function(Z){return new(Z||h)},h.\u0275pipe=r.Yjl({name:"conceptoMovimiento",type:h,pure:!0}),h})()},77121:(P,A,a)=>{a.d(A,{Z:()=>h});var r=a(80267),f=a(5e3);let h=(()=>{class d{transform(s,T,u){s||(s=0),u?!u&&u>4&&(u=4):u=2;const _=r.Z.find(e=>e.codigoMoneda===T);return`${_?_.simbolo:"Desc."} ${parseFloat(s).toFixed(u)}`}}return d.\u0275fac=function(s){return new(s||d)},d.\u0275pipe=f.Yjl({name:"montoDinero",type:d,pure:!0}),d})()}}]);