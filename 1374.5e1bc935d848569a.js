"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[1374],{51420:(N,x,i)=>{i.d(x,{Z:()=>u});var _=i(82817),l=i(5e3),Z=i(45330),h=i(96039),f=i(69808),j=i(40845);function A(T,o){if(1&T){const e=l.EpF();l.TgZ(0,"div",3),l.TgZ(1,"div",0),l.TgZ(2,"div",3),l._UZ(3,"a",4),l.TgZ(4,"button",5),l.NdJ("click",function(){const I=l.CHM(e).$implicit;return l.oxw().print(I)}),l.qZA(),l.qZA(),l.TgZ(5,"div",3),l._UZ(6,"iframe",6),l.qZA(),l.qZA(),l.qZA()}if(2&T){const e=o.$implicit,C=l.oxw();l.xp6(3),l.Q6J("href",null==e.pdfPrint?null:e.pdfPrint.urlSafe,l.LSH),l.xp6(3),l.Q6J("src",C.isMobileDevice?null==e.pdfPrint?null:e.pdfPrint.urlViewer:null==e.pdfPrint?null:e.pdfPrint.urlSafe,l.uOi)}}function E(T,o){if(1&T){const e=l.EpF();l.TgZ(0,"button",9),l.NdJ("click",function(){return l.CHM(e).$implicit.method()}),l.qZA()}if(2&T){const e=o.$implicit;l.Q6J("icon",e.icon)("label",e.name)}}function b(T,o){if(1&T&&(l.TgZ(0,"div",3),l.TgZ(1,"div",7),l.YNc(2,E,1,2,"button",8),l.qZA(),l.qZA()),2&T){const e=l.oxw();l.xp6(2),l.Q6J("ngForOf",e.actions)}}let u=(()=>{class T{constructor(e,C){this.config=e,this.qzTrayService=C,this.statusQz=!1}ngOnInit(){this.ordersPrint=this.config.data.ordersPrint,this.actions=this.config.data.actions}get isMobileDevice(){return(0,_.s2)()}ngAfterViewInit(){this.statusQz=this.qzTrayService.getStatus()}print(e){this.statusQz&&e.fnPrintQz?e.fnPrintQz():(0,_.TW)(e.pdfPrint.url)}}return T.\u0275fac=function(e){return new(e||T)(l.Y36(Z.S),l.Y36(h.k))},T.\u0275cmp=l.Xpm({type:T,selectors:[["app-modal-pdf"]],decls:3,vars:2,consts:[[1,"grid"],["class","col-12",4,"ngFor","ngForOf"],["class","col-12",4,"ngIf"],[1,"col-12"],["target","_blank","pButton","","icon","pi pi-clone","label","Abrir en navegador",1,"p-button-sm","mr-2",3,"href"],["pButton","","icon","pi pi-print","label","Imprimir",1,"p-button-sm","mr-2",3,"click"],["name","PDF.pdf","title","MyPdf","id","pdftoprint","type","application/pdf","width","100%","height","400px",3,"src"],[1,"flex","justify-content-end"],["class","p-button-sm mr-2 p-button-success m-1","pButton","",3,"icon","label","click",4,"ngFor","ngForOf"],["pButton","",1,"p-button-sm","mr-2","p-button-success","m-1",3,"icon","label","click"]],template:function(e,C){1&e&&(l.TgZ(0,"div",0),l.YNc(1,A,7,2,"div",1),l.YNc(2,b,3,1,"div",2),l.qZA()),2&e&&(l.xp6(1),l.Q6J("ngForOf",C.ordersPrint),l.xp6(1),l.Q6J("ngIf",C.actions))},directives:[f.sg,j.Hq,f.O5],styles:[""]}),T})()},89400:(N,x,i)=>{i.d(x,{z:()=>Z});var _=i(20958),l=i(5e3);let Z=(()=>{class h{}return h.\u0275fac=function(j){return new(j||h)},h.\u0275mod=l.oAB({type:h}),h.\u0275inj=l.cJS({imports:[[_.m]]}),h})()},91374:(N,x,i)=>{i.r(x),i.d(x,{CajaModule:()=>ve});var _=i(74202),l=i(54578),Z=i(53279),h=i(70655),f=i(82817),j=i(85932),A=i(81575),E=i(8929),b=i(7625),u=i(39428),T=i(92340),o=i(5e3),e=i(69808),C=i(59783),J=i(2314),I=i(80581),D=i(20207),L=i(33379),R=i(24394),P=i(45330),$=i(47745),Y=i(74297),q=i(93075),K=i(75652),Q=i(14036),V=i(98952),G=i(5766),W=i(4119),X=i(80267);const ee=["dt"];function te(c,d){if(1&c&&(o.TgZ(0,"th"),o._uU(1),o.qZA()),2&c){const r=d.$implicit;o.xp6(1),o.hij(" ",r.header," ")}}function oe(c,d){if(1&c&&(o.TgZ(0,"tr"),o.YNc(1,te,2,1,"th",15),o.qZA()),2&c){const r=d.$implicit;o.xp6(1),o.Q6J("ngForOf",r)}}function ne(c,d){if(1&c&&(o.TgZ(0,"span",16),o._UZ(1,"app-actions",17),o.qZA()),2&c){const r=o.oxw();o.xp6(1),o.Q6J("items",r.actionsExportData)}}function ae(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Punto de Venta"),o.qZA(),o._uU(3),o.BQk()),2&c){const r=o.oxw(3).$implicit;o.xp6(3),o.hij(" ",null==r.puntoVenta?null:r.puntoVenta.nombre," ")}}function M(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Estaci\xf3n Venta"),o.qZA(),o._uU(3),o.BQk()),2&c){const r=o.oxw(3).$implicit;o.xp6(3),o.hij(" ",null==r.estacionVenta?null:r.estacionVenta.nombre," ")}}function ie(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Estado"),o.qZA(),o.TgZ(3,"span",25),o._uU(4),o.qZA(),o.BQk()),2&c){const r=o.oxw(3).$implicit;o.xp6(3),o.Q6J("ngClass","APERTURADA"===r.estadoCaja?"status-proposal":"status-info"),o.xp6(1),o.hij(" ",r.estadoCaja,"")}}function B(c,d){if(1&c&&(o.TgZ(0,"span",16),o.TgZ(1,"span",27),o._uU(2),o.ALo(3,"moneda"),o.qZA(),o.qZA()),2&c){const r=d.$implicit;o.xp6(2),o.AsE("",o.lcZ(3,2,r.moneda)," ",r.monto,"")}}function H(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Total ingreso"),o.qZA(),o.YNc(3,B,4,4,"span",26),o.BQk()),2&c){const r=o.oxw(3).$implicit;o.xp6(3),o.Q6J("ngForOf",r.montosTotalesIngresos)}}function se(c,d){if(1&c&&(o.TgZ(0,"span",16),o.TgZ(1,"span",27),o._uU(2),o.ALo(3,"moneda"),o.qZA(),o.qZA()),2&c){const r=d.$implicit;o.xp6(2),o.AsE("",o.lcZ(3,2,r.moneda)," ",r.monto,"")}}function re(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Total egreso"),o.qZA(),o.YNc(3,se,4,4,"span",26),o.BQk()),2&c){const r=o.oxw(3).$implicit;o.xp6(3),o.Q6J("ngForOf",r.montosTotalesEgresos)}}function z(c,d){if(1&c&&(o.TgZ(0,"span",16),o.TgZ(1,"span",27),o._uU(2),o.ALo(3,"moneda"),o.qZA(),o.qZA()),2&c){const r=d.$implicit;o.xp6(2),o.AsE("",o.lcZ(3,2,r.moneda)," ",r.monto,"")}}function ce(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Monto caja"),o.qZA(),o.YNc(3,z,4,4,"span",26),o.BQk()),2&c){const r=o.oxw(3).$implicit,g=o.oxw();o.xp6(3),o.Q6J("ngForOf",g.getMontosCaja(r))}}function le(c,d){if(1&c&&(o.TgZ(0,"span",16),o.TgZ(1,"span",28),o._uU(2),o.ALo(3,"moneda"),o.qZA(),o.qZA()),2&c){const r=d.$implicit;o.xp6(1),o.Q6J("ngClass","MONTO_IGUAL"===r.condicion?"status-success":"MONTO_MAYOR"===r.condicion?"status-warning":"status-danger"),o.xp6(1),o.AsE("",o.lcZ(3,3,r.moneda)," ",r.monto,"")}}function pe(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Monto real"),o.qZA(),o.YNc(3,le,4,5,"span",26),o.BQk()),2&c){const r=o.oxw(3).$implicit,g=o.oxw();o.xp6(3),o.Q6J("ngForOf",g.getMontosRealesCaja(r))}}function de(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Fecha"),o.qZA(),o._uU(3),o.ALo(4,"date"),o.BQk()),2&c){const r=o.oxw(3).$implicit,g=o.oxw();o.xp6(3),o.hij(" ",o.xi3(4,1,g.buildDate(r.fecha),"dd/MM/yyyy")," ")}}function y(c,d){if(1&c&&(o.ynx(0),o.TgZ(1,"span",24),o._uU(2,"Usuario"),o.qZA(),o._uU(3),o.BQk()),2&c){const r=o.oxw(3).$implicit;o.xp6(3),o.hij(" ",null==r.usuario?null:r.usuario.nombreCompleto," ")}}function ge(c,d){if(1&c&&(o.ynx(0),o._uU(1),o.BQk()),2&c){const r=o.oxw(2).$implicit,g=o.oxw().$implicit;o.xp6(1),o.hij(" ",g[r.field]," ")}}function S(c,d){1&c&&(o.ynx(0),o.YNc(1,ae,4,1,"ng-container",22),o.YNc(2,M,4,1,"ng-container",22),o.YNc(3,ie,5,2,"ng-container",22),o.YNc(4,H,4,1,"ng-container",22),o.YNc(5,re,4,1,"ng-container",22),o.YNc(6,ce,4,1,"ng-container",22),o.YNc(7,pe,4,1,"ng-container",22),o.YNc(8,de,5,4,"ng-container",22),o.YNc(9,y,4,1,"ng-container",22),o.YNc(10,ge,2,1,"ng-container",23),o.BQk()),2&c&&(o.xp6(1),o.Q6J("ngSwitchCase","puntoVenta"),o.xp6(1),o.Q6J("ngSwitchCase","estacionVenta"),o.xp6(1),o.Q6J("ngSwitchCase","estadoCaja"),o.xp6(1),o.Q6J("ngSwitchCase","montoIngresos"),o.xp6(1),o.Q6J("ngSwitchCase","montoEgresos"),o.xp6(1),o.Q6J("ngSwitchCase","montoCaja"),o.xp6(1),o.Q6J("ngSwitchCase","montoReal"),o.xp6(1),o.Q6J("ngSwitchCase","fecha"),o.xp6(1),o.Q6J("ngSwitchCase","usuario"))}function me(c,d){if(1&c){const r=o.EpF();o.ynx(0,29),o.TgZ(1,"span",24),o._uU(2,"Acciones"),o.qZA(),o.TgZ(3,"span",30),o.NdJ("click",function(){o.CHM(r);const v=o.oxw(2).$implicit;return o.oxw().openModaCashRegister(v)}),o.qZA(),o.BQk()}}function _e(c,d){if(1&c&&(o.TgZ(0,"td",19),o.YNc(1,S,11,9,"ng-container",20),o.YNc(2,me,4,0,"ng-container",21),o.qZA()),2&c){const r=d.$implicit;o.Q6J("ngSwitch",r.field),o.xp6(1),o.Q6J("ngIf",!r.isActions),o.xp6(1),o.Q6J("ngIf",r.isActions)}}function ue(c,d){if(1&c&&(o.TgZ(0,"tr"),o.YNc(1,_e,3,3,"td",18),o.qZA()),2&c){const r=d.columns;o.xp6(1),o.Q6J("ngForOf",r)}}const w=function(){return{width:"100%"}};class U{constructor(d,r,g,v,k,Ae,xe,je,be,Re,Me,Ee){this.route=d,this.router=r,this.datePipe=g,this.messageService=v,this.tdPipe=k,this.confirmationService=Ae,this.cashRegisterService=xe,this.loginService=je,this.userService=be,this.ls=Re,this.dialogService=Me,this.breadcrumbService=Ee,this.unsubscribe$=new E.xQ,this.cashRegisters=[],this.perPage=10,this.puntosVenta=[]}ngOnInit(){this.breadcrumbService.setItems((0,f.kn)(this.route)),this.validarPuntoVenta(),this.puntosVenta=this.loginService.getPuntosVentaUsuario();const d=new Date;this.filtroDesde=new Date(d.getFullYear(),d.getMonth(),1),this.filtroHasta=new Date(d.getFullYear(),d.getMonth()+1,0),this.cols=[{field:"puntoVenta",header:"Punto de venta"},{field:"estacionVenta",header:"Estaci\xf3n"},{field:"turno",header:"Turno"},{field:"fecha",header:"Fecha"},{field:"estadoCaja",header:"Estado"},{field:"montoIngresos",header:"Total Ingresos"},{field:"montoEgresos",header:"Total Egresos"},{field:"montoCaja",header:"Efectivo"},{field:"montoReal",header:"Efectivo cierre"},{field:"acciones",header:"Acciones",isActions:!0}]}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}validarPuntoVenta(){this.puntoVenta$.pipe((0,b.R)(this.unsubscribe$)).subscribe(d=>{this.filtroPuntoVenta=d,this.resetAndRefreshTable()})}resetAndRefreshTable(){this.tabla.reset(),this.refreshTable()}refreshTable(){this.lastLazyLoadEvent&&this.loadLazy(this.lastLazyLoadEvent)}loadLazy(d){this.lastLazyLoadEvent=d;const g=["pageNumber="+d.first/this.perPage,`perPage=${d.rows}`,"paginacion=true"];this.filtroDesde&&g.push(`desde=${this.datePipe.transform(this.filtroDesde,"dd-MM-yyyy")}`),this.filtroHasta&&g.push(`hasta=${this.datePipe.transform(this.filtroHasta,"dd-MM-yyyy")}`),this.filtroPuntoVenta&&g.push(`idPuntoVenta=${this.filtroPuntoVenta.id}`),d.sortOrder&&g.push(`sortOrder=${d.sortOrder}`),d.sortField&&g.push(`sortField=${d.sortField}`),this.setUrlsExport(g),this.cashRegisterService.findAll(g.join("&")).subscribe(v=>{this.totalRecords=v.totalElements,this.cashRegisters=v.content})}getMontosCaja(d){return d.montosCaja}getMontosRealesCaja(d){return d.montosReales.map(r=>Object.assign(Object.assign({},r),{condicion:d.condicionesCaja.find(g=>g.moneda===r.moneda).condicionCaja}))}buildDate(d){return new Date(d)}openModaCashRegister(d){this.dialogService.open(u.S,{data:{cashLoad:d},header:"Caja ",width:"80%"})}setUrlsExport(d){const r=this.loginService.getUser().empresa.uuid,g=`${T.N.endpointApi}/public/export-data/${r}/cash-register`;this.actionsExportData=[{icon:"fa fa-file-excel-o",label:"Exportar a excel",url:`${g}.xlsx?${d.join("&")}`},{icon:"fa fa-file-pdf-o",label:"Exportar a pdf",url:`${g}.pdf?${d.join("&")}`}]}}U.\u0275fac=function(d){return new(d||U)(o.Y36(_.gz),o.Y36(_.F0),o.Y36(e.uU),o.Y36(C.ez),o.Y36(J.B),o.Y36(C.YP),o.Y36(I.B),o.Y36(D.r),o.Y36(L.i),o.Y36(R.E),o.Y36(P.xA),o.Y36($.p))},U.\u0275cmp=o.Xpm({type:U,selectors:[["app-cajas"]],viewQuery:function(d,r){if(1&d&&o.Gf(ee,7),2&d){let g;o.iGM(g=o.CRH())&&(r.tabla=g.first)}},decls:24,vars:24,consts:[[1,"grid"],[1,"col-12"],[3,"submit"],[1,"grid","p-fluid"],[1,"col-12","md:col-3"],[2,"margin-bottom","0.5rem","margin-top","0"],["name","filtroDesde","dateFormat","dd/mm/yy",3,"ngModel","locale","onSelect","ngModelChange"],["name","filtroHasta","dateFormat","dd/mm/yy",3,"ngModel","locale","onSelect","ngModelChange"],["dataKey","id","placeholder","Seleccione...","optionLabel","nombre","name","puntoVenta",3,"ngModel","showClear","options","onChange","ngModelChange"],[1,"col-12",2,"padding-top","1.5rem"],["dataKey","id",3,"columns","value","lazy","paginator","rows","totalRecords","responsive","autoLayout","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","summary"],["pTemplate","body"],[4,"ngFor","ngForOf"],[1,"m-1"],[3,"items"],[3,"ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngIf"],["style","text-align: center",4,"ngIf"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"p-column-title"],[1,"custom-badge",3,"ngClass"],["class","m-1",4,"ngFor","ngForOf"],[1,"custom-badge","status-info","m-r-3","m-l-3"],[1,"custom-badge","m-r-3","m-l-3",3,"ngClass"],[2,"text-align","center"],["pTooltip","Ver detalle",1,"fa","fa-list-ol",2,"margin-right","0.2em","margin-left","0.2em","cursor","pointer",3,"click"]],template:function(d,r){1&d&&(o.TgZ(0,"p-card"),o.TgZ(1,"div",0),o.TgZ(2,"div",1),o.TgZ(3,"form",2),o.NdJ("submit",function(){return r.refreshTable()}),o.TgZ(4,"div",3),o.TgZ(5,"div",4),o.TgZ(6,"h4",5),o._uU(7,"Desde"),o.qZA(),o.TgZ(8,"p-calendar",6),o.NdJ("onSelect",function(){return r.refreshTable()})("ngModelChange",function(v){return r.filtroDesde=v}),o.qZA(),o.qZA(),o.TgZ(9,"div",4),o.TgZ(10,"h4",5),o._uU(11,"Hasta"),o.qZA(),o.TgZ(12,"p-calendar",7),o.NdJ("onSelect",function(){return r.refreshTable()})("ngModelChange",function(v){return r.filtroHasta=v}),o.qZA(),o.qZA(),o.TgZ(13,"div",4),o.TgZ(14,"h4",5),o._uU(15,"Punto de venta"),o.qZA(),o.TgZ(16,"p-dropdown",8),o.NdJ("onChange",function(){return r.refreshTable()})("ngModelChange",function(v){return r.filtroPuntoVenta=v}),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(17,"div",0),o.TgZ(18,"div",9),o.TgZ(19,"p-table",10,11),o.NdJ("onLazyLoad",function(v){return r.loadLazy(v)}),o.YNc(21,oe,2,1,"ng-template",12),o.YNc(22,ne,2,1,"ng-template",13),o.YNc(23,ue,2,1,"ng-template",14),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&d&&(o.xp6(8),o.Akn(o.DdM(21,w)),o.Q6J("ngModel",r.filtroDesde)("locale",r.ls.calendarEs),o.xp6(4),o.Akn(o.DdM(22,w)),o.Q6J("ngModel",r.filtroHasta)("locale",r.ls.calendarEs),o.xp6(4),o.Akn(o.DdM(23,w)),o.Q6J("ngModel",r.filtroPuntoVenta)("showClear",!0)("options",r.puntosVenta),o.xp6(3),o.Q6J("columns",r.cols)("value",r.cashRegisters)("lazy",!0)("paginator",!0)("rows",r.perPage)("totalRecords",r.totalRecords)("responsive",!0)("autoLayout",!0))},directives:[Y.Z,q._Y,q.JL,q.F,K.f,q.JJ,q.On,Q.Lt,V.iA,C.jx,e.sg,G.h,e.RF,e.O5,e.n9,e.mk,e.ED,W.u],pipes:[X.s,e.uU],styles:[""]}),(0,h.gn)([(0,j.Ph)(A.Z.getOffice)],U.prototype,"puntoVenta$",void 0);const he=[{path:"",component:Z.r,canActivate:[l.P],data:{breadcrumb:[{label:"Operaciones"},{label:"Caja"}]}},{path:"reporte",component:U,canActivate:[l.P],data:{breadcrumb:[{label:"Operaciones"},{label:"Reporte de cajas"}]}}];let fe=(()=>{class c{}return c.\u0275fac=function(r){return new(r||c)},c.\u0275mod=o.oAB({type:c}),c.\u0275inj=o.cJS({imports:[[_.Bz.forChild(he)],_.Bz]}),c})();var Ce=i(20958),Ze=i(89400),Te=i(27429);let ve=(()=>{class c{}return c.\u0275fac=function(r){return new(r||c)},c.\u0275mod=o.oAB({type:c}),c.\u0275inj=o.cJS({providers:[P.xA],imports:[[fe,Ce.m,Ze.z,Te.N]]}),c})()},39428:(N,x,i)=>{i.d(x,{S:()=>j});var _=i(5e3),l=i(45330),Z=i(18872),h=i(53279);const f=function(){return{width:"100%",height:"80vh"}};let j=(()=>{class A{constructor(b,u){this.ref=b,this.config=u}ngOnInit(){}get cashLoad(){return this.config.data.cashLoad}}return A.\u0275fac=function(b){return new(b||A)(_.Y36(l.E7),_.Y36(l.S))},A.\u0275cmp=_.Xpm({type:A,selectors:[["app-caja-dialog"]],decls:2,vars:4,consts:[[3,"cashRegisterInput"]],template:function(b,u){1&b&&(_.TgZ(0,"p-scrollPanel"),_._UZ(1,"app-caja",0),_.qZA()),2&b&&(_.Akn(_.DdM(3,f)),_.xp6(1),_.Q6J("cashRegisterInput",u.cashLoad))},directives:[Z.P,h.r],styles:[""]}),A})()},53279:(N,x,i)=>{i.d(x,{r:()=>O});var _=i(70655),l=i(29067),Z=i(82817),h=i(85932),f=i(81575),j=i(8929),A=i(7625),E=i(24850),b=i(51420),u=i(93075),T=i(2994),o=i(66239),e=i(5e3),C=i(59783),J=i(21602),I=i(80581),D=i(45330),L=i(14036),R=i(69808),P=i(43724),$=i(31424),Y=i(20657),q=i(74297),K=i(68297),Q=i(40845),V=i(80267);function G(a,n){if(1&a&&(e.TgZ(0,"span",24),e._uU(1),e.ALo(2,"moneda"),e.qZA()),2&a){const t=n.$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,t.label,"moneda"))}}function W(a,n){1&a&&(e._uU(0),e.ALo(1,"moneda")),2&a&&e.hij(" ",e.xi3(1,1,n.$implicit.label,"moneda")," ")}function X(a,n){1&a&&e._UZ(0,"p-message",25)}function ee(a,n){1&a&&e._UZ(0,"p-message",26)}function te(a,n){1&a&&e._UZ(0,"p-message",27)}function oe(a,n){1&a&&e._UZ(0,"p-message",28)}function ne(a,n){1&a&&e._UZ(0,"p-message",29)}const ae=function(){return{width:"100%"}};class M{constructor(n,t,s,p,m,F,qe){this.fb=n,this.messageService=t,this.confirmationService=s,this.currencyService=p,this.cashRegisterService=m,this.ref=F,this.config=qe,this.unsubscribe$=new j.xQ,this.monedas=[],this.configCompany={}}ngOnInit(){this.configCompany$.pipe((0,o.Rs)(this.unsubscribe$)).subscribe(n=>{this.configCompany=n,this.builderForm(),this.loadCurrencies()})}builderForm(){this.modelForm=this.fb.group({id:[void 0,[]],tipoMovimientoCaja:[void 0,[u.kI.required]],conceptoMovimientoCaja:[void 0,[u.kI.required]],monedaMovimientoCaja:[void 0,[u.kI.required]],pagos:[[],[u.kI.required]],monto:[void 0,[u.kI.required,u.kI.min(.01)]],turno:[void 0,[]],descripcion:[void 0,[u.kI.required]],detalle:[void 0,[]]}),this.initForm()}loadCurrencies(){const n=t=>{this.modelForm.getRawValue().monedaMovimientoCaja||this.modelForm.patchValue({monedaMovimientoCaja:t.find(s=>s.monedaPorDefecto).codigoMoneda})};this.currencyService.findAll().pipe((0,T.b)(t=>n(t)),(0,E.U)(t=>t.map(s=>({label:s.codigoMoneda,value:s.codigoMoneda})))).subscribe(t=>this.monedas=t)}initForm(){const n=this.config.data.id;if(this.cashRegister=this.config.data.cashRegister,n)this.cashRegisterService.getCashRegisgerDetail(n).subscribe(t=>{this.tipoMovimientoCaja=t.tipoMovimientoCaja;const s=this.configCompany.formasPago.find(m=>"EFECTIVO"===m.formaPago),p=[];s&&p.push({monto:Number(t.monto),nombre:"Efectivo",formaPago:l.XB.EFECTIVO,metodoPago:s}),this.modelForm.patchValue({id:t.id,tipoMovimientoCaja:t.tipoMovimientoCaja,conceptoMovimientoCaja:t.conceptoMovimientoCaja,monto:t.monto,descripcion:t.descripcion,detalle:t.detalle,pagos:p})});else{this.tipoMovimientoCaja=this.config.data.tipoMovimientoCaja,this.conceptoMovimientoCaja=this.config.data.conceptoMovimientoCaja;const t=this.configCompany.formasPago.find(p=>"EFECTIVO"===p.formaPago),s=[];t&&s.push({monto:0,nombre:"Efectivo",formaPago:l.XB.EFECTIVO,metodoPago:t}),this.modelForm.patchValue({tipoMovimientoCaja:this.tipoMovimientoCaja,conceptoMovimientoCaja:this.conceptoMovimientoCaja,pagos:s,monto:0})}}changeAmount(){const n=(0,Z.He)(this.modelForm.get("monto").value);this.modelForm.get("pagos").clearValidators();const t=this.configCompany.formasPago.find(p=>"EFECTIVO"===p.formaPago),s=[];t&&s.push({monto:0,nombre:"Efectivo",formaPago:l.XB.EFECTIVO,metodoPago:t}),this.modelForm.patchValue({pagos:s}),this.modelForm.get("pagos").setValidators([(0,Z.Kv)(n)]),this.modelForm.get("pagos").updateValueAndValidity()}get titleButtonAction(){return this.config.data.id?"Actualizar":"Registrar"}cancelRegister(){this.ref.close()}registrarMovimiento(){if((0,Z.c2)(this.modelForm),this.modelForm.valid){const n=this.modelForm.getRawValue();n.turno=this.cashRegister.turno,n.cashRegister={id:this.cashRegister.id},n.fechaMovimiento=new Date,this.config.data.id?this.cashRegisterService.updateCashRegisgerDetail(n).subscribe(t=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:"Movimiento actualizado correctamente"}),this.ref.close(!0)}):this.cashRegisterService.saveCashRegisgerDetail(n).subscribe(t=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:"Movimiento registrado correctamente"}),this.ref.close(!0)})}}}M.\u0275fac=function(n){return new(n||M)(e.Y36(u.qu),e.Y36(C.ez),e.Y36(C.YP),e.Y36(J.i),e.Y36(I.B),e.Y36(D.E7),e.Y36(D.S))},M.\u0275cmp=e.Xpm({type:M,selectors:[["app-caja-detalle"]],decls:33,vars:14,consts:[["novalidate","",3,"formGroup"],[1,"grid"],[1,"col-12","md:col-6","p-fluid"],["for","moneda",1,"label-form"],["formControlName","monedaMovimientoCaja","placeholder","Seleccione","id","moneda","name","moneda",3,"options"],["pTemplate","selectedItem"],["pTemplate","item"],["severity","error","text","Ingrese moneda",4,"ngIf"],[1,"col-12","md:col-6"],["for","descripcion",1,"label-form"],["formControlName","descripcion","id","descripcion","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["severity","error","text","Ingrese descripci\xf3n",4,"ngIf"],["for","detalle",1,"label-form"],["formControlName","detalle","id","detalle","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["for","monto",1,"label-form"],["formControlName","monto","pKeyFilter","num","id","monto","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em",3,"input"],["severity","error","text","Ingrese monto",4,"ngIf"],["severity","error","text","Ingrese monto m\xednimo",4,"ngIf"],[1,"col-12"],["formControlName","pagos",3,"tipo","total","moneda"],["severity","error","text","Pago incorrecto",4,"ngIf"],[1,"col-12",2,"text-align","center"],["pButton","","type","button","label","Cancelar",1,"p-button-secondary","ml-1","mr-1",3,"click"],["pButton","","type","button",1,"ml-1","mr-1",3,"label","click"],[2,"vertical-align","middle"],["severity","error","text","Ingrese moneda"],["severity","error","text","Ingrese descripci\xf3n"],["severity","error","text","Ingrese monto"],["severity","error","text","Ingrese monto m\xednimo"],["severity","error","text","Pago incorrecto"]],template:function(n,t){1&n&&(e.TgZ(0,"form",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"label",3),e._uU(4,"Moneda (*)"),e.qZA(),e.TgZ(5,"p-dropdown",4),e.YNc(6,G,3,4,"ng-template",5),e.YNc(7,W,2,4,"ng-template",6),e.qZA(),e.YNc(8,X,1,0,"p-message",7),e.qZA(),e.TgZ(9,"div",8),e.TgZ(10,"label",9),e._uU(11,"Descripci\xf3n (*)"),e.qZA(),e._UZ(12,"input",10),e.YNc(13,ee,1,0,"p-message",11),e.qZA(),e.TgZ(14,"div",8),e.TgZ(15,"label",12),e._uU(16,"Detalle"),e.qZA(),e._UZ(17,"input",13),e.qZA(),e.TgZ(18,"div",8),e.TgZ(19,"label",14),e._uU(20,"Monto (*)"),e.qZA(),e.TgZ(21,"input",15),e.NdJ("input",function(){return t.changeAmount()}),e.qZA(),e.YNc(22,te,1,0,"p-message",16),e.YNc(23,oe,1,0,"p-message",17),e.qZA(),e.TgZ(24,"div",18),e.TgZ(25,"label",12),e._uU(26,"Forma de pago (*)"),e.qZA(),e.TgZ(27,"p-card"),e._UZ(28,"app-forma-pago-venta",19),e.qZA(),e.YNc(29,ne,1,0,"p-message",20),e.qZA(),e.TgZ(30,"div",21),e.TgZ(31,"button",22),e.NdJ("click",function(){return t.cancelRegister()}),e.qZA(),e.TgZ(32,"button",23),e.NdJ("click",function(){return t.registrarMovimiento()}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.Q6J("formGroup",t.modelForm),e.xp6(5),e.Akn(e.DdM(13,ae)),e.Q6J("options",t.monedas),e.xp6(3),e.Q6J("ngIf",t.modelForm.get("monedaMovimientoCaja").touched&&(null==t.modelForm.get("monedaMovimientoCaja").errors?null:t.modelForm.get("monedaMovimientoCaja").errors.required)),e.xp6(5),e.Q6J("ngIf",t.modelForm.get("descripcion").touched&&(null==t.modelForm.get("descripcion").errors?null:t.modelForm.get("descripcion").errors.required)),e.xp6(9),e.Q6J("ngIf",t.modelForm.get("monto").touched&&(null==t.modelForm.get("monto").errors?null:t.modelForm.get("monto").errors.required)),e.xp6(1),e.Q6J("ngIf",t.modelForm.get("monto").touched&&(null==t.modelForm.get("monto").errors?null:t.modelForm.get("monto").errors.min)),e.xp6(5),e.Q6J("tipo",t.modelForm.get("tipoMovimientoCaja").value)("total",t.modelForm.get("monto").value)("moneda",t.modelForm.get("monedaMovimientoCaja").value),e.xp6(1),e.Q6J("ngIf",t.modelForm.get("pagos").touched&&(null==t.modelForm.get("pagos").errors?null:t.modelForm.get("pagos").errors.totalFormaPago)),e.xp6(3),e.Q6J("label",t.titleButtonAction))},directives:[u._Y,u.JL,u.sg,L.Lt,u.JJ,u.u,C.jx,R.O5,P.q,u.Fj,$.o,Y.Fr,q.Z,K.M,Q.Hq],pipes:[V.s],styles:[""]}),(0,_.gn)([(0,h.Ph)(f.Z.getConfig)],M.prototype,"configCompany$",void 0);var ie=i(20207),B=i(74202),H=i(24394),se=i(47745),re=i(22313),z=i(75652);function ce(a,n){1&a&&(e.TgZ(0,"h1"),e._uU(1,"Apertura de caja"),e.qZA())}function le(a,n){if(1&a&&(e.TgZ(0,"div",2),e.TgZ(1,"p"),e._uU(2),e.qZA(),e.qZA()),2&a){const t=e.oxw();e.xp6(2),e.hij("Turno: ",t.turno,"")}}function pe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"div",8),e.TgZ(2,"div",2),e._uU(3),e.qZA(),e.TgZ(4,"div",2),e.TgZ(5,"input",9),e.NdJ("ngModelChange",function(p){return e.CHM(t).$implicit.monto=p}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&a){const t=n.$implicit;e.xp6(3),e.hij(" ",t.monedaMovimientoCaja," "),e.xp6(2),e.Q6J("ngModel",t.monto)}}const de=function(){return{width:"100%"}};class y{constructor(n,t,s){this.cashRegisterService=n,this.ls=t,this.currencyService=s,this.unsubscribe$=new j.xQ,this.aperturar=new e.vpe,this.changeFecha=new e.vpe,this.apertura={cashRegisterDetails:[]},this.fechaMaxima=new Date,this.monedas=[]}ngOnInit(){this.puntoVenta$.pipe((0,A.R)(this.unsubscribe$)).subscribe(n=>{this.puntoVenta=n}),this.estacionVenta$.pipe((0,A.R)(this.unsubscribe$)).subscribe(n=>{this.estacionVenta=n}),this.fecha=new Date,this.currencyService.findAll().pipe((0,o.bw)(n=>{this.monedaPorDefecto=n.filter(t=>t.monedaPorDefecto)?n.find(t=>t.monedaPorDefecto).codigoMoneda:"PEN"}),(0,E.U)(n=>n.map(t=>({label:t.codigoMoneda,value:t.codigoMoneda})))).subscribe(n=>{this.monedas=n,this.prepareToAperture()})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}prepareToAperture(){this.apertura={fecha:this.fecha.getTime(),cashRegisterDetails:[],puntoVenta:this.puntoVenta,estacionVenta:this.estacionVenta},this.monedas.forEach(n=>{this.apertura.cashRegisterDetails.push({tipoMovimientoCaja:l.Bb.INGRESO,conceptoMovimientoCaja:l._S.APERTURA_CAJA,monedaMovimientoCaja:n.value,descripcion:"Apertura de caja",monto:0})})}aperturarCaja(){console.log(this.monedaPorDefecto),this.apertura.cashRegisterDetails=this.apertura.cashRegisterDetails.filter(n=>n.monto||n.monedaMovimientoCaja===this.monedaPorDefecto),this.apertura.cashRegisterDetails.forEach(n=>{n.pagos=[{formaPago:l.XB.EFECTIVO,nombre:"Efectivo",monto:n.monto}]}),this.cashRegisterService.aperturar(Object.assign(Object.assign({},this.apertura),{cashRegisterDetails:this.apertura.cashRegisterDetails})).subscribe(n=>{this.aperturar.emit(!0)})}changeCalendar(){this.changeFecha.emit(this.fecha)}}y.\u0275fac=function(n){return new(n||y)(e.Y36(I.B),e.Y36(H.E),e.Y36(J.i))},y.\u0275cmp=e.Xpm({type:y,selectors:[["app-aperturar-caja"]],inputs:{esTurno:"esTurno",turno:"turno"},outputs:{aperturar:"aperturar",changeFecha:"changeFecha"},decls:9,vars:11,consts:[[4,"ngIf"],[1,"grid",2,"width","80%"],[1,"col-12","md:col-6"],["dateFormat","dd/mm/yy",3,"readonlyInput","maxDate","disabled","ngModel","locale","onSelect","ngModelChange"],["class","col-12 md:col-6",4,"ngIf"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12"],["type","button","pButton","","label","Aperturar",3,"click"],[1,"grid"],["type","text","pKeyFilter","num","pInputText","",2,"width","100%",3,"ngModel","ngModelChange"]],template:function(n,t){1&n&&(e.TgZ(0,"p-card"),e.YNc(1,ce,2,0,"h1",0),e.TgZ(2,"div",1),e.TgZ(3,"div",2),e.TgZ(4,"p-calendar",3),e.NdJ("onSelect",function(){return t.changeCalendar()})("ngModelChange",function(p){return t.fecha=p}),e.qZA(),e.qZA(),e.YNc(5,le,3,1,"div",4),e.YNc(6,pe,6,2,"div",5),e.TgZ(7,"div",6),e.TgZ(8,"button",7),e.NdJ("click",function(){return t.aperturarCaja()}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",!t.esTurno),e.xp6(3),e.Akn(e.DdM(10,de)),e.Q6J("readonlyInput",!0)("maxDate",t.fechaMaxima)("disabled",t.esTurno)("ngModel",t.fecha)("locale",t.ls.calendarEs),e.xp6(1),e.Q6J("ngIf",t.esTurno),e.xp6(1),e.Q6J("ngForOf",t.apertura.cashRegisterDetails))},directives:[q.Z,R.O5,z.f,u.JJ,u.On,R.sg,u.Fj,Y.Fr,$.o,Q.Hq],styles:[""]}),(0,_.gn)([(0,h.Ph)(f.Z.getOffice)],y.prototype,"puntoVenta$",void 0),(0,_.gn)([(0,h.Ph)(f.Z.getSaleStation)],y.prototype,"estacionVenta$",void 0);var ge=i(28061),S=i(98952),me=i(80422),_e=i(4119),ue=i(17102),w=i(15315),U=i(77966),he=i(77121);function fe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"app-aperturar-caja",12),e.NdJ("changeFecha",function(p){return e.CHM(t),e.oxw().changeFechaApertura(p)})("aperturar",function(){return e.CHM(t),e.oxw().loadCashRegister()}),e.qZA()}2&a&&e.Q6J("esTurno",!1)}function Ce(a,n){1&a&&(e.TgZ(0,"tr"),e.TgZ(1,"th"),e._uU(2,"Concepto"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Monto"),e.qZA(),e.qZA())}function Ze(a,n){if(1&a&&(e.TgZ(0,"tr",42),e.TgZ(1,"td"),e._uU(2),e.ALo(3,"conceptoMovimiento"),e.qZA(),e.TgZ(4,"td",43),e._uU(5),e.ALo(6,"moneda"),e.ALo(7,"number"),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.Q6J("pSelectableRow",t),e.xp6(2),e.AsE("",e.lcZ(3,5,t.concepto)," (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(6,7,t.moneda)," ",e.xi3(7,9,t.monto,"1.2-5")," ")}}function Te(a,n){if(1&a&&(e.TgZ(0,"div"),e.TgZ(1,"div",45),e.TgZ(2,"div"),e._uU(3),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"montoDinero"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.hij("Total ingresos (",t.moneda,")"),e.xp6(2),e.Oqu(e.xi3(6,2,t.monto,t.moneda))}}function ve(a,n){if(1&a&&e.YNc(0,Te,7,5,"div",44),2&a){const t=e.oxw(2);e.Q6J("ngForOf",t.montosTotalesIngresos)}}function c(a,n){if(1&a&&(e.TgZ(0,"div",45),e.TgZ(1,"div"),e.TgZ(2,"span",49),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div"),e.TgZ(5,"h3",50),e._uU(6),e.ALo(7,"moneda"),e.ALo(8,"number"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.hij("Efectivo (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(7,3,t.moneda)," ",e.xi3(8,5,t.monto,"1.2-5"),"")}}function d(a,n){if(1&a&&(e.TgZ(0,"div",45),e.TgZ(1,"div"),e.TgZ(2,"span",49),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div"),e.TgZ(5,"h3",50),e._uU(6),e.ALo(7,"moneda"),e.ALo(8,"number"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.hij("Tarjeta o transferencia (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(7,3,t.moneda)," ",e.xi3(8,5,t.monto,"1.2-5"),"")}}function r(a,n){if(1&a&&(e.TgZ(0,"div",45),e.TgZ(1,"div"),e.TgZ(2,"span",51),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div",52),e.TgZ(5,"h3",53),e._uU(6),e.ALo(7,"moneda"),e.ALo(8,"number"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.hij("Ventas al cr\xe9dito (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(7,3,t.moneda)," ",e.xi3(8,5,t.monto,"1.2-5"),"")}}function g(a,n){if(1&a&&(e.TgZ(0,"div",46),e.TgZ(1,"p-fieldset",47),e.YNc(2,c,9,8,"div",48),e.YNc(3,d,9,8,"div",48),e.YNc(4,r,9,8,"div",48),e.qZA(),e.qZA()),2&a){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.cashRegister.montosVentasEfectivo),e.xp6(1),e.Q6J("ngForOf",t.cashRegister.montosVentasNoEfectivo),e.xp6(1),e.Q6J("ngForOf",t.cashRegister.montosVentasCredito)}}function v(a,n){if(1&a&&(e.TgZ(0,"div",45),e.TgZ(1,"div"),e.TgZ(2,"span",49),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div"),e.TgZ(5,"h3",50),e._uU(6),e.ALo(7,"moneda"),e.ALo(8,"number"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.AsE("",t.metodoPago.nombre," (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(7,4,t.moneda)," ",e.xi3(8,6,t.monto,"1.2-5"),"")}}function k(a,n){if(1&a&&(e.TgZ(0,"div",46),e.TgZ(1,"p-fieldset",54),e.YNc(2,v,9,9,"div",48),e.qZA(),e.qZA()),2&a){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.cashRegister.montosPagosIngresos)}}function Ae(a,n){1&a&&(e.TgZ(0,"tr"),e.TgZ(1,"th"),e._uU(2,"Concepto"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Monto"),e.qZA(),e.qZA())}function xe(a,n){if(1&a&&(e.TgZ(0,"tr",42),e.TgZ(1,"td"),e._uU(2),e.ALo(3,"conceptoMovimiento"),e.qZA(),e.TgZ(4,"td",43),e._uU(5),e.ALo(6,"moneda"),e.ALo(7,"number"),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.Q6J("pSelectableRow",t),e.xp6(2),e.AsE("",e.lcZ(3,5,t.concepto)," (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(6,7,t.moneda)," ",e.xi3(7,9,t.monto,"1.2-5")," ")}}function je(a,n){if(1&a&&(e.TgZ(0,"div"),e.TgZ(1,"div",45),e.TgZ(2,"div"),e._uU(3),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"montoDinero"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.hij("Total egresos (",t.moneda,")"),e.xp6(2),e.Oqu(e.xi3(6,2,t.monto,t.moneda))}}function be(a,n){if(1&a&&e.YNc(0,je,7,5,"div",44),2&a){const t=e.oxw(2);e.Q6J("ngForOf",t.montosTotalesEgresos)}}function Re(a,n){if(1&a&&(e.TgZ(0,"div",45),e.TgZ(1,"div"),e.TgZ(2,"span",49),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div"),e.TgZ(5,"h3",50),e._uU(6),e.ALo(7,"moneda"),e.ALo(8,"number"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.hij("Efectivo (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(7,3,t.moneda)," ",e.xi3(8,5,t.monto,"1.2-5"),"")}}function Me(a,n){if(1&a&&(e.TgZ(0,"div",45),e.TgZ(1,"div"),e.TgZ(2,"span",49),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div"),e.TgZ(5,"h3",50),e._uU(6),e.ALo(7,"moneda"),e.ALo(8,"number"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.hij("Tarjeta o transferencia (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(7,3,t.moneda)," ",e.xi3(8,5,t.monto,"1.2-5"),"")}}function Ee(a,n){if(1&a&&(e.TgZ(0,"div",45),e.TgZ(1,"div"),e.TgZ(2,"span",51),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div",56),e.TgZ(5,"h3",53),e._uU(6),e.ALo(7,"moneda"),e.ALo(8,"number"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.hij("Compras al cr\xe9dito (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(7,3,t.moneda)," ",e.xi3(8,5,t.monto,"1.2-5"),"")}}function Ue(a,n){if(1&a&&(e.TgZ(0,"div",46),e.TgZ(1,"p-fieldset",55),e.YNc(2,Re,9,8,"div",48),e.YNc(3,Me,9,8,"div",48),e.YNc(4,Ee,9,8,"div",48),e.qZA(),e.qZA()),2&a){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.cashRegister.montosComprasEfectivo),e.xp6(1),e.Q6J("ngForOf",t.cashRegister.montosComprasNoEfectivo),e.xp6(1),e.Q6J("ngForOf",t.cashRegister.montosComprasCredito)}}function Oe(a,n){if(1&a&&(e.TgZ(0,"div",45),e.TgZ(1,"div"),e.TgZ(2,"span",49),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"div"),e.TgZ(5,"h3",50),e._uU(6),e.ALo(7,"moneda"),e.ALo(8,"number"),e.qZA(),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(3),e.AsE("",t.metodoPago.nombre," (",t.moneda,")"),e.xp6(3),e.AsE("",e.lcZ(7,4,t.moneda)," ",e.xi3(8,6,t.monto,"1.2-5"),"")}}function Je(a,n){if(1&a&&(e.TgZ(0,"div",46),e.TgZ(1,"p-fieldset",57),e.YNc(2,Oe,9,9,"div",48),e.qZA(),e.qZA()),2&a){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.cashRegister.montosPagosEgresos)}}function Fe(a,n){if(1&a&&(e.TgZ(0,"div",23),e.TgZ(1,"strong"),e._uU(2,"Cierre: "),e.qZA(),e.TgZ(3,"p",24),e._uU(4),e.ALo(5,"date"),e.qZA(),e.qZA()),2&a){const t=e.oxw(2);e.xp6(4),e.hij(" ",e.xi3(5,1,t.cashRegister.fechaCierre,"hh:mm a"),"")}}function De(a,n){if(1&a&&(e.TgZ(0,"span"),e.TgZ(1,"span",58),e._uU(2,"Fecha:"),e.qZA(),e._uU(3),e.ALo(4,"date"),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.hij(" ",e.xi3(4,1,t.cashRegisterInput.fecha,"dd/MM/yyyy"),"")}}const ye=function(){return{width:"100%"}};function Se(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"p-calendar",59),e.NdJ("onSelect",function(){return e.CHM(t),e.oxw(2).loadCashRegister()})("ngModelChange",function(p){return e.CHM(t),e.oxw(2).fecha=p}),e.qZA()}if(2&a){const t=e.oxw(2);e.Akn(e.DdM(6,ye)),e.Q6J("readonlyInput",!0)("maxDate",t.fechaMaxima)("ngModel",t.fecha)("locale",t.ls.calendarEs)}}function Ne(a,n){if(1&a&&(e.TgZ(0,"span"),e.TgZ(1,"span",58),e._uU(2,"Turno:"),e.qZA(),e._uU(3),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.cashRegisterInput.turno,"")}}function Pe(a,n){if(1&a&&(e.TgZ(0,"span",62),e._uU(1),e.qZA()),2&a){const t=n.$implicit;e.xp6(1),e.hij("Turno: ",t.label,"")}}function $e(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"p-dropdown",60),e.NdJ("onChange",function(){return e.CHM(t),e.oxw(2).changeTurno()})("ngModelChange",function(p){return e.CHM(t),e.oxw(2).turnoSelected=p}),e.YNc(1,Pe,2,1,"ng-template",61),e.qZA()}if(2&a){const t=e.oxw(2);e.Akn(e.DdM(4,ye)),e.Q6J("ngModel",t.turnoSelected)("options",t.turnos)}}function Ye(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",63),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).showModalNuevoTurno()}),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("disabled",!t.cajasCerradas)}}function Qe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",64),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).openDialogRegisterOtrosIngresos()}),e.qZA()}}function we(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",65),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).openDialogRegisterOtrosEgresos()}),e.qZA()}}function Le(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",66),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).openDialogRegisterRetiroCaja()}),e.qZA()}}function Ve(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",67),e.TgZ(1,"p-card"),e.TgZ(2,"div",68),e.TgZ(3,"div",69),e.TgZ(4,"span",70),e._uU(5),e.qZA(),e.TgZ(6,"h3",50),e._uU(7),e.ALo(8,"moneda"),e.ALo(9,"number"),e.qZA(),e.qZA(),e.TgZ(10,"div",71),e.TgZ(11,"button",72),e.NdJ("click",function(){const m=e.CHM(t).$implicit;return e.oxw(2).openPdf(m.moneda,!1)}),e.qZA(),e.TgZ(12,"button",73),e.NdJ("click",function(){const m=e.CHM(t).$implicit;return e.oxw(2).openPdf(m.moneda,!0)}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&a){const t=n.$implicit;e.xp6(5),e.hij("Efectivo ",t.moneda,""),e.xp6(2),e.AsE("",e.lcZ(8,3,t.moneda)," ",e.xi3(9,5,t.monto,"1.2-5"),"")}}function Be(a,n){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&a){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.monto,"")}}function He(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"input",77),e.NdJ("ngModelChange",function(p){return e.CHM(t),e.oxw().$implicit.monto=p}),e.qZA()}if(2&a){const t=e.oxw().$implicit;e.Q6J("ngModel",t.monto)}}function ze(a,n){if(1&a&&e._UZ(0,"p-message",82),2&a){const t=e.oxw(2).$implicit;e.Q6J("text",t.moneda+" Exacto")}}function ke(a,n){if(1&a&&e._UZ(0,"p-message",83),2&a){const t=e.oxw(2).$implicit;e.Q6J("text",t.moneda+" Exceso")}}function Ke(a,n){if(1&a&&e._UZ(0,"p-message",84),2&a){const t=e.oxw(2).$implicit;e.Q6J("text",t.moneda+" Faltante")}}function Ge(a,n){if(1&a&&(e.TgZ(0,"div",78),e.YNc(1,ze,1,1,"p-message",79),e.YNc(2,ke,1,1,"p-message",80),e.YNc(3,Ke,1,1,"p-message",81),e.qZA()),2&a){const t=e.oxw().$implicit,s=e.oxw(2);e.xp6(1),e.Q6J("ngIf","MONTO_IGUAL"==s.getCondicionCaja(t.moneda)),e.xp6(1),e.Q6J("ngIf","MONTO_MAYOR"==s.getCondicionCaja(t.moneda)),e.xp6(1),e.Q6J("ngIf","MONTO_MENOR"==s.getCondicionCaja(t.moneda))}}function We(a,n){if(1&a&&(e.TgZ(0,"div",39),e.TgZ(1,"h4",74),e._uU(2),e.qZA(),e.YNc(3,Be,2,1,"span",28),e.YNc(4,He,1,1,"input",75),e.YNc(5,Ge,4,3,"div",76),e.qZA()),2&a){const t=n.$implicit,s=e.oxw(2);e.xp6(2),e.hij("Monto real (",t.moneda,")"),e.xp6(1),e.Q6J("ngIf",s.cashRegisterInput),e.xp6(1),e.Q6J("ngIf",!s.cashRegisterInput),e.xp6(1),e.Q6J("ngIf",s.cajaCerrada)}}function Xe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",85),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).closeCashRegister()}),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("disabled",!t.canCloseCashRegister)}}function et(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"p-card"),e.TgZ(1,"div",13),e.TgZ(2,"div",14),e.TgZ(3,"div",13),e.TgZ(4,"div",15),e.TgZ(5,"p-panel",16),e.TgZ(6,"p-table",17),e.NdJ("selectionChange",function(p){return e.CHM(t),e.oxw().conceptoSelected=p})("onRowSelect",function(p){return e.CHM(t),e.oxw().onRowSelect(p)}),e.YNc(7,Ce,5,0,"ng-template",10),e.YNc(8,Ze,8,12,"ng-template",11),e.YNc(9,ve,1,1,"ng-template",18),e.qZA(),e.YNc(10,g,5,3,"div",19),e.YNc(11,k,3,1,"div",19),e.qZA(),e.qZA(),e.TgZ(12,"div",15),e.TgZ(13,"p-panel",20),e.TgZ(14,"p-table",17),e.NdJ("selectionChange",function(p){return e.CHM(t),e.oxw().conceptoSelected=p})("onRowSelect",function(p){return e.CHM(t),e.oxw().onRowSelect(p)}),e.YNc(15,Ae,5,0,"ng-template",10),e.YNc(16,xe,8,12,"ng-template",11),e.YNc(17,be,1,1,"ng-template",18),e.qZA(),e.YNc(18,Ue,5,3,"div",19),e.YNc(19,Je,3,1,"div",19),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(20,"div",14),e.TgZ(21,"div",13),e.TgZ(22,"div",15),e.TgZ(23,"p-panel",21),e.TgZ(24,"div",22),e.TgZ(25,"div",15),e.TgZ(26,"div",13),e.TgZ(27,"div",23),e.TgZ(28,"strong"),e._uU(29,"Estado"),e.qZA(),e.TgZ(30,"p",24),e._uU(31),e.qZA(),e.qZA(),e.TgZ(32,"div",23),e.TgZ(33,"strong"),e._uU(34,"Apertura"),e.qZA(),e.TgZ(35,"p",24),e._uU(36),e.ALo(37,"date"),e.qZA(),e.qZA(),e.YNc(38,Fe,6,4,"div",25),e.TgZ(39,"div",23),e.TgZ(40,"strong"),e._uU(41,"Modo"),e.qZA(),e.TgZ(42,"p-selectButton",26),e.NdJ("ngModelChange",function(p){return e.CHM(t),e.oxw().tipoReporteCaja=p}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(43,"div",27),e.YNc(44,De,5,4,"span",28),e.YNc(45,Se,1,7,"p-calendar",29),e.qZA(),e.TgZ(46,"div",27),e.YNc(47,Ne,4,1,"span",28),e.YNc(48,$e,2,5,"p-dropdown",30),e.qZA(),e.TgZ(49,"div",31),e.YNc(50,Ye,1,1,"button",32),e.qZA(),e.TgZ(51,"div",31),e.YNc(52,Qe,1,0,"button",33),e.qZA(),e.TgZ(53,"div",31),e.YNc(54,we,1,0,"button",34),e.qZA(),e.TgZ(55,"div",31),e.YNc(56,Le,1,0,"button",35),e.qZA(),e.YNc(57,Ve,13,8,"div",36),e.TgZ(58,"div",15),e.TgZ(59,"p-card"),e.TgZ(60,"div",37),e.YNc(61,We,6,4,"div",38),e.TgZ(62,"div",15),e.TgZ(63,"div",13),e.TgZ(64,"div",39),e.YNc(65,Xe,1,1,"button",40),e.qZA(),e.TgZ(66,"div",39),e.TgZ(67,"button",41),e.NdJ("click",function(){return e.CHM(t),e.oxw().visibleHistorialCierre=!0}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(6),e.Q6J("value",t.tableIngresos)("selection",t.conceptoSelected),e.xp6(4),e.Q6J("ngIf",null==t.cashRegister||null==t.cashRegister.montosVentas?null:t.cashRegister.montosVentas.length),e.xp6(1),e.Q6J("ngIf",null==t.cashRegister||null==t.cashRegister.montosPagosIngresos?null:t.cashRegister.montosPagosIngresos.length),e.xp6(3),e.Q6J("value",t.tableEgresos)("selection",t.conceptoSelected),e.xp6(4),e.Q6J("ngIf",null==t.cashRegister||null==t.cashRegister.montosCompras?null:t.cashRegister.montosCompras.length),e.xp6(1),e.Q6J("ngIf",null==t.cashRegister||null==t.cashRegister.montosPagosEgresos?null:t.cashRegister.montosPagosEgresos.length),e.xp6(12),e.Oqu(t.cashRegister.estadoCaja),e.xp6(5),e.hij(" ",e.xi3(37,24,t.cashRegister.fechaInicio,"hh:mm a"),""),e.xp6(2),e.Q6J("ngIf","CERRADA"===t.cashRegister.estadoCaja),e.xp6(4),e.Q6J("options",t.tiposReporteCaja)("ngModel",t.tipoReporteCaja),e.xp6(2),e.Q6J("ngIf",t.cashRegisterInput),e.xp6(1),e.Q6J("ngIf",!t.cashRegisterInput),e.xp6(2),e.Q6J("ngIf",t.cashRegisterInput),e.xp6(1),e.Q6J("ngIf",!t.cashRegisterInput),e.xp6(2),e.Q6J("ngIf",!t.cashRegisterInput),e.xp6(2),e.Q6J("ngIf",!t.cajaCerrada&&!t.cashRegisterInput),e.xp6(2),e.Q6J("ngIf",!t.cajaCerrada&&!t.cashRegisterInput),e.xp6(2),e.Q6J("ngIf",!t.cajaCerrada&&!t.cashRegisterInput),e.xp6(1),e.Q6J("ngForOf",t.cashRegister.montosCaja),e.xp6(4),e.Q6J("ngForOf",t.cashRegister.montosReales),e.xp6(4),e.Q6J("ngIf",!t.cashRegisterInput)}}function tt(a,n){1&a&&(e.TgZ(0,"tr"),e.TgZ(1,"th"),e._uU(2,"Estado"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Moneda"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Monto"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Fecha"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Usuario"),e.qZA(),e.qZA())}function ot(a,n){if(1&a&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.ALo(9,"date"),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.qZA()),2&a){const t=n.$implicit;e.xp6(2),e.Oqu(t.condicionCierre),e.xp6(2),e.Oqu(t.moneda),e.xp6(2),e.Oqu(t.monto),e.xp6(2),e.Oqu(e.xi3(9,5,t.fechaCierre,"dd/MM/yyyy hh:mm a")),e.xp6(3),e.Oqu(null==t.usuarioCierre?null:t.usuarioCierre.nombreCompleto)}}function nt(a,n){if(1&a&&(e.TgZ(0,"p-table",86),e.YNc(1,tt,11,0,"ng-template",10),e.YNc(2,ot,12,8,"ng-template",11),e.qZA()),2&a){const t=e.oxw();e.Q6J("value",t.cashRegister.montosRealesHistoricos)}}function at(a,n){if(1&a&&(e._uU(0),e.ALo(1,"conceptoMovimiento")),2&a){const t=e.oxw();e.AsE(" ",e.lcZ(1,2,null==t.conceptoSelected?null:t.conceptoSelected.concepto)," (",null==t.conceptoSelected?null:t.conceptoSelected.moneda," ) ")}}function it(a,n){1&a&&(e.TgZ(0,"th"),e._uU(1,"Acciones"),e.qZA())}function st(a,n){if(1&a&&(e.TgZ(0,"tr"),e.TgZ(1,"th",87),e._uU(2,"Descripci\xf3n "),e._UZ(3,"p-sortIcon",88),e.qZA(),e.TgZ(4,"th",89),e._uU(5,"Al credito "),e._UZ(6,"p-sortIcon",90),e.qZA(),e.TgZ(7,"th",91),e._uU(8,"Estado "),e._UZ(9,"p-sortIcon",92),e.qZA(),e.TgZ(10,"th",93),e._uU(11,"Fecha "),e._UZ(12,"p-sortIcon",94),e.qZA(),e.TgZ(13,"th",95),e._uU(14,"Usuario "),e._UZ(15,"p-sortIcon",96),e.qZA(),e.TgZ(16,"th",97),e._uU(17,"Monto "),e._UZ(18,"p-sortIcon",98),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Forma pago"),e.qZA(),e.YNc(21,it,2,0,"th",28),e.qZA()),2&a){const t=e.oxw();e.xp6(21),e.Q6J("ngIf",!t.cajaCerrada)}}function rt(a,n){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&a){const t=e.oxw().$implicit;e.xp6(1),e.hij(" - ",e.xi3(2,1,t.ticket.fechaEmisionDate,"dd/MM/yyyy"),"")}}function ct(a,n){1&a&&(e.TgZ(0,"span"),e._uU(1,"Si"),e.qZA())}function lt(a,n){1&a&&e._uU(0,"No")}function pt(a,n){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&a){const t=e.oxw().$implicit;e.xp6(1),e.hij(" (",t.numeroOperacion,")")}}function dt(a,n){if(1&a&&(e.TgZ(0,"span",104),e._uU(1),e.ALo(2,"montoDinero"),e.YNc(3,pt,2,1,"span",28),e.qZA()),2&a){const t=n.$implicit,s=e.oxw(2);e.xp6(1),e.AsE(" ",t.nombre,": ",e.xi3(2,3,t.monto,s.conceptoSelected.moneda)," "),e.xp6(2),e.Q6J("ngIf",t.numeroOperacion)}}function gt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"i",107),e.NdJ("click",function(){e.CHM(t);const p=e.oxw(2).$implicit;return e.oxw().openDialogUpdateCashRegisterDetail(p)}),e.qZA()}}function mt(a,n){if(1&a&&(e.TgZ(0,"td",105),e.TgZ(1,"span",99),e._uU(2,"Acciones"),e.qZA(),e.YNc(3,gt,1,0,"i",106),e.qZA()),2&a){const t=e.oxw().$implicit,s=e.oxw();e.xp6(3),e.Q6J("ngIf",!t.ticket&&!s.cashRegisterInput&&!t.compra)}}const _t=function(a){return{"fila-credito":a}};function ut(a,n){if(1&a&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e.TgZ(2,"span",99),e._uU(3,"Descripci\xf3n"),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.YNc(6,rt,3,4,"span",28),e.qZA(),e.qZA(),e.TgZ(7,"td"),e.TgZ(8,"span",99),e._uU(9,"Al cr\xe9dito"),e.qZA(),e.YNc(10,ct,2,0,"span",1),e.YNc(11,lt,1,0,"ng-template",null,100,e.W1O),e.qZA(),e.TgZ(13,"td"),e.TgZ(14,"span",99),e._uU(15,"Estado"),e.qZA(),e._uU(16),e.qZA(),e.TgZ(17,"td"),e.TgZ(18,"span",99),e._uU(19,"Fecha"),e.qZA(),e._uU(20),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"td"),e.TgZ(23,"span",99),e._uU(24,"Usuario"),e.qZA(),e._uU(25),e.qZA(),e.TgZ(26,"td",101),e.TgZ(27,"span",99),e._uU(28,"Monto"),e.qZA(),e._uU(29),e.ALo(30,"moneda"),e.ALo(31,"number"),e.qZA(),e.TgZ(32,"td"),e.YNc(33,dt,4,6,"span",102),e.qZA(),e.YNc(34,mt,4,1,"td",103),e.qZA()),2&a){const t=n.$implicit,s=e.MAs(12),p=e.oxw();e.xp6(5),e.hij(" ",p.generarDescripcionMovimiento(t)," "),e.xp6(1),e.Q6J("ngIf",t.ticket),e.xp6(4),e.Q6J("ngIf",t.credito)("ngIfElse",s),e.xp6(6),e.hij(" ",t.estadoMovimiento,""),e.xp6(4),e.hij(" ",e.xi3(21,13,t.fechaMovimiento,"dd/MM/yyyy hh:mm a"),""),e.xp6(5),e.AsE(" ",null==t||null==t.usuario?null:t.usuario.nombres," ",null==t||null==t.usuario?null:t.usuario.apellidos,""),e.xp6(1),e.Q6J("ngClass",e.VKq(21,_t,t.credito)),e.xp6(3),e.AsE(" ",e.lcZ(30,16,t.monedaMovimientoCaja)," ",e.xi3(31,18,t.monto,"1.2-5"),""),e.xp6(4),e.Q6J("ngForOf",t.pagos),e.xp6(1),e.Q6J("ngIf",!p.cajaCerrada)}}const Ie=function(){return{width:"50vw"}},ht=function(){return{width:"80vw"}};class O{constructor(n,t,s,p,m,F,qe,ft,Ct,Zt,Tt,vt){this.cashRegisterService=n,this.loginService=t,this.router=s,this.ls=p,this.messageService=m,this.datePipe=F,this.store=qe,this.route=ft,this.breadcrumbService=Ct,this.sanitizer=Zt,this.currencyService=Tt,this.dialogService=vt,this.unsubscribe$=new j.xQ,this.fechaMaxima=new Date,this.configCompany={},this.cashRegisters=[],this.visibleAperturar=!1,this.visibleHistorialCierre=!1,this.visibleDetalleConcepto=!1,this.detailRegister={pagos:[]},this.tableIngresos=[],this.tableEgresos=[],this.detallesPorConcepto=[],this.turnos=[],this.tipoReporteCaja="REPORTE_CAJA"}ngOnInit(){this.configCompany$.pipe((0,A.R)(this.unsubscribe$)).subscribe(n=>{this.configCompany=n}),this.cashRegisterInput||this.breadcrumbService.setItems((0,Z.kn)(this.route)),this.fecha=new Date,this.validarEstacionVenta(),this.tiposReporteCaja=[{label:"A4",value:"REPORTE_CAJA",icon:"fa fa-print"},{label:"Ticket",value:"REPORTE_CAJA_TICKET",icon:"fa fa-print"}]}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}get cajasCerradas(){return!this.cashRegisters.filter(n=>n.estadoCaja===l.HE.APERTURADA).length}get nuevoTurno(){return this.cashRegisters.filter(n=>n.estadoCaja===l.HE.CERRADA).length+1}get cajaCerrada(){return this.cashRegister&&this.cashRegister.estadoCaja===l.HE.CERRADA}get montosTotalesIngresos(){return this.cashRegister.montosTotalesIngresos?this.cashRegister.montosTotalesIngresos:[]}get montosTotalesEgresos(){return this.cashRegister.montosTotalesEgresos?this.cashRegister.montosTotalesEgresos:[]}formatDateToString(){return this.datePipe.transform(this.fecha,"dd-MM-yyyy")}loadCashRegister(){if(this.visibleAperturar=!1,this.conceptoSelected=void 0,this.detallesPorConcepto=[],this.cashRegisterInput)this.cashRegisters=[this.cashRegisterInput],this.cashRegister=this.cashRegisterInput,this.turnoSelected=this.cashRegisterInput.turno,this.setTableIngresos(),this.setTableEgresos(),this.turnos=[{label:this.cashRegisterInput.turno,value:this.cashRegisterInput.turno}];else{const n=this.formatDateToString();this.cashRegisterService.findAll(["paginacion=false",`fecha=${n}`,`idPuntoVenta=${this.puntoVenta.id}`,`idEstacionVenta=${this.estacionVenta.id}`].join("&")).pipe((0,E.U)(s=>s)).subscribe(s=>{s.length?(this.cashRegisters=s,this.cashRegister=s.find(p=>p.estadoCaja===l.HE.APERTURADA)?s.find(p=>p.estadoCaja===l.HE.APERTURADA):s[0],this.turnoSelected=s[0].turno,this.setTableIngresos(),this.setTableEgresos(),this.turnos=s.map(p=>({label:p.turno,value:p.turno}))):(this.cashRegisters=[],this.cashRegister=void 0,this.turnos=[],this.turnoSelected=void 0)})}}setTableIngresos(){this.tableIngresos=[],this.cashRegister.montosAperturaCaja.forEach(n=>this.tableIngresos.push(Object.assign(Object.assign({},n),{codigo:`${n.tipo}${n.concepto}${n.moneda}`}))),this.cashRegister.montosVentas.forEach(n=>this.tableIngresos.push(Object.assign(Object.assign({},n),{codigo:`${n.tipo}${n.concepto}${n.moneda}`}))),this.cashRegister.montosOtrosIngresos.forEach(n=>this.tableIngresos.push(Object.assign(Object.assign({},n),{codigo:`${n.tipo}${n.concepto}${n.moneda}`})))}setTableEgresos(){this.tableEgresos=[],this.cashRegister.montosRetiroCaja.forEach(n=>this.tableEgresos.push(Object.assign(Object.assign({},n),{codigo:`${n.tipo}${n.concepto}${n.moneda}`}))),this.cashRegister.montosCompras.forEach(n=>this.tableEgresos.push(Object.assign(Object.assign({},n),{codigo:`${n.tipo}${n.concepto}${n.moneda}`}))),this.cashRegister.montosOtrosEgresos.forEach(n=>this.tableEgresos.push(Object.assign(Object.assign({},n),{codigo:`${n.tipo}${n.concepto}${n.moneda}`})))}onRowSelect(n){this.cashRegisterService.findAllDetails([`idCaja=${this.cashRegister.id}`,`tipo=${this.conceptoSelected.tipo}`,`concepto=${this.conceptoSelected.concepto}`,`moneda=${this.conceptoSelected.moneda}`].join("&")).subscribe(s=>{s.forEach(p=>{p.credito=p.ticket&&"CREDITO"===p.ticket.tipoVenta||p.compra&&"CREDITO"===p.compra.tipoCompra}),this.detallesPorConcepto=s,this.visibleDetalleConcepto=!0})}openDialogRegisterOtrosIngresos(){this.dialogService.open(M,{data:{tipoMovimientoCaja:l.Bb.INGRESO,conceptoMovimientoCaja:l._S.OTROS_INGRESOS,cashRegister:this.cashRegister},header:"Registrar ingreso",width:"800px"}).onClose.subscribe(t=>{t&&this.loadCashRegister()})}openDialogRegisterOtrosEgresos(){this.dialogService.open(M,{data:{tipoMovimientoCaja:l.Bb.EGRESO,conceptoMovimientoCaja:l._S.OTROS_EGRESOS,cashRegister:this.cashRegister},header:"Registrar egreso",width:"800px"}).onClose.subscribe(t=>{t&&this.loadCashRegister()})}openDialogRegisterRetiroCaja(){this.dialogService.open(M,{data:{tipoMovimientoCaja:l.Bb.EGRESO,conceptoMovimientoCaja:l._S.RETIRO_CAJA,cashRegister:this.cashRegister},header:"Registrar retiro de caja",width:"800px"}).onClose.subscribe(t=>{t&&this.loadCashRegister()})}get textButtonAddDetail(){return`Agregar ${this.conceptoSelected.nombre}`}generarDescripcionMovimiento(n){return n.ticket?`${n.descripcion}`:`${n.descripcion}${n.detalle?`(${n.detalle})`:""}`}get canCloseCashRegister(){return!this.cajaCerrada||this.loginService.hasPermission("CAJA_EDITAR_CIERRE")}closeCashRegister(){this.cashRegisterService.closeCashRegister(this.cashRegister.id,this.cashRegister.montosReales).subscribe(n=>this.loadCashRegister())}validarEstacionVenta(){this.puntoVenta$.pipe((0,A.R)(this.unsubscribe$)).subscribe(n=>{this.puntoVenta=n}),this.estacionVenta$.pipe((0,A.R)(this.unsubscribe$)).subscribe(n=>{this.estacionVenta=n,n&&this.loadCashRegister()})}openDialogUpdateCashRegisterDetail(n){this.dialogService.open(M,{data:{id:n.id,cashRegister:this.cashRegister},header:"Editar "+(n.tipoMovimientoCaja===l.Bb.INGRESO?"ingreso":"egreso"),width:"800px"}).onClose.subscribe(s=>{this.visibleDetalleConcepto=!1,s&&this.loadCashRegister()})}changeFechaApertura(n){this.fecha=n,this.loadCashRegister()}showModalNuevoTurno(){this.visibleAperturar=!0}changeTurno(){this.conceptoSelected=void 0,this.detallesPorConcepto=[],this.cashRegister=this.cashRegisters.find(n=>n.turno===this.turnoSelected),this.setTableEgresos(),this.setTableIngresos()}getCondicionCaja(n){return this.cashRegister.condicionesCaja&&this.cashRegister.condicionesCaja.find(t=>t.moneda===n)?this.cashRegister.condicionesCaja.find(t=>t.moneda===n).condicionCaja:""}openPdf(n,t){const p=this.estacionVenta.impresoraComprobante?this.estacionVenta.impresoraComprobante.anchoPapel:void 0;this.cashRegisterService.openPdf(this.cashRegister.id,[`moneda=${n}`,`tipo=${this.tipoReporteCaja}`,`detalle=${t}`].join("&"),{type:this.tipoReporteCaja,escPos:this.configCompany.imprimeTicketsEscPos,paperWidth:p}).subscribe(m=>{this.dialogService.open(b.Z,{data:{ordersPrint:[{pdfPrint:m,fnPrintQz:()=>{this.cashRegisterService.printInQz(this.configCompany.imprimeTicketsEscPos&&"REPORTE_CAJA_TICKET"===this.tipoReporteCaja?m.escPos:m.base64,this.estacionVenta.impresoraComprobante,this.configCompany.imprimeTicketsEscPos&&"REPORTE_CAJA_TICKET"===this.tipoReporteCaja)}}]},header:"Reporte de caja",width:"60%"})})}}O.\u0275fac=function(n){return new(n||O)(e.Y36(I.B),e.Y36(ie.r),e.Y36(B.F0),e.Y36(H.E),e.Y36(C.ez),e.Y36(R.uU),e.Y36(h.yh),e.Y36(B.gz),e.Y36(se.p),e.Y36(re.H7),e.Y36(J.i),e.Y36(D.xA))},O.\u0275cmp=e.Xpm({type:O,selectors:[["app-caja"]],inputs:{cashRegisterInput:"cashRegisterInput"},decls:18,vars:26,consts:[["aperturar",""],[4,"ngIf","ngIfElse"],["header","Nuevo turno",3,"modal","visible","baseZIndex","visibleChange"],[3,"turno","esTurno","changeFecha","aperturar"],["type","button","pButton","","icon","pi pi-times","label","Cerrar",1,"p-button-secondary",3,"click"],["header","Historial de cierre",3,"modal","visible","baseZIndex","visibleChange"],[3,"value",4,"ngIf"],["header","Detalle por concepto",3,"modal","visible","baseZIndex","visibleChange"],[3,"value","scrollable","responsive"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[3,"esTurno","changeFecha","aperturar"],[1,"grid"],[1,"col-12","md:col-6","sm:col-12","md:col-6"],[1,"col-12"],["header","INGRESOS"],["selectionMode","single","dataKey","codigo",3,"value","selection","selectionChange","onRowSelect"],["pTemplate","summary"],["class","p-shadow-1 mt-4",4,"ngIf"],["header","EGRESOS"],["header","CAJA"],[1,"grid","p-fluid"],[1,"col-6","md:col-3"],[2,"margin","0"],["class","col-6 md:col-3",4,"ngIf"],[3,"options","ngModel","ngModelChange"],[1,"col-6"],[4,"ngIf"],["dateFormat","dd/mm/yy",3,"readonlyInput","maxDate","ngModel","style","locale","onSelect","ngModelChange",4,"ngIf"],[3,"style","ngModel","options","onChange","ngModelChange",4,"ngIf"],[1,"col-6","sm:col-6","md:col-3"],["icon","fa fa-random","pButton","","type","button","label","Turno",3,"disabled","click",4,"ngIf"],["icon","fa fa-plus","pButton","","type","button","class","p-button-success","pTooltip","Registra un ingreso de dinero (Pagos de clientes, devoluciones de dinero, etc.)","label","Ingresos",3,"click",4,"ngIf"],["icon","fa fa-minus","pButton","","type","button","class","p-button-danger","pTooltip","Registra un egreso de dinero (Pagos a proveedores, servicios, comida, etc.)","label","Egresos",3,"click",4,"ngIf"],["icon","fa fa-minus","pButton","","type","button","class","p-button-warning","tooltipPosition","top","pTooltip","Registra un retiro de dinero (esto no es un egreso, es el dinero que se retira de la caja por seguridad.)","label","Retiro de caja",3,"click",4,"ngIf"],["class","col-6 sm:col-12 md:col-6",4,"ngFor","ngForOf"],[1,"grid",2,"margin-top","0.5rem"],["class","col-12 md:col-6",4,"ngFor","ngForOf"],[1,"col-12","md:col-6"],["type","button","pButton","","icon","fa fa-window-close-o","label","Cerrar caja",3,"disabled","click",4,"ngIf"],["type","button","pButton","","icon","fa fa-history","label","Historial de cierre",3,"click"],[3,"pSelectableRow"],[2,"text-align","right"],[4,"ngFor","ngForOf"],[1,"flex","justify-content-between","text-bold"],[1,"p-shadow-1","mt-4"],["legend","Ventas"],["class","flex justify-content-between text-bold",4,"ngFor","ngForOf"],[1,"saldo-label-blue"],[1,"saldo-monto"],[1,"saldo-label-red"],["pTooltip","Monto de venta a cr\xe9dito es informativo, no afecta al c\xe1lculo de la caja"],[1,"saldo-label-red","fila-credito"],["legend","Metodos de pago (Total de ingresos)"],["legend","Compras"],["pTooltip","Monto de compra a cr\xe9dito es informativo, no afecta al c\xe1lculo de la caja"],["legend","Metodos de pago (Total de egresos)"],[1,"text-bold"],["dateFormat","dd/mm/yy",3,"readonlyInput","maxDate","ngModel","locale","onSelect","ngModelChange"],[3,"ngModel","options","onChange","ngModelChange"],["pTemplate","selectedItem"],[2,"vertical-align","middle","margin-left",".5em"],["icon","fa fa-random","pButton","","type","button","label","Turno",3,"disabled","click"],["icon","fa fa-plus","pButton","","type","button","pTooltip","Registra un ingreso de dinero (Pagos de clientes, devoluciones de dinero, etc.)","label","Ingresos",1,"p-button-success",3,"click"],["icon","fa fa-minus","pButton","","type","button","pTooltip","Registra un egreso de dinero (Pagos a proveedores, servicios, comida, etc.)","label","Egresos",1,"p-button-danger",3,"click"],["icon","fa fa-minus","pButton","","type","button","tooltipPosition","top","pTooltip","Registra un retiro de dinero (esto no es un egreso, es el dinero que se retira de la caja por seguridad.)","label","Retiro de caja",1,"p-button-warning",3,"click"],[1,"col-6","sm:col-12","md:col-6"],[1,"grid","flex","justify-content-center","align-content-center"],[1,"col"],[1,"saldo-label"],[1,"col-fixed",2,"width","100px"],["pTooltip","Imprimir reporte","type","button","pButton","","icon","fa fa-print",1,"p-button-secondary",2,"margin-right","0.2em","margin-left","0.2em","cursor","pointer",3,"click"],["pTooltip","Imprimir reporte detallado","type","button","pButton","","icon","fa fa-print",1,"p-button-secondary",2,"margin-right","0.2em","margin-left","0.2em","cursor","pointer",3,"click"],[2,"margin-bottom","0.5rem","margin-top","0"],["style","width: 100%;","type","text","pKeyFilter","num","pInputText","",3,"ngModel","ngModelChange",4,"ngIf"],["style","margin-top: 0.5rem",4,"ngIf"],["type","text","pKeyFilter","num","pInputText","",2,"width","100%",3,"ngModel","ngModelChange"],[2,"margin-top","0.5rem"],["severity","success",3,"text",4,"ngIf"],["severity","warn",3,"text",4,"ngIf"],["severity","error",3,"text",4,"ngIf"],["severity","success",3,"text"],["severity","warn",3,"text"],["severity","error",3,"text"],["type","button","pButton","","icon","fa fa-window-close-o","label","Cerrar caja",3,"disabled","click"],[3,"value"],["pSortableColumn","descripcion"],["field","descripcion"],["pSortableColumn","credito"],["field","credito"],["pSortableColumn","estadoMovimiento"],["field","estadoMovimiento"],["pSortableColumn","fechaMovimiento"],["field","fechaMovimiento"],["pSortableColumn","usuario"],["field","usuario"],["pSortableColumn","monto",2,"text-align","right"],["field","monto"],[1,"p-column-title"],["nocredito",""],[2,"text-align","right",3,"ngClass"],["class","p-tag p-tag-rounded m-1",4,"ngFor","ngForOf"],["style","text-align: center",4,"ngIf"],[1,"p-tag","p-tag-rounded","m-1"],[2,"text-align","center"],["style","margin-right: 0.2em; margin-left: 0.2em; cursor: pointer;","pTooltip","EDITAR","class","pi pi-pencil",3,"click",4,"ngIf"],["pTooltip","EDITAR",1,"pi","pi-pencil",2,"margin-right","0.2em","margin-left","0.2em","cursor","pointer",3,"click"]],template:function(n,t){if(1&n&&(e.YNc(0,fe,1,1,"ng-template",null,0,e.W1O),e.YNc(2,et,68,27,"p-card",1),e.TgZ(3,"p-dialog",2),e.NdJ("visibleChange",function(p){return t.visibleAperturar=p}),e.TgZ(4,"app-aperturar-caja",3),e.NdJ("changeFecha",function(p){return t.changeFechaApertura(p)})("aperturar",function(){return t.loadCashRegister()}),e.qZA(),e.TgZ(5,"p-footer"),e.TgZ(6,"button",4),e.NdJ("click",function(){return t.visibleAperturar=!1}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"p-dialog",5),e.NdJ("visibleChange",function(p){return t.visibleHistorialCierre=p}),e.YNc(8,nt,3,1,"p-table",6),e.TgZ(9,"p-footer"),e.TgZ(10,"button",4),e.NdJ("click",function(){return t.visibleHistorialCierre=!1}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"p-dialog",7),e.NdJ("visibleChange",function(p){return t.visibleDetalleConcepto=p}),e.TgZ(12,"p-table",8),e.YNc(13,at,2,4,"ng-template",9),e.YNc(14,st,22,1,"ng-template",10),e.YNc(15,ut,35,23,"ng-template",11),e.qZA(),e.TgZ(16,"p-footer"),e.TgZ(17,"button",4),e.NdJ("click",function(){return t.visibleDetalleConcepto=!1}),e.qZA(),e.qZA(),e.qZA()),2&n){const s=e.MAs(1);e.xp6(2),e.Q6J("ngIf",t.cashRegister)("ngIfElse",s),e.xp6(1),e.Akn(e.DdM(23,Ie)),e.Q6J("modal",!0)("visible",t.visibleAperturar)("baseZIndex",1e4),e.xp6(1),e.Q6J("turno",t.nuevoTurno)("esTurno",!0),e.xp6(3),e.Akn(e.DdM(24,Ie)),e.Q6J("modal",!0)("visible",t.visibleHistorialCierre)("baseZIndex",1e4),e.xp6(1),e.Q6J("ngIf",t.cashRegister),e.xp6(3),e.Akn(e.DdM(25,ht)),e.Q6J("modal",!0)("visible",t.visibleDetalleConcepto)("baseZIndex",1e4),e.xp6(1),e.Q6J("value",t.detallesPorConcepto)("scrollable",!0)("responsive",!0)}},directives:[y,R.O5,q.Z,ge.s,S.iA,C.jx,S.Ei,R.sg,me.p,_e.u,ue.UN,u.JJ,u.On,z.f,L.Lt,Q.Hq,u.Fj,Y.Fr,$.o,P.q,w.V,C.$_,S.lQ,S.fz,R.mk],pipes:[U.x,V.s,R.JJ,he.Z,R.uU],styles:[".fila-credito[_ngcontent-%COMP%]{color:#c91d1d;text-decoration:line-through}"]}),(0,_.gn)([(0,h.Ph)(f.Z.getOffice)],O.prototype,"puntoVenta$",void 0),(0,_.gn)([(0,h.Ph)(f.Z.getSaleStation)],O.prototype,"estacionVenta$",void 0),(0,_.gn)([(0,h.Ph)(f.Z.getConfig)],O.prototype,"configCompany$",void 0)},77966:(N,x,i)=>{i.d(x,{x:()=>l});var _=i(5e3);let l=(()=>{class Z{transform(f,j){switch(f){case"APERTURA_CAJA":return"Apertura de caja";case"VENTAS":return"Ventas contado";case"OTROS_INGRESOS":return"Otros ingresos";case"COMPRAS":return"Compras contado";case"OTROS_EGRESOS":return"Otros egresos";case"RETIRO_CAJA":return"Retiros de caja";default:return""}}}return Z.\u0275fac=function(f){return new(f||Z)},Z.\u0275pipe=_.Yjl({name:"conceptoMovimiento",type:Z,pure:!0}),Z})()}}]);