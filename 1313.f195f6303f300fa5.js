"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[1313],{94855:(X,N,a)=>{a.d(N,{j:()=>Z});var m=a(5e3),A=a(45330),C=a(35308);let f=(()=>{class c{constructor(l,e){this.config=l,this.ref=e}ngOnInit(){}productSaved(l){this.ref.close(l)}}return c.\u0275fac=function(l){return new(l||c)(m.Y36(A.S),m.Y36(A.E7))},c.\u0275cmp=m.Xpm({type:c,selectors:[["app-modal-producto"]],decls:1,vars:1,consts:[[3,"isModal","saveProduct"]],template:function(l,e){1&l&&(m.TgZ(0,"app-producto",0),m.NdJ("saveProduct",function(h){return e.productSaved(h)}),m.qZA()),2&l&&m.Q6J("isModal",!0)},directives:[C.g],styles:[""]}),c})();var q=a(4119),d=a(40845);let Z=(()=>{class c{constructor(l){this.dialogService=l,this.selectProduct=new m.vpe}ngOnInit(){}openModalRegisterProduct(){this.dialogService.open(f,{header:"Registrar producto",width:"80%"}).onClose.subscribe(e=>{e&&this.selectProduct.emit(e)})}}return c.\u0275fac=function(l){return new(l||c)(m.Y36(A.xA))},c.\u0275cmp=m.Xpm({type:c,selectors:[["app-button-new-product"]],outputs:{selectProduct:"selectProduct"},decls:1,vars:0,consts:[["tooltipPosition","top","pTooltip","Nuevo producto","pButton","","type","button","icon","pi pi-plus-circle",1,"p-button-success",3,"click"]],template:function(l,e){1&l&&(m.TgZ(0,"button",0),m.NdJ("click",function(){return e.openModalRegisterProduct()}),m.qZA())},directives:[q.u,d.Hq],styles:[""]}),c})()},61313:(X,N,a)=>{a.r(N),a.d(N,{ComprasModule:()=>Lo});var m=a(74202),A=a(54578),C=a(70655),f=a(85932),q=a(8929),d=a(82817),Z=a(81575),c=a(24850),g=a(7625),l=a(92340),e=a(5e3),u=a(69808),h=a(59783),$=a(2314),W=a(40520);let V=(()=>{class r{constructor(o){this.http=o,this.baseUrl=l.N.endpointApi}findAll(o){return this.http.get(`${this.baseUrl}/purchases?${o}`)}findAllPage(o){return this.findAll(o).pipe((0,c.U)(n=>n))}findAllList(o){return this.findAll(o).pipe((0,c.U)(n=>n))}findById(o){return this.http.get(`${this.baseUrl}/purchases/${o}`)}save(o){return this.http.post(`${this.baseUrl}/purchases`,o)}update(o){return this.http.put(`${this.baseUrl}/purchases`,o)}cancel(o,n){return this.http.delete(`${this.baseUrl}/purchases/${o}?motivoAnulacion=${n}`)}deleteItem(o){return this.http.delete(`${this.baseUrl}/purchases/items/${o}`)}}return r.\u0275fac=function(o){return new(o||r)(e.LFG(W.eN))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var O=a(20207),ee=a(33379),E=a(10303),L=a(24394),R=a(47745),J=a(74297),p=a(93075),B=a(75652),j=a(14036),S=a(31424),D=a(98952),w=a(40845),oe=a(5766),z=a(4119),M=a(77121);function te(r,t){1&r&&(e.TgZ(0,"tr"),e.TgZ(1,"th"),e._uU(2,"Cantidad"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Producto"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Precio de compra"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Importe total"),e.qZA(),e.qZA())}function re(r,t){if(1&r&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.ALo(7,"montoDinero"),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.ALo(10,"montoDinero"),e.qZA(),e.qZA()),2&r){const o=t.$implicit,n=e.oxw();e.xp6(2),e.Oqu(o.cantidad),e.xp6(2),e.Oqu(null==o||null==o.producto?null:o.producto.nombre),e.xp6(2),e.Oqu(e.xi3(7,4,o.precioCompra,n.compra.codigoMoneda)),e.xp6(3),e.Oqu(e.xi3(10,7,o.importeTotal,n.compra.codigoMoneda))}}let ne=(()=>{class r{constructor(){}ngOnInit(){}}return r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-compra-detalle"]],inputs:{compra:"compra"},decls:5,vars:1,consts:[[1,"grid","p-fluid"],[1,"col-12"],[3,"value"],["pTemplate","header"],["pTemplate","body"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"p-table",2),e.YNc(3,te,9,0,"ng-template",3),e.YNc(4,re,11,10,"ng-template",4),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Q6J("value",n.compra.items))},directives:[D.iA,h.jx],pipes:[M.Z],styles:[""]}),r})();var k=a(15315),ie=a(73407);const ae=["dt"];function pe(r,t){if(1&r&&(e.TgZ(0,"th"),e._uU(1),e.qZA()),2&r){const o=t.$implicit;e.xp6(1),e.hij(" ",o.header," ")}}function se(r,t){if(1&r&&(e.TgZ(0,"tr"),e._UZ(1,"th",26),e.YNc(2,pe,2,1,"th",27),e.qZA()),2&r){const o=t.$implicit;e.xp6(2),e.Q6J("ngForOf",o)}}function me(r,t){if(1&r){const o=e.EpF();e.TgZ(0,"div",28),e.TgZ(1,"span",29),e.TgZ(2,"button",30),e.NdJ("click",function(){return e.CHM(o),e.oxw().nuevo()}),e.qZA(),e.qZA(),e.TgZ(3,"span",29),e._UZ(4,"app-actions",31),e.qZA(),e.qZA()}if(2&r){const o=e.oxw();e.xp6(4),e.Q6J("items",o.actionsExportData)}}function le(r,t){if(1&r&&(e.ynx(0),e.TgZ(1,"span",41),e._uU(2,"Comprobante"),e.qZA(),e._uU(3),e.ALo(4,"tipoDocumento"),e.TgZ(5,"span",42),e._uU(6),e.qZA(),e.BQk()),2&r){const o=e.oxw(2).$implicit,n=e.oxw().$implicit;e.xp6(3),e.hij(" ",e.lcZ(4,2,n.tipoComprobante)," "),e.xp6(3),e.Oqu(n[o.field])}}function ce(r,t){if(1&r&&(e.ynx(0),e.TgZ(1,"span",41),e._uU(2,"Punto de Venta"),e.qZA(),e._uU(3),e.BQk()),2&r){const o=e.oxw(3).$implicit;e.xp6(3),e.hij(" ",null==o.puntoVenta?null:o.puntoVenta.nombre," ")}}function de(r,t){if(1&r&&(e.ynx(0),e.TgZ(1,"span",41),e._uU(2,"Proveedor"),e.qZA(),e._uU(3),e.BQk()),2&r){const o=e.oxw(3).$implicit;e.xp6(3),e.hij(" ",null==o.proveedor?null:o.proveedor.razonSocial," ")}}function ue(r,t){if(1&r&&(e.ynx(0),e.TgZ(1,"span",41),e._uU(2,"Usuario"),e.qZA(),e._uU(3),e.BQk()),2&r){const o=e.oxw(3).$implicit;e.xp6(3),e.hij(" ",null==o.usuario?null:o.usuario.nombreCompleto," ")}}function ge(r,t){if(1&r&&(e.ynx(0),e.TgZ(1,"span",41),e._uU(2,"Fecha"),e.qZA(),e._uU(3),e.ALo(4,"date"),e.BQk()),2&r){const o=e.oxw(2).$implicit,n=e.oxw().$implicit;e.xp6(3),e.hij(" ",e.xi3(4,1,n[o.field],"dd/MM/yyyy hh:mm a")," ")}}function he(r,t){if(1&r&&(e.ynx(0),e.TgZ(1,"span",41),e._uU(2,"Total"),e.qZA(),e._uU(3),e.ALo(4,"montoDinero"),e.BQk()),2&r){const o=e.oxw(2).$implicit,n=e.oxw().$implicit;e.xp6(3),e.hij(" ",e.xi3(4,1,n[o.field],n.codigoMoneda)," ")}}function fe(r,t){if(1&r&&(e.TgZ(0,"span",45),e._uU(1,"Si"),e.qZA()),2&r){const o=e.oxw(4).$implicit;e.Q6J("pTooltip",o.motivoAnulacion)}}function _e(r,t){1&r&&(e.TgZ(0,"span"),e._uU(1,"No"),e.qZA())}function Ce(r,t){if(1&r&&(e.ynx(0,43),e.TgZ(1,"span",41),e._uU(2,"Anulado"),e.qZA(),e.YNc(3,fe,2,1,"span",44),e.YNc(4,_e,2,0,"span",36),e.BQk()),2&r){const o=e.oxw(2).$implicit,n=e.oxw().$implicit;e.xp6(3),e.Q6J("ngIf",n[o.field]),e.xp6(1),e.Q6J("ngIf",!n[o.field])}}function Ze(r,t){if(1&r&&(e.ynx(0),e._uU(1),e.BQk()),2&r){const o=e.oxw(2).$implicit,n=e.oxw().$implicit;e.xp6(1),e.hij(" ",n[o.field]," ")}}function ve(r,t){1&r&&(e.ynx(0),e.YNc(1,le,7,4,"ng-container",38),e.YNc(2,ce,4,1,"ng-container",38),e.YNc(3,de,4,1,"ng-container",38),e.YNc(4,ue,4,1,"ng-container",38),e.YNc(5,ge,5,4,"ng-container",38),e.YNc(6,he,5,4,"ng-container",38),e.YNc(7,Ce,5,2,"ng-container",39),e.YNc(8,Ze,2,1,"ng-container",40),e.BQk()),2&r&&(e.xp6(1),e.Q6J("ngSwitchCase","comprobante"),e.xp6(1),e.Q6J("ngSwitchCase","puntoVenta"),e.xp6(1),e.Q6J("ngSwitchCase","proveedor"),e.xp6(1),e.Q6J("ngSwitchCase","usuario"),e.xp6(1),e.Q6J("ngSwitchCase","fecha"),e.xp6(1),e.Q6J("ngSwitchCase","totalCompra"),e.xp6(1),e.Q6J("ngSwitchCase","anulado"))}function Te(r,t){if(1&r){const o=e.EpF();e.ynx(0,43),e.TgZ(1,"span",41),e._uU(2,"Acciones"),e.qZA(),e.TgZ(3,"button",46),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(2).$implicit;return e.oxw().goEditPurchase(i)}),e.qZA(),e.TgZ(4,"button",47),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(2).$implicit;return e.oxw().showModalAnular(i)}),e.qZA(),e.TgZ(5,"button",48),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(2).$implicit;return e.oxw().openPdf(i)}),e.qZA(),e.BQk()}if(2&r){const o=e.oxw(2).$implicit;e.xp6(3),e.Q6J("disabled",o.anulado),e.xp6(1),e.Q6J("disabled",o.anulado)}}function Ae(r,t){if(1&r&&(e.TgZ(0,"td",35),e.YNc(1,ve,9,7,"ng-container",36),e.YNc(2,Te,6,2,"ng-container",37),e.qZA()),2&r){const o=t.$implicit;e.Q6J("ngSwitch",o.field),e.xp6(1),e.Q6J("ngIf",!o.isActions),e.xp6(1),e.Q6J("ngIf",o.isActions)}}function be(r,t){if(1&r&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e.TgZ(2,"a",32),e._UZ(3,"i",33),e.qZA(),e.qZA(),e.YNc(4,Ae,3,3,"td",34),e.qZA()),2&r){const o=t.expanded,n=t.$implicit,i=t.columns;e.xp6(2),e.Q6J("pRowToggler",n),e.xp6(1),e.Q6J("ngClass",o?"pi pi-chevron-down":"pi pi-chevron-right"),e.xp6(1),e.Q6J("ngForOf",i)}}function Pe(r,t){if(1&r&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e._UZ(2,"app-compra-detalle",49),e.qZA(),e.qZA()),2&r){const o=t.$implicit,n=t.columns;e.xp6(1),e.uIk("colspan",n.length+1),e.xp6(1),e.Q6J("compra",o)}}const b=function(){return{width:"100%"}},qe=function(){return{width:"450px",minWidth:"200px"}};class P{constructor(t,o,n,i,s,T,x,I,y,F,U,Y){this.route=t,this.router=o,this.datePipe=n,this.messageService=i,this.tdPipe=s,this.confirmationService=T,this.purchaseService=x,this.loginService=I,this.userService=y,this.supplierService=F,this.ls=U,this.breadcrumbService=Y,this.unsubscribe$=new q.xQ,this.purchases=[],this.perPage=10,this.puntosVenta=[],this.compraAnular={},this.visibleAnular=!1}ngOnInit(){this.loadSuppliers(),this.breadcrumbService.setItems((0,d.kn)(this.route)),this.validarPuntoVenta(),this.puntosVenta=this.loginService.getPuntosVentaUsuario();const t=new Date;this.filtroDesde=new Date(t.getFullYear(),t.getMonth(),1),this.filtroHasta=new Date(t.getFullYear(),t.getMonth()+1,0),this.cols=[{field:"comprobante",header:"Comprobante"},{field:"puntoVenta",header:"Punto de venta"},{field:"proveedor",header:"Proveedor"},{field:"fecha",header:"Fecha"},{field:"usuario",header:"Usuario"},{field:"totalCompra",header:"Total"},{field:"anulado",header:"Anulado"},{header:"Acciones",isActions:!0}]}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}loadSuppliers(){this.supplierService.findAllList(["paginacion=false"].join("&")).pipe((0,c.U)(o=>o.map(n=>({label:n.razonSocial,value:n.id})))).subscribe(o=>this.proveedores=o)}validarPuntoVenta(){this.puntoVenta$.pipe((0,g.R)(this.unsubscribe$)).subscribe(t=>{this.filtroPuntoVenta=t,this.resetAndRefreshTable()})}resetAndRefreshTable(){this.tabla.reset(),this.refreshTable()}refreshTable(){this.lastLazyLoadEvent&&this.loadLazy(this.lastLazyLoadEvent)}loadLazy(t){this.lastLazyLoadEvent=t;const n=["pageNumber="+t.first/this.perPage,`perPage=${t.rows}`,"paginacion=true"];this.filtroDesde&&n.push(`desde=${this.datePipe.transform(this.filtroDesde,"dd-MM-yyyy")}`),this.filtroHasta&&n.push(`hasta=${this.datePipe.transform(this.filtroHasta,"dd-MM-yyyy")}`),this.filtroPuntoVenta&&n.push(`idPuntoVenta=${this.filtroPuntoVenta.id}`),this.filtroTipoComprobante&&n.push(`tipoComprobante=${this.filtroTipoComprobante}`),this.filtroComprobante&&n.push(`comprobante=${this.filtroComprobante}`),this.tipoCompra&&n.push(`tipoCompra=${this.tipoCompra}`),this.filtroProveedor&&n.push(`idProveedor=${this.filtroProveedor}`),t.sortOrder&&n.push(`sortOrder=${t.sortOrder}`),t.sortField&&n.push(`sortField=${t.sortField}`),this.setUrlsExport(n),this.purchaseService.findAllPage(n.join("&")).subscribe(i=>{this.totalRecords=i.totalElements,this.purchases=i.content})}nuevo(){this.router.navigateByUrl("/compras/nueva-compra")}showModalAnular(t){this.compraAnular.motivoAnulacion="",this.compraAnular=t,this.visibleAnular=!0}goAnularCompra(){this.purchaseService.cancel(this.compraAnular.id,this.compraAnular.motivoAnulacion).subscribe(()=>{this.visibleAnular=!1,this.messageService.add({severity:"success",summary:"Mensaje",detail:"Compra anulada correctamente."})})}goEditPurchase(t){this.router.navigateByUrl(`/compras/editar-compra/${t.id}`)}openPdf(t){(0,d.UU)(`${l.N.endpointApi}/public/pdf/purchases/${t.uuid}.pdf`)}setUrlsExport(t){const o=this.loginService.getUser().empresa.uuid,n=`${l.N.endpointApi}/public/export-data/${o}/purchases`,i=[...t,"tipoReporte=NORMAL"],s=[...t,"tipoReporte=DETALLADO"];this.actionsExportData=[{icon:"fa fa-file-excel-o",label:"Exportar a excel",url:`${n}.xlsx?${i.join("&")}`},{icon:"fa fa-file-pdf-o",label:"Exportar a pdf",url:`${n}.pdf?${i.join("&")}`},{icon:"fa fa-file-excel-o",label:"Exportar a excel detallado",url:`${n}.xlsx?${s.join("&")}`},{icon:"fa fa-file-pdf-o",label:"Exportar a pdf detallado",url:`${n}.pdf?${s.join("&")}`}]}}P.\u0275fac=function(t){return new(t||P)(e.Y36(m.gz),e.Y36(m.F0),e.Y36(u.uU),e.Y36(h.ez),e.Y36($.B),e.Y36(h.YP),e.Y36(V),e.Y36(O.r),e.Y36(ee.i),e.Y36(E.p),e.Y36(L.E),e.Y36(R.p))},P.\u0275cmp=e.Xpm({type:P,selectors:[["app-compras"]],viewQuery:function(t,o){if(1&t&&e.Gf(ae,7),2&t){let n;e.iGM(n=e.CRH())&&(o.tabla=n.first)}},decls:51,vars:56,consts:[[1,"grid"],[1,"col-12"],[3,"submit"],[1,"grid","p-fluid"],[1,"col-12","md:col-2"],[1,"label-form"],["name","filtroDesde","dateFormat","dd/mm/yy",3,"ngModel","locale","onSelect","ngModelChange"],["name","filtroHasta","dateFormat","dd/mm/yy",3,"ngModel","locale","onSelect","ngModelChange"],["dataKey","id","placeholder","Seleccione...","optionLabel","nombre","name","puntoVenta",3,"ngModel","showClear","options","onChange","ngModelChange"],[1,"col-12","md:col-3"],["name","tipoComprobante","placeholder","Selecciona tipo comprobante",3,"showClear","ngModel","options","ngModelChange","onChange"],["placeholder","Comprobante","name","comprobante","type","text","pInputText","",2,"width","100%",3,"ngModel","ngModelChange","input"],[1,"col-6","md:col-2","lg:col-1"],["name","tipoCompra","filter","true","placeholder","Seleccione tipo venta",3,"showClear","ngModel","options","onChange","ngModelChange"],["filter","true","name","proveedor","name","proveedor","placeholder","Selecciona proveedor",3,"ngModel","showClear","options","onChange","ngModelChange"],[1,"col-12",2,"padding-top","1.5rem"],["dataKey","id",3,"columns","value","lazy","paginator","rows","totalRecords","responsive","autoLayout","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","summary"],["pTemplate","body"],["pTemplate","rowexpansion"],["header","Anulaci\xf3n de compra",3,"visible","modal","responsive","minY","visibleChange"],["placeholder","Motivo de anulaci\xf3n","rows","5","cols","30","pInputTextarea","",3,"ngModel","ngModelChange"],["pButton","","type","button","label","Cancelar",1,"p-button-secondary",3,"click"],["pButton","","type","button","label","Anular",1,"p-button-warning",3,"disabled","click"],[2,"width","3em"],[4,"ngFor","ngForOf"],[2,"text-align","left"],[1,"m-1"],["type","button","pButton","","icon","fa fa-plus","label","Nuevo",3,"click"],[3,"items"],["href","#",3,"pRowToggler"],[3,"ngClass"],[3,"ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngIf"],["style","text-align: center",4,"ngIf"],[4,"ngSwitchCase"],["style","text-align: center",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"p-column-title"],[1,"text-bold",2,"color","#0041dc"],[2,"text-align","center"],[3,"pTooltip",4,"ngIf"],[3,"pTooltip"],["pButton","","icon","pi pi-pencil","pTooltip","EDITAR",1,"p-button-warning",2,"margin-right","0.2em","margin-left","0.2em","cursor","pointer","margin-bottom","4px",3,"disabled","click"],["pButton","","icon","fa fa-ban","pTooltip","ANULAR",1,"p-button-danger",2,"margin-right","0.2em","margin-left","0.2em","cursor","pointer","margin-bottom","4px",3,"disabled","click"],["pTooltip","Exportar Pdf de compra","type","button","pButton","","icon","fa fa-file-pdf-o",1,"p-button-secondary",2,"margin-right","0.2em","margin-left","0.2em","cursor","pointer","margin-bottom","4px",3,"click"],[3,"compra"]],template:function(t,o){1&t&&(e.TgZ(0,"p-card"),e.TgZ(1,"div",0),e.TgZ(2,"div",1),e.TgZ(3,"form",2),e.NdJ("submit",function(){return o.refreshTable()}),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e.TgZ(6,"label",5),e._uU(7,"Desde"),e.qZA(),e.TgZ(8,"p-calendar",6),e.NdJ("onSelect",function(){return o.refreshTable()})("ngModelChange",function(i){return o.filtroDesde=i}),e.qZA(),e.qZA(),e.TgZ(9,"div",4),e.TgZ(10,"label",5),e._uU(11,"Hasta"),e.qZA(),e.TgZ(12,"p-calendar",7),e.NdJ("onSelect",function(){return o.refreshTable()})("ngModelChange",function(i){return o.filtroHasta=i}),e.qZA(),e.qZA(),e.TgZ(13,"div",4),e.TgZ(14,"label",5),e._uU(15,"Punto de venta"),e.qZA(),e.TgZ(16,"p-dropdown",8),e.NdJ("onChange",function(){return o.refreshTable()})("ngModelChange",function(i){return o.filtroPuntoVenta=i}),e.qZA(),e.qZA(),e.TgZ(17,"div",9),e.TgZ(18,"label",5),e._uU(19,"Tipo comprobante "),e.qZA(),e.TgZ(20,"p-dropdown",10),e.NdJ("ngModelChange",function(i){return o.filtroTipoComprobante=i})("onChange",function(){return o.refreshTable()}),e.qZA(),e.qZA(),e.TgZ(21,"div",9),e.TgZ(22,"label",5),e._uU(23,"Comprobante"),e.qZA(),e.TgZ(24,"input",11),e.NdJ("ngModelChange",function(i){return o.filtroComprobante=i})("input",function(){return o.refreshTable()}),e.qZA(),e.qZA(),e.TgZ(25,"div",12),e.TgZ(26,"label",5),e._uU(27,"Tipo compra"),e.qZA(),e.TgZ(28,"p-dropdown",13),e.NdJ("onChange",function(){return o.resetAndRefreshTable()})("ngModelChange",function(i){return o.tipoCompra=i}),e.qZA(),e.qZA(),e.TgZ(29,"div",9),e.TgZ(30,"label",5),e._uU(31,"Proveedor"),e.qZA(),e.TgZ(32,"p-dropdown",14),e.NdJ("onChange",function(){return o.refreshTable()})("ngModelChange",function(i){return o.filtroProveedor=i}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(33,"div",0),e.TgZ(34,"div",15),e.TgZ(35,"p-table",16,17),e.NdJ("onLazyLoad",function(i){return o.loadLazy(i)}),e.YNc(37,se,3,1,"ng-template",18),e.YNc(38,me,5,1,"ng-template",19),e.YNc(39,be,5,3,"ng-template",20),e.YNc(40,Pe,3,2,"ng-template",21),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(41,"p-dialog",22),e.NdJ("visibleChange",function(i){return o.visibleAnular=i}),e.TgZ(42,"div",3),e.TgZ(43,"div",1),e.TgZ(44,"label",5),e._uU(45),e.ALo(46,"tipoDocumento"),e.qZA(),e.TgZ(47,"textarea",23),e.NdJ("ngModelChange",function(i){return o.compraAnular.motivoAnulacion=i}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(48,"p-footer"),e.TgZ(49,"button",24),e.NdJ("click",function(){return o.visibleAnular=!1}),e.qZA(),e.TgZ(50,"button",25),e.NdJ("click",function(){return o.goAnularCompra()}),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(8),e.Akn(e.DdM(49,b)),e.Q6J("ngModel",o.filtroDesde)("locale",o.ls.calendarEs),e.xp6(4),e.Akn(e.DdM(50,b)),e.Q6J("ngModel",o.filtroHasta)("locale",o.ls.calendarEs),e.xp6(4),e.Akn(e.DdM(51,b)),e.Q6J("ngModel",o.filtroPuntoVenta)("showClear",!0)("options",o.puntosVenta),e.xp6(4),e.Akn(e.DdM(52,b)),e.Q6J("showClear",!0)("ngModel",o.filtroTipoComprobante)("options",o.ls.tipoComprobantesVenta),e.xp6(4),e.Q6J("ngModel",o.filtroComprobante),e.xp6(4),e.Akn(e.DdM(53,b)),e.Q6J("showClear",!0)("ngModel",o.tipoCompra)("options",o.ls.tiposVenta),e.xp6(4),e.Akn(e.DdM(54,b)),e.Q6J("ngModel",o.filtroProveedor)("showClear",!0)("options",o.proveedores),e.xp6(3),e.Q6J("columns",o.cols)("value",o.purchases)("lazy",!0)("paginator",!0)("rows",o.perPage)("totalRecords",o.totalRecords)("responsive",!0)("autoLayout",!0),e.xp6(6),e.Akn(e.DdM(55,qe)),e.Q6J("visible",o.visibleAnular)("modal",!0)("responsive",!0)("minY",70),e.xp6(4),e.AsE("",e.lcZ(46,47,null==o.compraAnular?null:o.compraAnular.tipoComprobante)," ",null==o.compraAnular?null:o.compraAnular.comprobante," "),e.xp6(2),e.Q6J("ngModel",o.compraAnular.motivoAnulacion),e.xp6(3),e.Q6J("disabled",!(null!=o.compraAnular&&o.compraAnular.motivoAnulacion)))},directives:[J.Z,p._Y,p.JL,p.F,B.f,p.JJ,p.On,j.Lt,p.Fj,S.o,D.iA,h.jx,u.sg,w.Hq,oe.h,D.jB,u.mk,u.RF,u.O5,u.n9,z.u,u.ED,ne,k.V,ie.g,h.$_],pipes:[$.B,u.uU,M.Z],styles:[""]}),(0,C.gn)([(0,f.Ph)(Z.Z.getOffice)],P.prototype,"puntoVenta$",void 0);var xe=a(2994),H=a(21602),Ie=a(2385),G=a(80422),K=a(43724),ye=a(17102),Fe=a(12145),Ue=a(75875),Ne=a(94855),Me=a(85450),Ve=a(1203),Je=a(8735),Se=a(12216),De=a(45223),we=a(18872),Qe=a(9757),Ye=a(20657),$e=a(65987),Oe=a(42841),Ee=a(26614),Le=a(55361),Re=a(80267);const Be=["cantidadInput"];function je(r,t){1&r&&(e.TgZ(0,"span"),e._uU(1,"Si"),e.qZA())}function ze(r,t){1&r&&e._uU(0,"No")}function ke(r,t){if(1&r&&(e.TgZ(0,"div",16),e.TgZ(1,"label",4),e._uU(2,"Precio de compra "),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"p",13),e._uU(6),e.ALo(7,"montoDinero"),e.qZA(),e.qZA()),2&r){const o=e.oxw();e.xp6(4),e.hij("x ",o.unitLabelSale,""),e.xp6(2),e.Oqu(e.xi3(7,2,o.precioCompraPorPiezaProduct,null==o.producto?null:o.producto.moneda))}}function He(r,t){1&r&&(e.TgZ(0,"span"),e._uU(1,"Si"),e.qZA())}function Ge(r,t){1&r&&e._uU(0,"No")}function Ke(r,t){if(1&r&&(e.TgZ(0,"label",4),e._uU(1,"Punto de venta"),e.qZA(),e.TgZ(2,"p",13),e._uU(3),e.qZA()),2&r){const o=e.oxw().$implicit;e.xp6(3),e.Oqu(null==o.puntoVenta?null:o.puntoVenta.nombre)}}function Xe(r,t){if(1&r&&(e.TgZ(0,"div",1),e.TgZ(1,"p-card"),e.YNc(2,Ke,4,1,"ng-template",49),e.TgZ(3,"label",4),e._uU(4,"Tipo"),e.qZA(),e.TgZ(5,"p",13),e._uU(6),e.ALo(7,"tipoPrecio"),e.qZA(),e.TgZ(8,"label",4),e._uU(9,"Margen utilidad"),e.qZA(),e.TgZ(10,"p",13),e._uU(11),e.qZA(),e.TgZ(12,"label",4),e._uU(13,"Precio"),e.qZA(),e.TgZ(14,"p",50),e._uU(15),e.ALo(16,"montoDinero"),e.qZA(),e.qZA(),e.qZA()),2&r){const o=t.$implicit,n=e.oxw();e.xp6(2),e.Q6J("ngIf",o.puntoVenta),e.xp6(4),e.hij("(",e.lcZ(7,4,o.tipoPrecio),")"),e.xp6(5),e.hij("",o.margenUtilidad," %"),e.xp6(4),e.Oqu(e.xi3(16,6,o.precio,null==n.producto?null:n.producto.moneda))}}function We(r,t){1&r&&e._UZ(0,"p-message",51)}function eo(r,t){1&r&&e._UZ(0,"p-message",52)}function oo(r,t){1&r&&e._UZ(0,"p-message",53)}const to=function(){return{width:"100px"}};function ro(r,t){if(1&r){const o=e.EpF();e.TgZ(0,"div",26),e.TgZ(1,"label",4),e._uU(2,"Inc. impuestos"),e.qZA(),e.TgZ(3,"div"),e.TgZ(4,"p-toggleButton",54),e.NdJ("onChange",function(){return e.CHM(o),e.oxw().changePurchasePriceTemp()}),e.qZA(),e.qZA(),e.qZA()}2&r&&(e.xp6(4),e.Akn(e.DdM(2,to)))}function no(r,t){1&r&&e._UZ(0,"p-message",53)}function io(r,t){if(1&r&&(e.TgZ(0,"div",12),e.TgZ(1,"label",4),e._uU(2,"Precio de compra "),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"p"),e._uU(6),e.qZA(),e.qZA()),2&r){const o=e.oxw();e.xp6(4),e.hij("x ",o.unitLabelSale,""),e.xp6(2),e.Oqu(o.precioCompraPorPiezaForm)}}function ao(r,t){if(1&r&&(e.TgZ(0,"div",12),e.TgZ(1,"label",4),e._uU(2,"Precio de compra neto "),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"p"),e._uU(6),e.qZA(),e.qZA()),2&r){const o=e.oxw();e.xp6(4),e.hij("x ",o.unitLabelSale,""),e.xp6(2),e.Oqu(o.precioCompraPorPiezaNeto)}}function po(r,t){1&r&&(e.TgZ(0,"div",39),e.TgZ(1,"p",40),e._uU(2,"Punto de venta"),e.qZA(),e.qZA())}function so(r,t){1&r&&e._UZ(0,"p-message",61)}function mo(r,t){1&r&&e._UZ(0,"p-message",62)}function lo(r,t){1&r&&e._UZ(0,"p-message",63)}function co(r,t){if(1&r){const o=e.EpF();e.TgZ(0,"div",55),e.TgZ(1,"div",56),e.TgZ(2,"app-precio-producto",57),e.NdJ("deletePrice",function(i){return e.CHM(o),e.oxw().deleteProductPrice(i)}),e.qZA(),e.YNc(3,so,1,0,"p-message",58),e.YNc(4,mo,1,0,"p-message",59),e.YNc(5,lo,1,0,"p-message",60),e.qZA(),e.qZA()}if(2&r){const o=t.$implicit,n=t.index,i=e.oxw();e.xp6(1),e.Q6J("formGroupName",n),e.xp6(1),e.Q6J("index",n)("valorIgv",i.configCompany.igv)("precioCompraPorPieza",i.precioCompraPorPiezaForm)("igv",i.igvForm)("preciosPorPuntoVenta",null==i.producto?null:i.producto.preciosPorPuntoVenta),e.xp6(1),e.Q6J("ngIf",o.get("precioVenta").touched&&(null==o.get("precioVenta").errors?null:o.get("precioVenta").errors.precio)),e.xp6(1),e.Q6J("ngIf",o.get("precioVenta").touched&&(null==o.get("precioVenta").errors?null:o.get("precioVenta").errors.tipoPrecio)),e.xp6(1),e.Q6J("ngIf",o.get("precioVenta").touched&&(null==o.get("precioVenta").errors?null:o.get("precioVenta").errors.unidadesMayoreo))}}const uo=function(){return{width:"100%",minHeight:"300px",height:"95vh"}};class v{constructor(t,o,n,i,s,T,x,I,y,F){this.fb=t,this.unitCodeService=o,this.ticketService=n,this.productPriceService=i,this.productService=s,this.messageService=T,this.loginService=x,this.confirmationService=I,this.purchaseService=y,this.currencyService=F,this.unsubscribe$=new q.xQ,this.configCompany={},this.visibleModal=!1,this.unitCodes=[],this.puntosVenta=[],this.disabled=!1,this.delete=new e.vpe,this.onChange=U=>{},this.onTouched=U=>{}}ngOnInit(){this.puntosVenta=this.loginService.getPuntosVentaUsuario(),this.configCompany$.pipe((0,g.R)(this.unsubscribe$)).subscribe(t=>{this.configCompany=t}),this.validarPuntoVenta(),this.builderForm(),this.findUnitCodes()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}get preciosVentaActuales(){return this.producto?this.producto.preciosVenta.filter(t=>(0,d.Ak)(t,this.producto.preciosPorPuntoVenta)):[]}get equalUnits(){return this.producto&&this.producto.unidadCompra.codigo===this.producto.unidad.codigo}get igvForm(){return this.producto&&this.producto.igv}get precioCompraPorPiezaForm(){const{factor:t,precioCompra:o}=this.modelForm.getRawValue();if(t&&o){const n=Number(o)/Number(t);return this.currencyService.exchange({codigoMonedaOrigen:this.monedaCompra,codigoMonedaDestino:this.producto.moneda,montoOrigen:n})}return 0}get precioCompraPorPiezaProduct(){if(this.producto){const{factor:t,precioCompra:o}=this.producto;return t&&o?Number(o)/Number(t):0}return 0}get precioCompraPorPiezaNeto(){const{factor:t,precioCompraNeto:o}=this.modelForm.getRawValue();return t&&o?Number(o)/Number(t):0}get modelFormItemsProductPrices(){return this.modelForm.get("preciosVenta")}get unitLabelPurchase(){const t=this.unitCodes.find(o=>this.producto&&o.id===this.producto.unidadCompra.id);if(t)return t.descripcion}get unitLabelSale(){const t=this.unitCodes.find(o=>this.producto&&o.id===this.producto.unidad.id);if(t)return t.descripcion}builderForm(){this.modelForm=this.fb.group({cantidad:[void 0,[p.kI.required]],factor:[void 0,[p.kI.required]],precioCompraTemporal:[void 0,[p.kI.required]],precioCompraIncImp:[!0,[]],precioCompra:[void 0,[]],precioCompraNeto:[{value:void 0,disabled:!0},[]],preciosVenta:this.fb.array([])})}validarPuntoVenta(){this.puntoVenta$.pipe((0,g.R)(this.unsubscribe$)).subscribe(t=>{this.puntoVenta=t,this.producto&&this.producto.preciosPorPuntoVenta&&this.reloadPricesProduct()})}findUnitCodes(){this.unitCodeService.findAll(["porEmpresa=true"].join("&")).subscribe(o=>{this.unitCodes=o})}changePurchasePriceTemp(){const{igv:t}=this.producto;let o=this.modelForm.getRawValue().precioCompraTemporal;const n=this.modelForm.getRawValue().precioCompraIncImp;o||(o=0),this.modelForm.patchValue(t?n?{precioCompraNeto:Number(o)/(1+this.configCompany.igv),precioCompra:Number(o)}:{precioCompraNeto:Number(o),precioCompra:Number(o)*(1+this.configCompany.igv)}:{precioCompraNeto:Number(o),precioCompra:Number(o)})}reloadPricesProduct(){this.modelForm.get("preciosVenta").clear(),this.loadPricesProduct()}loadPricesProduct(t){const o=i=>{this.addProductPrice(Object.assign({tipoPrecio:"POR_DEFECTO"},this.producto.preciosPorPuntoVenta&&{puntoVenta:i||this.puntoVenta}))},n=i=>{(i=i.filter(s=>(0,d.Ak)(s,this.producto.preciosPorPuntoVenta))).forEach(s=>this.addProductPrice(s)),!this.producto.preciosPorPuntoVenta&&!i.find(s=>"POR_DEFECTO"===s.tipoPrecio)&&o(),this.producto.preciosPorPuntoVenta&&this.puntosVenta.forEach(s=>{i.find(T=>"POR_DEFECTO"===T.tipoPrecio&&T.puntoVenta.id===s.id)||o(s)})};void 0!==t?n(t):this.productPriceService.findAll([`idProduct=${this.producto.id}`].join("&")).subscribe(s=>{n(s)})}addProductPrice(t){this.modelForm.get("preciosVenta").push(this.createItemFormProductPrice(t||Object.assign({},this.producto.preciosPorPuntoVenta&&{puntoVenta:this.puntoVenta})))}deleteProductPrice(t){const o=this.modelForm.get("preciosVenta");o.length>0&&(o.at(t).value.precioVenta.id?this.productPriceService.deleteById(o.at(t).value.precioVenta.id).subscribe(()=>this.reloadPricesProduct()):o.removeAt(t))}createItemFormProductPrice(t){return this.fb.group({precioVenta:[t,[p.kI.required,d.kt]]})}doDelete(){this.confirmationService.confirm({message:`\xbfEst\xe1 seguro de eliminar el item de compra "${this.producto.nombre}"?`,accept:()=>{this.itemCompra.id?this.purchaseService.deleteItem(this.itemCompra.id).subscribe(()=>this.delete.emit(this.index)):this.delete.emit(this.index)},acceptLabel:"Si",rejectLabel:"No"})}propagateChange(){this.formToModel(),this.onChange(this.itemCompra)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}writeValue(t){void 0!==t&&(this.itemCompra=t,this.initItem(),this.onChange(t))}initItem(){this.productService.findById(this.itemCompra.producto.id).subscribe(t=>{this.producto=t;const o=this.itemCompra.producto.precioCompraIncImp,n=this.currencyService.exchange({codigoMonedaOrigen:this.producto.moneda,codigoMonedaDestino:this.monedaCompra,montoOrigen:this.itemCompra.producto.precioCompra});this.modelForm.patchValue({factor:this.itemCompra.producto.factor,precioCompraIncImp:o,precioCompraTemporal:n}),this.itemCompra.isEdit?this.modelForm.patchValue({cantidad:this.itemCompra.cantidad,precioCompraTemporal:n,factor:this.itemCompra.factor}):(this.visibleModal=!0,setTimeout(()=>{this.cantidadInput.nativeElement.focus()},30)),this.itemCompra.producto.unidad.codigo===this.itemCompra.producto.unidadCompra.codigo&&this.modelForm.get("factor").disable(),this.changePurchasePriceTemp(),this.loadPricesProduct(this.itemCompra.producto.preciosVenta)})}aceptarItemCompra(){(0,d.c2)(this.modelForm),this.modelForm.valid?(this.propagateChange(),this.visibleModal=!1):this.messageService.add({severity:"error",summary:"Error",detail:"Complete campos obligatorios (*)"})}cerrarModalItemCompra(){this.visibleModal=!1,this.onTouched(!0),this.propagateChange()}formToModel(){const t=this.modelForm.getRawValue();console.log(t),this.itemCompra.factor=t.factor,this.itemCompra.cantidad=t.cantidad,this.itemCompra.precioCompra=t.precioCompra,this.itemCompra.precioCompraNeto=t.precioCompraNeto,this.itemCompra.producto.precioCompra=this.currencyService.exchange({codigoMonedaOrigen:this.monedaCompra,codigoMonedaDestino:this.producto.moneda,montoOrigen:t.precioCompra}),this.itemCompra.producto.precioCompraNeto=this.itemCompra.producto.precioCompraNeto=this.currencyService.exchange({codigoMonedaOrigen:this.monedaCompra,codigoMonedaDestino:this.producto.moneda,montoOrigen:t.precioCompraNeto}),this.itemCompra.producto.monedaReferencial=this.monedaCompra,this.itemCompra.producto.precioCompraReferencial=t.precioCompra,this.itemCompra.producto.factor=t.factor,this.itemCompra.producto.precioCompraIncImp=t.precioCompraIncImp,this.itemCompra.producto.preciosVenta=[],this.itemCompra.importeTotal=this.itemCompra.cantidad*this.itemCompra.precioCompra,t.preciosVenta.forEach(o=>this.itemCompra.producto.preciosVenta.push(o.precioVenta))}}v.\u0275fac=function(t){return new(t||v)(e.Y36(p.qu),e.Y36(Me.t),e.Y36(Ve.w),e.Y36(Je.o),e.Y36(Se.M),e.Y36(h.ez),e.Y36(O.r),e.Y36(h.YP),e.Y36(V),e.Y36(H.i))},v.\u0275cmp=e.Xpm({type:v,selectors:[["app-item-compra"]],viewQuery:function(t,o){if(1&t&&e.Gf(Be,5),2&t){let n;e.iGM(n=e.CRH())&&(o.cantidadInput=n.first)}},inputs:{monedaCompra:"monedaCompra",disabled:"disabled",index:"index"},outputs:{delete:"delete"},features:[e._Bn([{provide:p.JU,useExisting:(0,e.Gpc)(()=>v),multi:!0}])],decls:183,vars:59,consts:[[1,"grid"],[1,"col"],[1,"grid","p-fluid"],[1,"col-3"],[1,"label-form","text-bold"],[1,"col-fixed",2,"width","120px"],["pTooltip","Editar","pButton","","type","button","icon","pi pi-window-maximize",1,"m-1",3,"click"],["pTooltip","Eliminar","pButton","","type","button","icon","pi pi-trash",1,"p-button-danger","m-1",3,"click"],["appendTo","body",3,"visible","fullScreen","showCloseIcon","closeOnEscape","visibleChange"],[2,"padding","1rem"],[1,"col-12","md:col-6"],["legend","Informaci\xf3n de producto"],[1,"col-6","md:col-2"],[1,"mt-0"],[1,"col-6","md:col-6"],["mostrar","button",3,"producto"],[1,"col-6","md:col-4"],[4,"ngIf","ngIfElse"],["noIgv",""],["class","col-6 md:col-4",4,"ngIf"],["legend","Precios de venta"],[1,"col-12"],["noPreciosPorPuntoVenta",""],["class","col",4,"ngFor","ngForOf"],["novalidate","",3,"formGroup"],["legend","Detalle de compra"],[1,"col-4","md:col-2"],[1,"col-4","md:col-1"],["pKeyFilter","money","formControlName","cantidad","id","cantidad","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["cantidadInput",""],["severity","error","text","Ingrese cantidad",4,"ngIf"],["pKeyFilter","money","formControlName","factor","id","factor","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em",3,"readOnly"],["severity","error","text","Ingrese factor",4,"ngIf"],["pKeyFilter","money","formControlName","precioCompraTemporal","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em",3,"input"],["severity","error","text","Ingrese precio de compra",4,"ngIf"],["class","col-4 md:col-2",4,"ngIf"],["pKeyFilter","money","formControlName","precioCompraNeto","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["class","col-6 md:col-2",4,"ngIf"],[1,"col-fixed","pricing-block",2,"width","200px"],[1,"pricing-div"],[1,"right"],["class","pricing-div",4,"ngIf"],["formArrayName","preciosVenta","class","col-fixed","style","width:180px",4,"ngFor","ngForOf"],[1,"center"],["pButton","","icon","pi pi-plus",1,"p-button-success",3,"click"],[1,"col-12",2,"text-align","right"],["pButton","","type","button","label","Eliminar item",1,"p-button-danger","m-1",2,"width","120px","margin-top","5px","margin-bottom","5px",3,"click"],["pButton","","type","button","label","Cerrar",1,"p-button-secondary","m-1",2,"width","80px","margin-top","5px","margin-bottom","5px",3,"click"],["pButton","","type","button","label","Aceptar",1,"m-1",2,"width","80px","margin-top","5px","margin-bottom","5px",3,"click"],[3,"ngIf"],[1,"mt-0","mb-0"],["severity","error","text","Ingrese cantidad"],["severity","error","text","Ingrese factor"],["severity","error","text","Ingrese precio de compra"],["formControlName","precioCompraIncImp","onLabel","Si","offLabel","No",3,"onChange"],["formArrayName","preciosVenta",1,"col-fixed",2,"width","180px"],[3,"formGroupName"],["formControlName","precioVenta",3,"index","valorIgv","precioCompraPorPieza","igv","preciosPorPuntoVenta","deletePrice"],["severity","error","text","Ingrese precio",4,"ngIf"],["severity","error","text","Ingrese tipo de precio",4,"ngIf"],["severity","error","text","Ingrese unidades de mayoreo",4,"ngIf"],["severity","error","text","Ingrese precio"],["severity","error","text","Ingrese tipo de precio"],["severity","error","text","Ingrese unidades de mayoreo"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"div",3),e.TgZ(4,"label",4),e._uU(5,"Cantidad"),e.qZA(),e._uU(6),e.qZA(),e.TgZ(7,"div",3),e.TgZ(8,"label",4),e._uU(9,"Descripci\xf3n"),e.qZA(),e._uU(10),e.qZA(),e.TgZ(11,"div",3),e.TgZ(12,"label",4),e._uU(13,"Precio de compra "),e.TgZ(14,"strong"),e._uU(15),e.qZA(),e.qZA(),e._uU(16),e.ALo(17,"montoDinero"),e.qZA(),e.TgZ(18,"div",3),e.TgZ(19,"label",4),e._uU(20,"Importe"),e.qZA(),e._uU(21),e.ALo(22,"montoDinero"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(23,"div",5),e.TgZ(24,"button",6),e.NdJ("click",function(){return o.visibleModal=!0}),e.qZA(),e.TgZ(25,"button",7),e.NdJ("click",function(){return o.doDelete()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(26,"p-sidebar",8),e.NdJ("visibleChange",function(i){return o.visibleModal=i}),e.TgZ(27,"p-scrollPanel"),e.TgZ(28,"div",9),e.TgZ(29,"div",2),e.TgZ(30,"div",10),e.TgZ(31,"p-fieldset",11),e.TgZ(32,"div",2),e.TgZ(33,"div",12),e.TgZ(34,"label",4),e._uU(35,"C\xf3digo barra"),e.qZA(),e.TgZ(36,"p",13),e._uU(37),e.qZA(),e.qZA(),e.TgZ(38,"div",12),e.TgZ(39,"label",4),e._uU(40,"C\xf3digo"),e.qZA(),e.TgZ(41,"p",13),e._uU(42),e.qZA(),e.qZA(),e.TgZ(43,"div",14),e.TgZ(44,"label",4),e._uU(45,"Descripci\xf3n"),e.qZA(),e.TgZ(46,"p",13),e._uU(47),e.qZA(),e.qZA(),e.TgZ(48,"div",12),e.TgZ(49,"label",4),e._uU(50,"Stock"),e.qZA(),e.TgZ(51,"p",13),e._UZ(52,"app-mostrar-stock",15),e.qZA(),e.qZA(),e.TgZ(53,"div",12),e.TgZ(54,"label",4),e._uU(55,"Factor"),e.qZA(),e.TgZ(56,"p",13),e._uU(57),e.qZA(),e.qZA(),e.TgZ(58,"div",16),e.TgZ(59,"label",4),e._uU(60,"Unidad de compra"),e.qZA(),e.TgZ(61,"p",13),e._uU(62),e.qZA(),e.qZA(),e.TgZ(63,"div",16),e.TgZ(64,"label",4),e._uU(65,"Unidad de venta"),e.qZA(),e.TgZ(66,"p",13),e._uU(67),e.qZA(),e.qZA(),e.TgZ(68,"div",12),e.TgZ(69,"label",4),e._uU(70,"Moneda"),e.qZA(),e.TgZ(71,"p",13),e._uU(72),e.qZA(),e.qZA(),e.TgZ(73,"div",12),e.TgZ(74,"label",4),e._uU(75,"Igv"),e.qZA(),e.TgZ(76,"p",13),e.YNc(77,je,2,0,"span",17),e.YNc(78,ze,1,0,"ng-template",null,18,e.W1O),e.qZA(),e.qZA(),e.TgZ(80,"div",16),e.TgZ(81,"label",4),e._uU(82,"Precio de compra "),e.TgZ(83,"strong"),e._uU(84),e.qZA(),e.qZA(),e.TgZ(85,"p",13),e._uU(86),e.ALo(87,"montoDinero"),e.qZA(),e.qZA(),e.YNc(88,ke,8,5,"div",19),e.qZA(),e.qZA(),e.qZA(),e.TgZ(89,"div",10),e.TgZ(90,"p-fieldset",20),e.TgZ(91,"div",2),e.TgZ(92,"div",21),e.TgZ(93,"label",4),e._uU(94,"Precios por punto de venta"),e.qZA(),e.TgZ(95,"p",13),e.YNc(96,He,2,0,"span",17),e.YNc(97,Ge,1,0,"ng-template",null,22,e.W1O),e.qZA(),e.qZA(),e.TgZ(99,"div",21),e.TgZ(100,"div",2),e.YNc(101,Xe,17,9,"div",23),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(102,"div",21),e.TgZ(103,"form",24),e.TgZ(104,"p-fieldset",25),e.TgZ(105,"div",0),e.TgZ(106,"div",26),e.TgZ(107,"label",4),e._uU(108,"Moneda de compra"),e.qZA(),e.TgZ(109,"p",13),e._uU(110),e.qZA(),e.qZA(),e.TgZ(111,"div",27),e.TgZ(112,"label",4),e._uU(113,"Cantidad "),e.qZA(),e._UZ(114,"input",28,29),e.YNc(116,We,1,0,"p-message",30),e.qZA(),e.TgZ(117,"div",27),e.TgZ(118,"label",4),e._uU(119,"Factor "),e.qZA(),e._UZ(120,"input",31),e.YNc(121,eo,1,0,"p-message",32),e.qZA(),e.TgZ(122,"div",12),e.TgZ(123,"label",4),e._uU(124,"Precio de compra "),e.TgZ(125,"strong"),e._uU(126),e.qZA(),e._uU(127),e.ALo(128,"moneda"),e.qZA(),e.TgZ(129,"input",33),e.NdJ("input",function(){return o.changePurchasePriceTemp()}),e.qZA(),e.YNc(130,oo,1,0,"p-message",34),e.qZA(),e.YNc(131,ro,5,3,"div",35),e.TgZ(132,"div",12),e.TgZ(133,"label",4),e._uU(134,"Precio de compra neto "),e.TgZ(135,"strong"),e._uU(136),e.qZA(),e.qZA(),e._UZ(137,"input",36),e.YNc(138,no,1,0,"p-message",34),e.qZA(),e.YNc(139,io,7,2,"div",37),e.YNc(140,ao,7,2,"div",37),e.TgZ(141,"div",21),e.TgZ(142,"label",4),e._uU(143),e.ALo(144,"moneda"),e.qZA(),e.TgZ(145,"div",0),e.TgZ(146,"div",38),e.TgZ(147,"div",39),e.TgZ(148,"p",40),e._uU(149,"Nro. Precio"),e.qZA(),e.qZA(),e.TgZ(150,"div",39),e.TgZ(151,"p",40),e._uU(152,"Nombre"),e.qZA(),e.qZA(),e.YNc(153,po,3,0,"div",41),e.TgZ(154,"div",39),e.TgZ(155,"p",40),e._uU(156,"% Utilidad"),e.qZA(),e.qZA(),e.TgZ(157,"div",39),e.TgZ(158,"p",40),e._uU(159,"Precio venta neto"),e.qZA(),e.qZA(),e.TgZ(160,"div",39),e.TgZ(161,"p",40),e._uU(162,"Precio venta"),e.qZA(),e.qZA(),e.TgZ(163,"div",39),e.TgZ(164,"p",40),e._uU(165,"Unidades mayoreo"),e.qZA(),e.qZA(),e.TgZ(166,"div",39),e.TgZ(167,"p",40),e._uU(168,"Tipo precio"),e.qZA(),e.qZA(),e.qZA(),e.YNc(169,co,6,9,"div",42),e.TgZ(170,"div",38),e._UZ(171,"div",39),e._UZ(172,"div",39),e._UZ(173,"div",39),e.TgZ(174,"div",39),e.TgZ(175,"div",43),e.TgZ(176,"button",44),e.NdJ("click",function(){return o.addProductPrice()}),e.qZA(),e.qZA(),e.qZA(),e._UZ(177,"div",39),e._UZ(178,"div",39),e.qZA(),e.qZA(),e.qZA(),e.TgZ(179,"div",45),e.TgZ(180,"button",46),e.NdJ("click",function(){return o.doDelete()}),e.qZA(),e.TgZ(181,"button",47),e.NdJ("click",function(){return o.cerrarModalItemCompra()}),e.qZA(),e.TgZ(182,"button",48),e.NdJ("click",function(){return o.aceptarItemCompra()}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t){const n=e.MAs(79),i=e.MAs(98);e.xp6(6),e.hij(" ",o.itemCompra.cantidad," "),e.xp6(4),e.hij(" ",null==o.itemCompra.producto?null:o.itemCompra.producto.nombre," "),e.xp6(5),e.hij("x ",o.unitLabelPurchase,""),e.xp6(1),e.hij(" ",e.xi3(17,43,o.itemCompra.precioCompra,o.monedaCompra)," "),e.xp6(5),e.hij(" ",e.xi3(22,46,o.itemCompra.importeTotal,o.monedaCompra)," "),e.xp6(5),e.Q6J("visible",o.visibleModal)("fullScreen",!0)("showCloseIcon",!1)("closeOnEscape",!1),e.xp6(1),e.Akn(e.DdM(58,uo)),e.xp6(10),e.Oqu(null==o.producto?null:o.producto.codigoBarra),e.xp6(5),e.Oqu(null==o.producto?null:o.producto.codigo),e.xp6(5),e.Oqu(null==o.producto?null:o.producto.nombre),e.xp6(5),e.Q6J("producto",o.producto),e.xp6(5),e.Oqu(null==o.producto?null:o.producto.factor),e.xp6(5),e.Oqu(null==o.producto||null==o.producto.unidadCompra?null:o.producto.unidadCompra.descripcion),e.xp6(5),e.Oqu(null==o.producto||null==o.producto.unidad?null:o.producto.unidad.descripcion),e.xp6(5),e.Oqu(null==o.producto?null:o.producto.moneda),e.xp6(5),e.Q6J("ngIf",null==o.producto?null:o.producto.igv)("ngIfElse",n),e.xp6(7),e.hij("x ",o.unitLabelPurchase,""),e.xp6(2),e.Oqu(e.xi3(87,49,null==o.producto?null:o.producto.precioCompra,null==o.producto?null:o.producto.moneda)),e.xp6(2),e.Q6J("ngIf",!o.equalUnits),e.xp6(8),e.Q6J("ngIf",null==o.itemCompra.producto?null:o.itemCompra.producto.preciosPorPuntoVenta)("ngIfElse",i),e.xp6(5),e.Q6J("ngForOf",o.preciosVentaActuales),e.xp6(2),e.Q6J("formGroup",o.modelForm),e.xp6(7),e.Oqu(o.monedaCompra),e.xp6(6),e.Q6J("ngIf",o.modelForm.get("cantidad").touched&&(null==o.modelForm.get("cantidad").errors?null:o.modelForm.get("cantidad").errors.required)),e.xp6(4),e.Q6J("readOnly",o.equalUnits),e.xp6(1),e.Q6J("ngIf",o.modelForm.get("factor").touched&&(null==o.modelForm.get("factor").errors?null:o.modelForm.get("factor").errors.required)),e.xp6(5),e.hij("x ",o.unitLabelPurchase,""),e.xp6(1),e.hij(" (",e.xi3(128,52,o.monedaCompra,"simbolo"),")"),e.xp6(3),e.Q6J("ngIf",o.modelForm.get("precioCompraTemporal").touched&&(null==o.modelForm.get("precioCompraTemporal").errors?null:o.modelForm.get("precioCompraTemporal").errors.required)),e.xp6(1),e.Q6J("ngIf",o.igvForm),e.xp6(5),e.hij("x ",o.unitLabelPurchase,""),e.xp6(2),e.Q6J("ngIf",o.modelForm.get("precioCompraNeto").touched&&(null==o.modelForm.get("precioCompraNeto").errors?null:o.modelForm.get("precioCompraNeto").errors.required)),e.xp6(1),e.Q6J("ngIf",!o.equalUnits),e.xp6(1),e.Q6J("ngIf",!o.equalUnits),e.xp6(3),e.hij("Nuevos precios de venta (",e.xi3(144,55,null==o.producto?null:o.producto.moneda,"simbolo"),")"),e.xp6(10),e.Q6J("ngIf",null==o.itemCompra.producto?null:o.itemCompra.producto.preciosPorPuntoVenta),e.xp6(16),e.Q6J("ngForOf",o.modelFormItemsProductPrices.controls)}},directives:[z.u,w.Hq,De.Y,we.P,G.p,Qe.d,u.O5,u.sg,J.Z,p._Y,p.JL,p.sg,p.Fj,Ye.Fr,p.JJ,p.u,S.o,K.q,$e.H,Oe.CO,p.CE,p.x0,Ee.R],pipes:[M.Z,Le.l,Re.s],styles:[""]}),(0,C.gn)([(0,f.Ph)(Z.Z.getConfig)],v.prototype,"configCompany$",void 0),(0,C.gn)([(0,f.Ph)(Z.Z.getOffice)],v.prototype,"puntoVenta$",void 0);var go=a(68297);function ho(r,t){1&r&&e._UZ(0,"p-message",41)}function fo(r,t){1&r&&e._UZ(0,"p-message",42)}function _o(r,t){1&r&&e._UZ(0,"p-message",43)}function Co(r,t){1&r&&e._UZ(0,"p-message",44)}function Zo(r,t){1&r&&e._UZ(0,"p-message",45)}function vo(r,t){if(1&r&&e._uU(0),2&r){const o=t.$implicit;e.AsE(" ",o.numeroDocumento," - ",o.razonSocial," ")}}function To(r,t){1&r&&e._UZ(0,"p-message",46)}function Ao(r,t){1&r&&e._UZ(0,"p-message",55)}function bo(r,t){1&r&&e._UZ(0,"p-message",56)}function Po(r,t){1&r&&e._UZ(0,"p-message",57)}function qo(r,t){1&r&&e._UZ(0,"p-message",58)}function xo(r,t){if(1&r){const o=e.EpF();e.TgZ(0,"div",47),e.TgZ(1,"div",48),e.TgZ(2,"div",49),e.TgZ(3,"p-card"),e.TgZ(4,"app-item-compra",50),e.NdJ("delete",function(i){return e.CHM(o),e.oxw().deleteItem(i)}),e.qZA(),e.YNc(5,Ao,1,0,"p-message",51),e.YNc(6,bo,1,0,"p-message",52),e.YNc(7,Po,1,0,"p-message",53),e.YNc(8,qo,1,0,"p-message",54),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&r){const o=t.$implicit,n=t.index,i=e.oxw();e.xp6(1),e.Q6J("formGroupName",n),e.xp6(3),e.Q6J("monedaCompra",null==i.modelForm||null==i.modelForm.value?null:i.modelForm.value.codigoMoneda)("index",n),e.xp6(1),e.Q6J("ngIf",o.get("itemCompra").touched&&(null==o.get("itemCompra").errors?null:o.get("itemCompra").errors.cantidad)),e.xp6(1),e.Q6J("ngIf",o.get("itemCompra").touched&&(null==o.get("itemCompra").errors?null:o.get("itemCompra").errors.factor)),e.xp6(1),e.Q6J("ngIf",o.get("itemCompra").touched&&(null==o.get("itemCompra").errors?null:o.get("itemCompra").errors.precioCompra)),e.xp6(1),e.Q6J("ngIf",o.get("itemCompra").touched&&(null==o.get("itemCompra").errors?null:o.get("itemCompra").errors.preciosVenta))}}function Io(r,t){1&r&&e._UZ(0,"p-message",59)}function yo(r,t){if(1&r&&(e.TgZ(0,"h1",60),e._uU(1),e.ALo(2,"montoDinero"),e.qZA()),2&r){const o=e.oxw();e.xp6(1),e.hij("Cambio: ",e.xi3(2,1,o.cambioFormaPago,o.modelForm.get("codigoMoneda").value),"")}}function Fo(r,t){1&r&&e._UZ(0,"p-message",63)}function Uo(r,t){if(1&r){const o=e.EpF();e.TgZ(0,"div",2),e.TgZ(1,"p-selectButton",61),e.NdJ("onChange",function(){return e.CHM(o),e.oxw().onChangeTipoCompra()}),e.qZA(),e.YNc(2,Fo,1,0,"p-message",62),e.qZA()}if(2&r){const o=e.oxw();e.xp6(1),e.Q6J("options",o.listas.tiposVenta),e.xp6(1),e.Q6J("ngIf",o.modelForm.get("tipoCompra").touched&&(null==o.modelForm.get("tipoCompra").errors?null:o.modelForm.get("tipoCompra").errors.required))}}function No(r,t){1&r&&e._UZ(0,"p-message",66)}function Mo(r,t){if(1&r&&(e.TgZ(0,"div",23),e._UZ(1,"app-forma-pago-venta",64),e.YNc(2,No,1,0,"p-message",65),e.qZA()),2&r){const o=e.oxw();e.xp6(1),e.Q6J("total",o.importeTotalCompra)("moneda",o.modelForm.get("codigoMoneda").value),e.xp6(1),e.Q6J("ngIf",o.modelForm.get("pagos").touched&&(null==o.modelForm.get("pagos").errors?null:o.modelForm.get("pagos").errors.totalFormaPago))}}const Q=function(){return{width:"100%"}},Vo=function(){return{width:"600px",minWidth:"350px"}},Jo=r=>r.value?r.value.cantidad?r.value.factor?r.value.precioCompra?r.value.producto.preciosVenta?r.value.producto.preciosVenta.find(t=>!t.precio)||r.value.producto.preciosVenta.find(t=>!t.tipoPrecio)||r.value.producto.preciosVenta.find(t=>"MAYOREO"===t.tipoPrecio&&!t.unidadesMayoreo)?{preciosVenta:!0}:null:{preciosVenta:!0}:{precioCompra:!0}:{factor:!0}:{cantidad:!0}:null;class _{constructor(t,o,n,i,s,T,x,I,y,F,U,Y){this.route=t,this.router=o,this.store=n,this.breadcrumbService=i,this.fb=s,this.purchaseService=T,this.listas=x,this.supplierService=I,this.messageService=y,this.confirmationService=F,this.currencyService=U,this.consultaDocumentoService=Y,this.unsubscribe$=new q.xQ,this.monedas=[],this.dialogRegister=!1,this.configCompany={},this.filteredSuppliers=[]}get modelFormItems(){return this.modelForm.get("items")}get importeTotalCompra(){return this.modelFormItems.getRawValue().map(t=>t.itemCompra.importeTotal).reduce(d.IH,0)}ngOnInit(){this.aditionalParamsSearchProduct=["tipo=INSUMO","tipo=ARTICULO"],this.breadcrumbService.setItems((0,d.kn)(this.route)),this.configCompany$.pipe((0,g.R)(this.unsubscribe$)).subscribe(t=>{this.configCompany=t,this.builderForm(),this.loadCurrencies(),this.loadSuppliers(),this.storeSubscripcion(),this.loadTicketIsEdit()})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}storeSubscripcion(){this.puntoVenta$.pipe((0,g.R)(this.unsubscribe$)).subscribe(t=>{this.puntoVenta=t,this.clearItems()}),this.estacionVenta$.pipe((0,g.R)(this.unsubscribe$)).subscribe(t=>{this.estacionVenta=t})}clearItems(){this.modelFormItems.clear()}loadSuppliers(){this.supplierService.findAllList(["paginacion=false"].join("&")).pipe((0,c.U)(o=>o.map(n=>({label:n.razonSocial,value:n.id})))).subscribe(o=>this.proveedores=o)}builderForm(){this.modelForm=this.fb.group({tipoCompra:["CONTADO",[p.kI.required]],pagos:[void 0,[]],tipoComprobante:["01",[p.kI.required]],comprobante:[void 0,[p.kI.required]],fecha:[new Date,[p.kI.required]],codigoMoneda:[void 0,[p.kI.required]],proveedor:[void 0,[p.kI.required]],numeroDocumentoProveedor:[void 0,[p.kI.required]],nombreProveedor:[void 0,[]],items:this.fb.array([],(0,d.eK)(1))})}loadCurrencies(){const t=o=>{this.modelForm.getRawValue().codigoMoneda||this.modelForm.patchValue({codigoMoneda:o.find(n=>n.monedaPorDefecto).codigoMoneda})};this.currencyService.findAll().pipe((0,xe.b)(o=>t(o)),(0,c.U)(o=>o.map(n=>({label:n.codigoMoneda,value:n.codigoMoneda})))).subscribe(o=>this.monedas=o)}addProductItem(t){const o=this.modelForm.get("items");o.controls.find(n=>n.get("itemCompra").value.producto.id===t.id)?this.messageService.add({severity:"warn",summary:"Mensaje",detail:`El producto ${t.nombre} ya est\xe1 agregado a la compra.`}):o.push(this.createItemForm({producto:t}))}addPurchaseDetailItem(t){this.modelForm.get("items").push(this.createItemForm(t))}deleteItem(t){const o=this.modelForm.get("items");o.length>0&&o.removeAt(t)}createItemForm(t){return t||(t={}),this.fb.group({itemCompra:[t,[p.kI.required,Jo]]})}registrarCompra(){(0,d.c2)(this.modelForm),this.modelForm.valid?this.confirmationService.confirm({message:`\xbfEst\xe1 seguro de ${this.isEdit?"actualizar":"registrar"} la compra actual?`,accept:()=>{this.formToModel(),(this.isEdit?this.purchaseService.update(this.model):this.purchaseService.save(this.model)).subscribe(t=>{this.messageService.add({severity:"success",summary:"Registro de compra",detail:"Compra registrada correctamente."}),this.router.navigateByUrl("/compras")})},acceptLabel:"Si",rejectLabel:"No"}):this.messageService.add({severity:"error",summary:"Error",detail:"Complete campos obligatorios (*)"})}formToModel(){const t=this.modelForm.getRawValue();this.model||(this.model={}),this.model.tipoCompra=t.tipoCompra,this.model.comprobante=t.comprobante,this.model.tipoComprobante=t.tipoComprobante,this.model.fecha=t.fecha,this.model.puntoVenta=this.puntoVenta,this.model.estacionVenta=this.estacionVenta,this.model.codigoMoneda=t.codigoMoneda,this.model.numeroDocumentoProveedor=t.numeroDocumentoProveedor,this.model.nombreProveedor=t.nombreProveedor,this.model.proveedor="object"==typeof t.proveedor?t.proveedor:{razonSocial:t.proveedor,numeroDocumento:t.numeroDocumentoProveedor},"CONTADO"===this.model.tipoCompra&&(this.model.movimientoCaja={pagos:this.modelForm.value.pagos}),this.model.items=[],t.items.forEach(o=>{this.model.items.push(o.itemCompra)})}loadTicketIsEdit(){const t=this.route.snapshot.params.idPurchase;t&&this.purchaseService.findById(t).subscribe(o=>{this.model=o,this.modelForm.patchValue({tipoComprobante:o.tipoComprobante,comprobante:o.comprobante,fecha:new Date(o.fecha),codigoMoneda:o.codigoMoneda,proveedor:o.proveedor,numeroDocumentoProveedor:o.proveedor.numeroDocumento}),o.items.forEach(n=>{this.addPurchaseDetailItem(Object.assign(Object.assign({},n),{isEdit:!0}))})})}get cambioFormaPago(){if(!this.modelForm||!this.modelForm.getRawValue().pagos)return 0;{const t=this.modelForm.getRawValue().pagos.find(o=>"EFECTIVO"===o.formaPago);return t&&t.cambio>0?t.cambio:0}}onChangeTipoCompra(){"CONTADO"===this.modelForm.get("tipoCompra").value?(this.modelForm.get("pagos").clearValidators(),this.modelForm.get("pagos").setValidators([(0,d.Kv)(this.importeTotalCompra)])):(this.modelForm.controls.pagos.clearValidators(),this.modelForm.controls.pagos.updateValueAndValidity())}onHideDialogFinalizar(){this.modelForm.get("pagos").clearValidators(),this.modelForm.get("pagos").updateValueAndValidity()}showDialogFinalizar(){if((0,d.c2)(this.modelForm),this.modelForm.valid){if("CONTADO"===this.modelForm.value.tipoCompra){this.modelForm.get("pagos").clearValidators(),this.modelForm.get("pagos").setValidators([(0,d.Kv)(this.importeTotalCompra)]);const t=this.configCompany.formasPago.find(i=>"TRANSFERENCIA"===i.formaPago),o=this.configCompany.formasPago.find(i=>"EFECTIVO"===i.formaPago);console.log("FP E",o);const n=[];t?(o&&n.push({monto:0,nombre:o.nombre,formaPago:o.formaPago,metodoPagoEfectivo:o}),n.push({monto:Number(this.importeTotalCompra),nombre:t.nombre,formaPago:t.formaPago,metodoPago:t})):o&&n.push({monto:Number(this.importeTotalCompra),nombre:o.nombre,formaPago:o.formaPago,metodoPagoEfectivo:o}),this.modelForm.patchValue({pagos:n})}this.dialogRegister=!0}}get isEdit(){return this.route.snapshot.data.isEdit}get titleButtonAction(){return this.isEdit?"Actualizar compra":"Registrar compra"}get linkVolver(){return"/compras"}filterSuppliersByFilter(t){this.supplierService.findAllList(["paginacion=false",`filtro=${t.query}`,"limit=20"].join("&")).subscribe(i=>{this.filteredSuppliers=i})}onSelectSupplier(t){this.modelForm.patchValue({numeroDocumentoProveedor:t.numeroDocumento})}searchSupplierByNumber(){const t=this.modelForm.get("numeroDocumentoProveedor").value;if(8===t.length||11===t.length){const o=8===t.length;this.consultaDocumentoService.findDocument(t,o).subscribe(n=>{const i={razonSocial:o?n.nombre_completo:n.nombre_o_razon_social,numeroDocumento:t};this.modelForm.patchValue({proveedor:i,nombreProveedor:i.razonSocial})})}}}_.\u0275fac=function(t){return new(t||_)(e.Y36(m.gz),e.Y36(m.F0),e.Y36(f.yh),e.Y36(R.p),e.Y36(p.qu),e.Y36(V),e.Y36(L.E),e.Y36(E.p),e.Y36(h.ez),e.Y36(h.YP),e.Y36(H.i),e.Y36(Ie.W))},_.\u0275cmp=e.Xpm({type:_,selectors:[["app-compra"]],decls:73,vars:48,consts:[["novalidate","",3,"formGroup"],[1,"grid"],[1,"col-12","md:col-6"],["legend","Comprobante"],[1,"col-12","md:col-6","md:col-4","p-fluid"],[1,"label-form"],["placeholder","Fecha de emisi\xf3n","formControlName","fecha","dateFormat","dd/mm/yy",3,"locale"],["severity","error","text","Ingrese fecha",4,"ngIf"],["formControlName","tipoComprobante",3,"options"],["severity","error","text","Ingrese tipo de comprobante",4,"ngIf"],["placeholder","Comprobante","formControlName","comprobante","type","text","pInputText","",2,"width","100%"],["severity","error","text","Ingrese comprobante",4,"ngIf"],[1,"col-12","sm:col-6","md:col-3"],["formControlName","codigoMoneda","name","moneda",3,"disabled","options","onChange"],["severity","error","text","Ingrese moneda",4,"ngIf"],["formControlName","tipoCompra",3,"options"],["severity","error","text","Ingrese tipo compra",4,"ngIf"],["legend","Proveedor"],[1,"col-12","md:col-6","p-fluid"],["field","razonSocial","formControlName","proveedor","placeholder","Nombre o Nro. documento",3,"suggestions","size","minLength","onSelect","completeMethod"],["pTemplate","item"],["formControlName","numeroDocumentoProveedor","type","text","placeholder","N. documento","pInputText","",2,"width","100%",3,"input"],["severity","error","text","Ingrese un n\xfamero de documento v\xe1lido",4,"ngIf"],[1,"col-12"],["legend","Productos"],[1,"head-items"],[3,"aditionalParamsGeneralSearch","visibleAddItem","selectProduct"],[3,"selectProduct"],["formArrayName","items",4,"ngFor","ngForOf"],["severity","error","text","Agregue productos",4,"ngIf"],[1,"pull-right"],[1,"col-12",2,"text-align","center"],["pButton","","type","button",1,"m-1",3,"label","click"],["pButton","","type","button","label","Volver",1,"p-button-secondary","m-1",2,"margin-right","0.4rem",3,"routerLink"],["appendTo","body","header","Finalizar",3,"visible","modal","responsive","onHide","visibleChange"],[1,"mt-0","mb-0"],["style","color: #a03838","class","mt-0 mb-0",4,"ngIf"],["class","col-12 md:col-6",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"col-12","flex-center-x"],["pButton","","type","submit","label","Confirmar",1,"p-button-rounded","p-button-success",2,"width","auto","padding","8px 15px","font-size","20px",3,"click"],["severity","error","text","Ingrese fecha"],["severity","error","text","Ingrese tipo de comprobante"],["severity","error","text","Ingrese comprobante"],["severity","error","text","Ingrese moneda"],["severity","error","text","Ingrese tipo compra"],["severity","error","text","Ingrese un n\xfamero de documento v\xe1lido"],["formArrayName","items"],[3,"formGroupName"],[2,"margin","10px 0"],["formControlName","itemCompra",3,"monedaCompra","index","delete"],["severity","error","text","Ingrese cantidad",4,"ngIf"],["severity","error","text","Ingrese factor",4,"ngIf"],["severity","error","text","Ingrese precio de compra",4,"ngIf"],["severity","error","text","Complete informaci\xf3n de los nuevos precios de venta",4,"ngIf"],["severity","error","text","Ingrese cantidad"],["severity","error","text","Ingrese factor"],["severity","error","text","Ingrese precio de compra"],["severity","error","text","Complete informaci\xf3n de los nuevos precios de venta"],["severity","error","text","Agregue productos"],[1,"mt-0","mb-0",2,"color","#a03838"],["formControlName","tipoCompra",3,"options","onChange"],["severity","error","text","Ingrese tipo venta",4,"ngIf"],["severity","error","text","Ingrese tipo venta"],["formControlName","pagos","tipo","EGRESO",3,"total","moneda"],["severity","error","text","Pago incorrecto",4,"ngIf"],["severity","error","text","Pago incorrecto"]],template:function(t,o){1&t&&(e.TgZ(0,"p-card"),e.TgZ(1,"form",0),e.TgZ(2,"div",1),e.TgZ(3,"div",2),e.TgZ(4,"p-fieldset",3),e.TgZ(5,"div",1),e.TgZ(6,"div",4),e.TgZ(7,"label",5),e._uU(8,"Fecha (*)"),e.qZA(),e._UZ(9,"p-calendar",6),e.YNc(10,ho,1,0,"p-message",7),e.qZA(),e.TgZ(11,"div",2),e.TgZ(12,"label",5),e._uU(13,"Tipo comprobante (*)"),e.qZA(),e._UZ(14,"p-dropdown",8),e.YNc(15,fo,1,0,"p-message",9),e.qZA(),e.TgZ(16,"div",2),e.TgZ(17,"label",5),e._uU(18,"Comprobante (*)"),e.qZA(),e._UZ(19,"input",10),e.YNc(20,_o,1,0,"p-message",11),e.qZA(),e.TgZ(21,"div",12),e.TgZ(22,"label",5),e._uU(23,"Moneda (*)"),e.qZA(),e.TgZ(24,"p-dropdown",13),e.NdJ("onChange",function(){return o.clearItems()}),e.qZA(),e.YNc(25,Co,1,0,"p-message",14),e.qZA(),e.TgZ(26,"div",12),e.TgZ(27,"label",5),e._uU(28,"Tipo de compra (*)"),e.qZA(),e._UZ(29,"p-selectButton",15),e.YNc(30,Zo,1,0,"p-message",16),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(31,"div",2),e.TgZ(32,"p-fieldset",17),e.TgZ(33,"div",1),e.TgZ(34,"div",18),e.TgZ(35,"label",5),e._uU(36,"Nombre (*)"),e.qZA(),e.TgZ(37,"p-autoComplete",19),e.NdJ("onSelect",function(i){return o.onSelectSupplier(i)})("completeMethod",function(i){return o.filterSuppliersByFilter(i)}),e.YNc(38,vo,1,2,"ng-template",20),e.qZA(),e.qZA(),e.TgZ(39,"div",2),e.TgZ(40,"label",5),e._uU(41,"Num. Doc. (*)"),e.qZA(),e.TgZ(42,"input",21),e.NdJ("input",function(){return o.searchSupplierByNumber()}),e.qZA(),e.YNc(43,To,1,0,"p-message",22),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(44,"div",23),e.TgZ(45,"p-fieldset",24),e.TgZ(46,"div",25),e.TgZ(47,"app-agregar-producto",26),e.NdJ("selectProduct",function(i){return o.addProductItem(i)}),e.TgZ(48,"app-button-new-product",27),e.NdJ("selectProduct",function(i){return o.addProductItem(i)}),e.qZA(),e.qZA(),e.qZA(),e.YNc(49,xo,9,7,"div",28),e.YNc(50,Io,1,0,"p-message",29),e.qZA(),e.qZA(),e.TgZ(51,"div",23),e.TgZ(52,"h1",30),e._uU(53),e.ALo(54,"montoDinero"),e.qZA(),e.qZA(),e.TgZ(55,"div",31),e.TgZ(56,"button",32),e.NdJ("click",function(){return o.showDialogFinalizar()}),e.qZA(),e._UZ(57,"button",33),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(58,"p-dialog",34),e.NdJ("onHide",function(){return o.onHideDialogFinalizar()})("visibleChange",function(i){return o.dialogRegister=i}),e.TgZ(59,"form",0),e.TgZ(60,"div",1),e.TgZ(61,"div",23),e.TgZ(62,"p-card"),e.TgZ(63,"div",1),e.TgZ(64,"div",2),e.TgZ(65,"h1",35),e._uU(66),e.ALo(67,"montoDinero"),e.qZA(),e.YNc(68,yo,3,4,"h1",36),e.qZA(),e.YNc(69,Uo,3,2,"div",37),e.qZA(),e.qZA(),e.qZA(),e.YNc(70,Mo,3,3,"div",38),e.TgZ(71,"div",39),e.TgZ(72,"button",40),e.NdJ("click",function(){return o.registrarCompra()}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(1),e.Q6J("formGroup",o.modelForm),e.xp6(8),e.Akn(e.DdM(44,Q)),e.Q6J("locale",o.listas.calendarEs),e.xp6(1),e.Q6J("ngIf",o.modelForm.get("fecha").touched&&(null==o.modelForm.get("fecha").errors?null:o.modelForm.get("fecha").errors.required)),e.xp6(4),e.Akn(e.DdM(45,Q)),e.Q6J("options",o.listas.tipoComprobantesVenta),e.xp6(1),e.Q6J("ngIf",o.modelForm.get("tipoComprobante").touched&&(null==o.modelForm.get("tipoComprobante").errors?null:o.modelForm.get("tipoComprobante").errors.required)),e.xp6(5),e.Q6J("ngIf",o.modelForm.get("comprobante").touched&&(null==o.modelForm.get("comprobante").errors?null:o.modelForm.get("comprobante").errors.required)),e.xp6(4),e.Akn(e.DdM(46,Q)),e.Q6J("disabled",o.isEdit)("options",o.listas.monedas),e.xp6(1),e.Q6J("ngIf",o.modelForm.get("codigoMoneda").touched&&(null==o.modelForm.get("codigoMoneda").errors?null:o.modelForm.get("codigoMoneda").errors.required)),e.xp6(4),e.Q6J("options",o.listas.tiposVenta),e.xp6(1),e.Q6J("ngIf",o.modelForm.get("tipoCompra").touched&&(null==o.modelForm.get("tipoCompra").errors?null:o.modelForm.get("tipoCompra").errors.required)),e.xp6(7),e.Q6J("suggestions",o.filteredSuppliers)("size",30)("minLength",1),e.xp6(6),e.Q6J("ngIf",o.modelForm.get("numeroDocumentoProveedor").touched&&(null==o.modelForm.get("numeroDocumentoProveedor").errors?null:o.modelForm.get("numeroDocumentoProveedor").errors.required)),e.xp6(4),e.Q6J("aditionalParamsGeneralSearch",o.aditionalParamsSearchProduct)("visibleAddItem",!1),e.xp6(2),e.Q6J("ngForOf",o.modelFormItems.controls),e.xp6(1),e.Q6J("ngIf",o.modelForm.get("items").touched&&(null==o.modelForm.get("items").errors?null:o.modelForm.get("items").errors.minLengthArray)),e.xp6(3),e.hij("Total: ",e.xi3(54,38,o.importeTotalCompra,o.modelForm.get("codigoMoneda").value),""),e.xp6(3),e.Q6J("label",o.titleButtonAction),e.xp6(1),e.Q6J("routerLink",o.linkVolver),e.xp6(1),e.Akn(e.DdM(47,Vo)),e.Q6J("visible",o.dialogRegister)("modal",!0)("responsive",!0),e.xp6(1),e.Q6J("formGroup",o.modelForm),e.xp6(7),e.hij("Total: ",e.xi3(67,41,o.importeTotalCompra,o.modelForm.get("codigoMoneda").value),""),e.xp6(2),e.Q6J("ngIf",o.cambioFormaPago&&o.cambioFormaPago>0),e.xp6(1),e.Q6J("ngIf","03"===o.modelForm.get("tipoComprobante").value||"01"===o.modelForm.get("tipoComprobante").value||"NV"===o.modelForm.get("tipoComprobante").value),e.xp6(1),e.Q6J("ngIf","CONTADO"===o.modelForm.value.tipoCompra&&o.dialogRegister))},directives:[J.Z,p._Y,p.JL,p.sg,G.p,B.f,p.JJ,p.u,u.O5,K.q,j.Lt,p.Fj,S.o,ye.UN,Fe.Qc,h.jx,Ue.d,Ne.j,u.sg,p.CE,p.x0,v,w.Hq,m.rH,k.V,go.M],pipes:[M.Z],styles:[""]}),(0,C.gn)([(0,f.Ph)(Z.Z.getOffice)],_.prototype,"puntoVenta$",void 0),(0,C.gn)([(0,f.Ph)(Z.Z.getSaleStation)],_.prototype,"estacionVenta$",void 0),(0,C.gn)([(0,f.Ph)(Z.Z.getConfig)],_.prototype,"configCompany$",void 0);const So=[{path:"",component:P,canActivate:[A.P],data:{breadcrumb:[{label:"Compras"},{label:"Ver compras"}]}},{path:"nueva-compra",component:_,data:{isEdit:!1,title:"Nueva compra",breadcrumb:[{label:"Compras"},{label:"Nueva compra"}]},canActivate:[A.P]},{path:"editar-compra/:idPurchase",component:_,data:{isEdit:!0,title:"Editar compra",breadcrumb:[{label:"Compras"},{label:"Editar compra"}]},canActivate:[A.P]}];let Do=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[m.Bz.forChild(So)],m.Bz]}),r})();var wo=a(20958),Qo=a(19406),Yo=a(27429),$o=a(16672),Oo=a(99266),Eo=a(45330);let Lo=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[Eo.xA],imports:[[Do,wo.m,Qo.P,$o.u,Oo.w,Yo.N]]}),r})()}}]);