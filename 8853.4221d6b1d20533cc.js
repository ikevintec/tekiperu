"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[8853,7121],{5766:(E,h,r)=>{r.d(h,{h:()=>p});var g=r(5e3),t=r(45351);let p=(()=>{class m{constructor(){}get items(){return this._items}set items(c){this._items=c,this.loadActions()}get defaultActionLabel(){return this.items?this.items[0].label:""}get defaultActionIcon(){return this.items?this.items[0].icon:""}ngOnInit(){}defaultAction(){if(this.items&&this.items.length>0){const c=this.items[0].url;c&&window.open(c,"_blank")}}loadActions(){if(this.options=[],this.items){let c=0;this.items.forEach(s=>{if(c>0){const d=s.url;this.options.push({label:s.label,icon:s.icon,command:()=>{d&&window.open(d,"_blank")}})}c++})}}}return m.\u0275fac=function(c){return new(c||m)},m.\u0275cmp=g.Xpm({type:m,selectors:[["app-actions"]],inputs:{items:"items"},decls:1,vars:3,consts:[["appendTo","body","styleClass","p-button-secondary",3,"label","icon","model","onClick"]],template:function(c,s){1&c&&(g.TgZ(0,"p-splitButton",0),g.NdJ("onClick",function(){return s.defaultAction()}),g.qZA()),2&c&&g.Q6J("label",s.defaultActionLabel)("icon",s.defaultActionIcon)("model",s.options)},directives:[t.a],styles:[""]}),m})()},68297:(E,h,r)=>{r.d(h,{M:()=>T});var g=r(70655),t=r(5e3),p=r(93075),m=r(29067),l=r(82817),c=r(7625),s=r(8929),d=r(85932),C=r(81575),b=r(74297),_=r(69808),A=r(40845),O=r(4119);function P(a,e){if(1&a){const o=t.EpF();t.TgZ(0,"div",3),t.TgZ(1,"button",4),t.NdJ("click",function(){t.CHM(o);const i=t.oxw().$implicit;return t.oxw().selectCoin.emit(i)}),t.qZA(),t.qZA()}if(2&a){const o=t.oxw().$implicit;t.xp6(1),t.Q6J("pTooltip","Paga con "+o)("label",o)}}function F(a,e){if(1&a&&(t.ynx(0),t.YNc(1,P,2,2,"div",2),t.BQk()),2&a){const o=e.$implicit;t.xp6(1),t.Q6J("ngIf",o)}}let y=(()=>{class a{constructor(){this.coins=[1,2,5,10,20,50,100],this.suggestions=[],this.selectCoin=new t.vpe}ngOnInit(){this.addSuggestions()}ngOnChanges(o){this.addSuggestions()}addSuggestions(){this.suggestions=[],this.suggestions.push((0,l.He)(this.amount));const o=this.coins.filter(i=>i>this.amount),n=this.coins[this.coins.length-1];if(o.length>0){this.suggestions=this.suggestions.concat(o);const i=this.coins.indexOf(o[0])-1;i>0&&(0,l.He)(this.coins[i])!==(0,l.He)(this.amount)&&(this.coins.forEach((u,f)=>{f<i&&this.coins[i]+u>this.amount&&this.suggestions.push(this.coins[i]+u)}),2*this.coins[i]>this.amount&&this.suggestions.push(2*this.coins[i]))}else{let i=0;for(;i<(0,l.He)(this.amount);)i+=n,i>=this.amount&&this.suggestions.push(i);if(i>this.amount){const u=i-n;this.coins.forEach(f=>{u+f>this.amount&&this.suggestions.push(u+f)}),this.coins.forEach(f=>{n+f>this.amount&&this.suggestions.push(n+f)})}}this.suggestions=this.suggestions.map(i=>Number(i)).filter((i,u)=>this.suggestions.indexOf(i)===u).sort((i,u)=>i-u).slice(0,5)}}return a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-dinero-billetera-opciones"]],inputs:{amount:"amount"},outputs:{selectCoin:"selectCoin"},features:[t.TTD],decls:2,vars:1,consts:[[1,"grid","flex","justify-content-center","align-content-center"],[4,"ngFor","ngForOf"],["class","col flex-center-x",4,"ngIf"],[1,"col","flex-center-x"],["tooltipPosition","top","pButton","","type","button","icon","fa fa-money",1,"p-button-success",3,"pTooltip","label","click"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0),t.YNc(1,F,2,1,"ng-container",1),t.qZA()),2&o&&(t.xp6(1),t.Q6J("ngForOf",n.suggestions))},directives:[_.sg,_.O5,A.Hq,O.u],styles:[""]}),a})();var v=r(20657),I=r(31424),D=r(43724);function R(a,e){if(1&a){const o=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){return t.CHM(o),t.oxw().setPay.emit()}),t.qZA()}if(2&a){const o=t.oxw();t.Q6J("pTooltip","Todo en "+o.paymentDetail.nombre)}}function x(a,e){if(1&a){const o=t.EpF();t.TgZ(0,"button",14),t.NdJ("click",function(){return t.CHM(o),t.oxw().setPay.emit()}),t.qZA()}if(2&a){const o=t.oxw();t.Q6J("pTooltip","Todo en "+o.paymentDetail.nombre)}}function N(a,e){if(1&a){const o=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){return t.CHM(o),t.oxw().setPay.emit()}),t.qZA()}if(2&a){const o=t.oxw();t.Q6J("pTooltip","Todo en "+o.paymentDetail.nombre)}}function Z(a,e){if(1&a){const o=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){return t.CHM(o),t.oxw().clearAmount()}),t.qZA()}}function J(a,e){if(1&a){const o=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){return t.CHM(o),t.oxw().delete.emit()}),t.qZA()}}function M(a,e){1&a&&(t.TgZ(0,"div",4),t.TgZ(1,"span",18),t._UZ(2,"span",19),t.qZA(),t._UZ(3,"input",20),t.qZA())}function S(a,e){1&a&&t._UZ(0,"p-message",21)}let B=(()=>{class a{constructor(o){this.fb=o,this.unsubscribe$=new s.xQ,this.delete=new t.vpe,this.setPay=new t.vpe,this.onChange=n=>{},this.onTouched=n=>{}}ngOnInit(){this.builderForm()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}builderForm(){this.modelForm=this.fb.group({id:[void 0,[]],formaPago:[void 0,[p.kI.required]],numeroOperacion:[void 0,[]],tipoTarjeta:[void 0,[]],nombre:[void 0,[]],monto:[void 0,[p.kI.required]],metodoPago:[void 0,[]]}),this.modelForm.valueChanges.pipe((0,c.R)(this.unsubscribe$)).subscribe(()=>this.propagateChange())}get paymentDetail(){return Object.assign(Object.assign({},this.modelForm.getRawValue()),{monto:Number(this.modelForm.getRawValue().monto)})}propagateChange(){this.onTouched(this.paymentDetail),this.onChange(this.paymentDetail)}registerOnChange(o){this.onChange=o}registerOnTouched(o){this.onTouched=o}writeValue(o){o&&(this.modelForm.patchValue(o),(o.formaPago===m.XB.TARJETA||o.formaPago===m.XB.TRANSFERENCIA)&&this.modelForm.get("monto").setValidators([p.kI.max((0,l.He)(this.total))]))}clearAmount(){this.modelForm.patchValue({monto:0,numeroOperacion:void 0})}}return a.\u0275fac=function(o){return new(o||a)(t.Y36(p.qu))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-forma-pago-detalle"]],inputs:{showDeleteButton:"showDeleteButton",total:"total"},outputs:{delete:"delete",setPay:"setPay"},features:[t._Bn([{provide:p.JU,useExisting:(0,t.Gpc)(()=>a),multi:!0}])],decls:15,vars:9,consts:[["novalidate","",3,"formGroup"],["for","card-credit",1,"label-form","text-bold"],["id","card-credit",1,"grid"],[1,"col-12"],[1,"p-inputgroup"],["tooltipPosition","bottom","pButton","","type","button","icon","fa fa-money",3,"pTooltip","click",4,"ngIf"],["tooltipPosition","bottom","pButton","","type","button","icon","fa fa-university",3,"pTooltip","click",4,"ngIf"],["tooltipPosition","bottom","pButton","","type","button","icon","fa fa-credit-card-alt",3,"pTooltip","click",4,"ngIf"],["pKeyFilter","num","formControlName","monto","type","text","placeholder","Monto","pInputText",""],["pButton","","type","button","icon","pi pi-ban",3,"click",4,"ngIf"],["pButton","","type","button","icon","pi pi-trash","class","p-button-danger",3,"click",4,"ngIf"],["class","p-inputgroup",4,"ngIf"],["severity","error","text","No debe superar el monto total",4,"ngIf"],["tooltipPosition","bottom","pButton","","type","button","icon","fa fa-money",3,"pTooltip","click"],["tooltipPosition","bottom","pButton","","type","button","icon","fa fa-university",3,"pTooltip","click"],["tooltipPosition","bottom","pButton","","type","button","icon","fa fa-credit-card-alt",3,"pTooltip","click"],["pButton","","type","button","icon","pi pi-ban",3,"click"],["pButton","","type","button","icon","pi pi-trash",1,"p-button-danger",3,"click"],[1,"p-inputgroup-addon"],[1,"fa","fa-hashtag",2,"line-height","1.25"],["pKeyFilter","num","formControlName","numeroOperacion","type","text","placeholder","# Operaci\xf3n","pInputText",""],["severity","error","text","No debe superar el monto total"]],template:function(o,n){1&o&&(t.TgZ(0,"form",0),t.TgZ(1,"label",1),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.qZA(),t.TgZ(4,"div",2),t.TgZ(5,"div",3),t.TgZ(6,"div",4),t.YNc(7,R,1,1,"button",5),t.YNc(8,x,1,1,"button",6),t.YNc(9,N,1,1,"button",7),t._UZ(10,"input",8),t.YNc(11,Z,1,0,"button",9),t.YNc(12,J,1,0,"button",10),t.qZA(),t.YNc(13,M,4,0,"div",11),t.YNc(14,S,1,0,"p-message",12),t.qZA(),t.qZA(),t.qZA()),2&o&&(t.Q6J("formGroup",n.modelForm),t.xp6(3),t.Oqu(n.paymentDetail.nombre),t.xp6(4),t.Q6J("ngIf","EFECTIVO"===n.paymentDetail.formaPago),t.xp6(1),t.Q6J("ngIf","TRANSFERENCIA"===n.paymentDetail.formaPago),t.xp6(1),t.Q6J("ngIf","TARJETA"===n.paymentDetail.formaPago),t.xp6(2),t.Q6J("ngIf",n.paymentDetail.monto>0),t.xp6(1),t.Q6J("ngIf",0==n.paymentDetail.monto&&n.showDeleteButton),t.xp6(1),t.Q6J("ngIf","TRANSFERENCIA"===n.paymentDetail.formaPago||"TARJETA"===n.paymentDetail.formaPago),t.xp6(1),t.Q6J("ngIf",n.modelForm.get("monto").touched&&(null==n.modelForm.get("monto").errors?null:n.modelForm.get("monto").errors.max)))},directives:[p._Y,p.JL,p.sg,_.O5,A.Hq,O.u,p.Fj,v.Fr,p.JJ,p.u,I.o,D.q],styles:[""]}),a})();function j(a,e){if(1&a){const o=t.EpF();t.TgZ(0,"div",7),t.TgZ(1,"div",8),t.TgZ(2,"app-forma-pago-detalle",9),t.NdJ("setPay",function(){const u=t.CHM(o).index;return t.oxw().setItemPay(u)})("delete",function(){const u=t.CHM(o).index;return t.oxw().deleteItemForm(u)}),t.qZA(),t.qZA(),t.qZA()}if(2&a){const o=e.$implicit,n=e.index,i=t.oxw();t.xp6(1),t.Q6J("formGroupName",n),t.xp6(1),t.Q6J("total",i.total)("showDeleteButton","EFECTIVO"!==o.value.paymentDetail.formaPago)}}function V(a,e){if(1&a){const o=t.EpF();t.TgZ(0,"div",10),t.TgZ(1,"img",11),t.NdJ("click",function(){const u=t.CHM(o).$implicit;return t.oxw().addPaymenMethod(u)}),t.qZA(),t.qZA()}if(2&a){const o=e.$implicit;t.xp6(1),t.Q6J("pTooltip",o.nombre)("src",o.imagenUrl,t.LSH)}}class T{constructor(e){this.fb=e,this.formasPago=[],this.unsubscribe$=new s.xQ,this.onChange=o=>{},this.onTouched=o=>{}}ngOnInit(){this.configCompany$.pipe((0,c.R)(this.unsubscribe$)).subscribe(e=>{this.configCompany=e,this.loadPaymentsMethods(),this.builderForm()})}loadPaymentsMethods(){this.configCompany&&(this.formasPago=this.configCompany.formasPago.filter(e=>"EFECTIVO"!==e.formaPago).filter(e=>"INGRESO"===this.tipo&&"INGRESO"===e.tipoMovimiento||"EGRESO"===this.tipo&&"EGRESO"===e.tipoMovimiento).map(e=>{let o=e.imagenUrl;if("TARJETA"===e.formaPago)switch(e.tipoTarjeta){case"VISA":o="assets/resources/images/credit-card-visa.svg";break;case"MASTERCARD":o="assets/resources/images/credit-master-card.svg";break;case"AMERICAN_EXPRESS":o="assets/resources/images/american-express.svg";break;case"DINERS":o="assets/resources/images/diners-club.svg";break;default:o="assets/resources/images/credit-card.svg"}return Object.assign(Object.assign({},e),{imagenUrl:o})}))}ngOnChanges(e){this.modelForm&&this.propagateChange(),this.loadPaymentsMethods()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}get montoEfectivo(){const e=this.modelFormItems.controls.filter(o=>"EFECTIVO"===o.get("paymentDetail").value.formaPago).map(o=>o.get("paymentDetail").value.monto).reduce(l.IH,0);return(0,l.He)(Number(e))}get cambio(){return this.montoEfectivo>(0,l.He)(this.total)?this.montoEfectivo-(0,l.He)(this.total):0}get efectivo(){return this.modelFormItems.controls.find(e=>e.get("paymentDetail").value.formaPago===m.XB.EFECTIVO).value.paymentDetail.monto}get payments(){const e=this.modelFormItems.getRawValue().map(n=>n.paymentDetail).filter(n=>0!==n.monto).filter(n=>n.formaPago===m.XB.EFECTIVO||n.formaPago!==m.XB.EFECTIVO),o=n=>({formaPago:n.formaPago,tipoTarjeta:n.tipoTarjeta,nombre:n.nombre,numeroOperacion:n.numeroOperacion,monto:n.formaPago===m.XB.EFECTIVO&&n.monto>this.total?n.monto-this.cambio:n.monto,montoPagado:n.monto,cambio:n.formaPago===m.XB.EFECTIVO?this.cambio:void 0,metodoPago:n.metodoPago});return e.map(n=>o(n))}builderForm(){this.modelForm=this.fb.group({pagos:this.fb.array([])}),this.modelForm.get("pagos").valueChanges.pipe((0,c.R)(this.unsubscribe$)).subscribe(()=>this.propagateChange())}propagateChange(){this.onChange(this.payments),this.onTouched(this.payments)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}writeValue(e){if(console.log("obj",e),e){this.modelFormItems.clear();const o=n=>{if(n.formaPago===m.XB.EFECTIVO){const i=this.modelFormItems.controls.find(u=>u.value.paymentDetail.formaPago===m.XB.EFECTIVO);i?i.patchValue({paymentDetail:Object.assign(Object.assign({},i.get("paymentDetail").value),{monto:(0,l.He)(n.monto,2)})}):this.addPagoForm(Object.assign(Object.assign({},n),{monto:Number(n.monto)}))}else this.addPagoForm(Object.assign(Object.assign({},n),{monto:Number(n.monto)}))};e.forEach(n=>o(n)),this.propagateChange()}}get modelFormItems(){return this.modelForm.get("pagos")}addPagoForm(e){this.modelFormItems.push(this.createItemForm(e))}deleteItemForm(e){this.modelFormItems.removeAt(e)}setItemPay(e){this.modelFormItems.controls.forEach((o,n)=>{o.patchValue(e===n?{paymentDetail:Object.assign(Object.assign({},o.get("paymentDetail").value),{monto:(0,l.He)(this.total)})}:{paymentDetail:Object.assign(Object.assign({},o.get("paymentDetail").value),{monto:0})})})}createItemForm(e){return console.log("Creando item pago",e),this.fb.group({paymentDetail:[e,[]]})}setEfectivo(e){this.modelFormItems.controls.forEach(o=>{o.get("paymentDetail").value.formaPago===m.XB.EFECTIVO&&o.patchValue({paymentDetail:Object.assign(Object.assign({},o.get("paymentDetail").value),{monto:e})})})}addPaymenMethod(e){const o=this.modelFormItems.controls.map(i=>(0,l.He)(i.value.paymentDetail.monto)).reduce(l.IH,0);this.modelFormItems.controls.forEach(i=>{i.value.paymentDetail.monto===(0,l.He)(this.total)&&i.patchValue({paymentDetail:Object.assign(Object.assign({},i.value.paymentDetail),{monto:0})})});const n=(0,l.He)(this.total)===o?(0,l.He)(this.total):(0,l.He)(this.total)-o;this.addPagoForm({formaPago:e.formaPago,monto:n,montoPagado:n,metodoPago:e,nombre:e.nombre,tipoTarjeta:e.tipoTarjeta})}}T.\u0275fac=function(e){return new(e||T)(t.Y36(p.qu))},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-forma-pago-venta"]],inputs:{total:"total",moneda:"moneda",tipo:"tipo"},features:[t._Bn([{provide:p.JU,useExisting:(0,t.Gpc)(()=>T),multi:!0}]),t.TTD],decls:9,vars:4,consts:[["novalidate","",3,"formGroup"],[1,"grid","mt-0","flex","justify-content-center"],[1,"col-12"],[3,"amount","selectCoin"],["formArrayName","pagos","class","col-6",4,"ngFor","ngForOf"],[1,"grid","flex","justify-content-center"],["class","col-2",4,"ngFor","ngForOf"],["formArrayName","pagos",1,"col-6"],[3,"formGroupName"],["formControlName","paymentDetail",3,"total","showDeleteButton","setPay","delete"],[1,"col-2"],["alt","",1,"cursor-pointer",2,"width","80%",3,"pTooltip","src","click"]],template:function(e,o){1&e&&(t.TgZ(0,"p-card"),t.TgZ(1,"form",0),t.TgZ(2,"div",1),t.TgZ(3,"div",2),t.TgZ(4,"app-dinero-billetera-opciones",3),t.NdJ("selectCoin",function(i){return o.setEfectivo(i)}),t.qZA(),t.qZA(),t.YNc(5,j,3,3,"div",4),t.TgZ(6,"div",2),t.TgZ(7,"div",5),t.YNc(8,V,2,2,"div",6),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("formGroup",o.modelForm),t.xp6(3),t.Q6J("amount",o.total),t.xp6(1),t.Q6J("ngForOf",o.modelFormItems.controls),t.xp6(3),t.Q6J("ngForOf",o.formasPago))},directives:[b.Z,p._Y,p.JL,p.sg,y,_.sg,p.CE,p.x0,B,p.JJ,p.u,O.u],styles:[""]}),(0,g.gn)([(0,d.Ph)(C.Z.getConfig)],T.prototype,"configCompany$",void 0)},27429:(E,h,r)=>{r.d(h,{N:()=>m});var g=r(69808),t=r(20958),p=r(5e3);let m=(()=>{class l{}return l.\u0275fac=function(s){return new(s||l)},l.\u0275mod=p.oAB({type:l}),l.\u0275inj=p.cJS({imports:[[g.ez,t.m]]}),l})()},29067:(E,h,r)=>{r.d(h,{_S:()=>g,XB:()=>t,HE:()=>m,Bb:()=>c});var g=(()=>{return(s=g||(g={})).APERTURA_CAJA="APERTURA_CAJA",s.VENTAS="VENTAS",s.OTROS_INGRESOS="OTROS_INGRESOS",s.COMPRAS="COMPRAS",s.OTROS_EGRESOS="OTROS_EGRESOS",s.RETIRO_CAJA="RETIRO_CAJA",g;var s})(),t=(()=>{return(s=t||(t={})).EFECTIVO="EFECTIVO",s.TRANSFERENCIA="TRANSFERENCIA",s.TARJETA="TARJETA",s.CREDITO="CREDITO",t;var s})(),m=(()=>{return(s=m||(m={})).APERTURADA="APERTURADA",s.CERRADA="CERRADA",m;var s})(),c=(()=>{return(s=c||(c={})).INGRESO="INGRESO",s.EGRESO="EGRESO",c;var s})()},77121:(E,h,r)=>{r.d(h,{Z:()=>p});var g=r(80267),t=r(5e3);let p=(()=>{class m{transform(c,s,d){c||(c=0),d?!d&&d>4&&(d=4):d=2;const C=g.Z.find(_=>_.codigoMoneda===s);return`${C?C.simbolo:"Desc."} ${parseFloat(c).toFixed(d)}`}}return m.\u0275fac=function(c){return new(c||m)},m.\u0275pipe=t.Yjl({name:"montoDinero",type:m,pure:!0}),m})()}}]);