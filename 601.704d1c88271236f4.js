"use strict";(self.webpackChunkmirage=self.webpackChunkmirage||[]).push([[601],{9757:(y,_,n)=>{n.d(_,{d:()=>T});var e=n(70655),t=n(5e3),f=n(85932),l=n(81575),h=n(8929),u=n(7625),d=n(93075),v=n(82817),E=n(45330),P=n(59783),k=n(28566),O=n(20657),x=n(31424),C=n(69808),I=n(43724),S=n(40845);function c(i,s){1&i&&t._UZ(0,"p-message",11)}function g(i,s){1&i&&t._UZ(0,"p-message",12)}function o(i,s){1&i&&t._UZ(0,"p-message",13)}let p=(()=>{class i{constructor(r,a,m,A,b,j){this.config=r,this.ref=a,this.fb=m,this.confirmationService=A,this.inventoryService=b,this.messageService=j}ngOnInit(){this.builderForm()}get inventory(){return this.config.data.inventory}get stock(){return this.modelForm.get("stock")}builderForm(){this.modelForm=this.fb.group({stock:[void 0,[d.kI.required,d.kI.min(0),(0,v.pl)(this.inventory.stock)]]})}register(){const r=this.stock.value>this.inventory.stock?"agregando":"retirando",a=this.stock.value>this.inventory.stock?"ENTRADA":"SALIDA",m=Math.abs(this.stock.value-this.inventory.stock),A={puntoVenta:this.inventory.puntoVenta,items:[{cantidad:m,producto:this.inventory.producto,tipo:a}]};this.confirmationService.confirm({message:`Con el cambio actual est\xe1s ${r} ${m} existencias en tu inventario actual, est\xe1 seguro de proceder?`,accept:()=>{this.inventoryService.saveInventoryAdjustment(A).subscribe(b=>{this.messageService.add({severity:"success",detail:"Ajuste de inventario registrado correctamente.",summary:"Mensaje"}),this.ref.close(!0)})},acceptLabel:"Si",rejectLabel:"No"})}}return i.\u0275fac=function(r){return new(r||i)(t.Y36(E.S),t.Y36(E.E7),t.Y36(d.qu),t.Y36(P.YP),t.Y36(k.V),t.Y36(P.ez))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-editar-stock"]],decls:18,vars:5,consts:[[3,"formGroup","ngSubmit"],[1,"grid"],[1,"col-6","md:col-2"],["for","stock",1,"label-form"],[1,"col-6","md:col-4"],["pKeyFilter","num","formControlName","stock","id","stock","type","text","pInputText","",2,"width","100%","margin-bottom","0.2em"],["severity","error","text","Ingrese stock",4,"ngIf"],["severity","error","text","Ingrese stock v\xe1lido",4,"ngIf"],["severity","error","text","Ingrese un valor diferente al stock actual",4,"ngIf"],[1,"col-12","right"],["type","submit","pButton","","label","Registrar"],["severity","error","text","Ingrese stock"],["severity","error","text","Ingrese stock v\xe1lido"],["severity","error","text","Ingrese un valor diferente al stock actual"]],template:function(r,a){1&r&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return a.register()}),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"label",3),t._uU(4,"Stock actual"),t.qZA(),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"p"),t._uU(7),t.qZA(),t.qZA(),t.TgZ(8,"div",2),t.TgZ(9,"label",3),t._uU(10,"Nuevo stock (*)"),t.qZA(),t.qZA(),t.TgZ(11,"div",4),t._UZ(12,"input",5),t.YNc(13,c,1,0,"p-message",6),t.YNc(14,g,1,0,"p-message",7),t.YNc(15,o,1,0,"p-message",8),t.qZA(),t.TgZ(16,"div",9),t._UZ(17,"button",10),t.qZA(),t.qZA(),t.qZA()),2&r&&(t.Q6J("formGroup",a.modelForm),t.xp6(7),t.Oqu(a.inventory.stock),t.xp6(6),t.Q6J("ngIf",a.stock.touched&&(null==a.stock.errors?null:a.stock.errors.required)),t.xp6(1),t.Q6J("ngIf",a.stock.touched&&(null==a.stock.errors?null:a.stock.errors.min)),t.xp6(1),t.Q6J("ngIf",a.stock.touched&&(null==a.stock.errors?null:a.stock.errors.numberNot)))},directives:[d._Y,d.JL,d.sg,d.Fj,O.Fr,d.JJ,d.u,x.o,C.O5,I.q,S.Hq],styles:[""]}),i})();var Z=n(20207),M=n(79142),D=n(15315),U=n(98952),V=n(4119);function B(i,s){if(1&i){const r=t.EpF();t.TgZ(0,"span"),t.TgZ(1,"button",9),t.NdJ("click",function(){return t.CHM(r),t.oxw(2).displayModalInventarios=!0}),t.qZA(),t.qZA()}if(2&i){const r=t.oxw(2);t.xp6(1),t.Q6J("label",r.showStockByOffice)}}function J(i,s){if(1&i&&(t.TgZ(0,"span"),t.TgZ(1,"p-tag"),t._uU(2),t.qZA(),t.qZA()),2&i){const r=t.oxw(2);t.xp6(2),t.hij(" ",r.showStockByOffice,"\n")}}function N(i,s){if(1&i&&t._UZ(0,"input",10),2&i){const r=t.oxw(2);t.Q6J("value",r.showStockByOffice)}}function q(i,s){if(1&i&&(t.ynx(0),t.YNc(1,B,2,1,"span",0),t.YNc(2,J,3,1,"span",0),t.YNc(3,N,1,1,"input",8),t.BQk()),2&i){const r=t.oxw();t.xp6(1),t.Q6J("ngIf","button"===r.mostrar),t.xp6(1),t.Q6J("ngIf","tag"===r.mostrar),t.xp6(1),t.Q6J("ngIf","input"===r.mostrar)}}function L(i,s){1&i&&(t.TgZ(0,"th"),t._uU(1,"Acciones"),t.qZA())}function Y(i,s){if(1&i&&(t.TgZ(0,"tr"),t.TgZ(1,"th"),t._uU(2,"Punto de venta"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Cantidad"),t.qZA(),t.YNc(5,L,2,0,"th",0),t.qZA()),2&i){const r=t.oxw();t.xp6(5),t.Q6J("ngIf",r.hasPermissionAjuste)}}function R(i,s){if(1&i&&(t.TgZ(0,"p",11),t._uU(1),t.qZA()),2&i){const r=t.oxw().$implicit,a=t.oxw();t.xp6(1),t.hij(" ",a.getStockAlternative(r.stock)," ")}}function F(i,s){if(1&i){const r=t.EpF();t.TgZ(0,"td"),t.TgZ(1,"button",13),t.NdJ("click",function(){t.CHM(r);const m=t.oxw().$implicit;return t.oxw().openModalUpdateStock(m)}),t.qZA(),t.qZA()}}function $(i,s){if(1&i&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t.TgZ(4,"p",11),t._uU(5),t.qZA(),t.YNc(6,R,2,1,"p",12),t.qZA(),t.YNc(7,F,2,0,"td",0),t.qZA()),2&i){const r=s.$implicit,a=t.oxw();t.xp6(2),t.Oqu(null==r.puntoVenta?null:r.puntoVenta.nombre),t.xp6(3),t.AsE(" ",r.stock," ",null==a.producto||null==a.producto.unidad?null:a.producto.unidad.descripcion," "),t.xp6(1),t.Q6J("ngIf",null==a.producto?null:a.producto.unidadAlternativa),t.xp6(1),t.Q6J("ngIf",a.hasPermissionAjuste)}}const Q=function(){return{width:"50vw"}};class T{constructor(s,r){this.dialogService=s,this.loginService=r,this.unsubscribe$=new h.xQ,this.displayModalInventarios=!1,this.changeStock=new t.vpe}ngOnInit(){this.puntoVenta$.pipe((0,u.R)(this.unsubscribe$)).subscribe(s=>{this.puntoVenta=s})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}get hasPermissionAjuste(){return this.loginService.hasPermission("INVENTARIO_AJUSTAR")}get stockByOffice(){if(!this.producto.servicio&&this.producto.inventarios){const s=this.producto.inventarios.find(r=>r.puntoVenta.id===this.puntoVenta.id);return s?s.stock:void 0}}get showStockByOffice(){return this.stockByOffice?this.stockByOffice.toString():"-"}get titleModal(){return this.producto?`${this.producto.nombre} | Existencias`:""}getStockAlternative(s){if(this.stockByOffice&&this.producto.unidadAlternativa&&this.producto.factorUnidadAlternativa){const r=s/this.producto.factorUnidadAlternativa;return`${Math.trunc(r)} ${this.producto.unidadAlternativa.descripcion}, ${(this.producto.factorUnidadAlternativa*(r%1)).toFixed(2)}  ${this.producto.unidad.descripcion}`}return"-"}openModalUpdateStock(s){this.dialogService.open(p,{data:{inventory:s},header:`Editar inventario -> ${s.producto.nombre} -> (${s.puntoVenta.nombre})`,width:"80%"}).onClose.subscribe(a=>{a&&(this.displayModalInventarios=!1,this.changeStock.emit())})}}T.\u0275fac=function(s){return new(s||T)(t.Y36(E.xA),t.Y36(Z.r))},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-mostrar-stock"]],inputs:{producto:"producto",mostrar:"mostrar"},outputs:{changeStock:"changeStock"},decls:9,vars:8,consts:[[4,"ngIf"],["appendTo","body",3,"modal","header","visible","visibleChange"],[1,"grid"],[1,"col-12"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["type","button","pButton","","label","Cerrar",1,"p-button-secondary",3,"click"],["style","width: 100%;","disabled","","type","text","pInputText","",3,"value",4,"ngIf"],["type","button","pButton","",1,"p-button-secondary",3,"label","click"],["disabled","","type","text","pInputText","",2,"width","100%",3,"value"],[1,"m-1"],["class","m-1",4,"ngIf"],["pButton","","type","button","icon","pi pi-pencil","pTooltip","Editar stock","tooltipPosition","top",3,"click"]],template:function(s,r){1&s&&(t.YNc(0,q,4,3,"ng-container",0),t.TgZ(1,"p-dialog",1),t.NdJ("visibleChange",function(m){return r.displayModalInventarios=m}),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"p-table",4),t.YNc(5,Y,6,1,"ng-template",5),t.YNc(6,$,8,5,"ng-template",6),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"p-footer"),t.TgZ(8,"button",7),t.NdJ("click",function(){return r.displayModalInventarios=!1}),t.qZA(),t.qZA(),t.qZA()),2&s&&(t.Q6J("ngIf",r.producto),t.xp6(1),t.Akn(t.DdM(7,Q)),t.Q6J("modal",!0)("header",r.titleModal)("visible",r.displayModalInventarios),t.xp6(3),t.Q6J("value",null==r.producto?null:r.producto.inventarios))},directives:[C.O5,S.Hq,M.V,x.o,D.V,U.iA,P.jx,V.u,P.$_],styles:[""]}),(0,e.gn)([(0,f.Ph)(l.Z.getOffice)],T.prototype,"puntoVenta$",void 0)},99266:(y,_,n)=>{n.d(_,{w:()=>f});var e=n(20958),t=n(5e3);let f=(()=>{class l{}return l.\u0275fac=function(u){return new(u||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[[e.m]]}),l})()},70050:(y,_,n)=>{n.d(_,{e:()=>S});var e=n(5e3),t=n(80267),f=n(20207),l=n(69808),h=n(40845),u=n(15315),d=n(98952),v=n(59783);function E(c,g){if(1&c&&(e.TgZ(0,"div",12),e._uU(1),e.ALo(2,"moneda"),e.qZA()),2&c){const o=e.oxw();e.xp6(1),e.AsE(" ",e.lcZ(2,2,null==o.producto?null:o.producto.moneda)," ",o.precioPorDefecto.precio,"\n")}}function P(c,g){if(1&c){const o=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"button",13),e.NdJ("click",function(){return e.CHM(o),e.oxw().showBasicDialog()}),e.qZA(),e.qZA()}if(2&c){const o=e.oxw();e.xp6(1),e.Q6J("label",o.labelButtonPrice)}}function k(c,g){1&c&&(e.TgZ(0,"span"),e._uU(1,"Si"),e.qZA())}function O(c,g){1&c&&e._uU(0,"No")}function x(c,g){1&c&&(e.TgZ(0,"tr"),e.TgZ(1,"th"),e._uU(2,"Punto de venta"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Tipo precio"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Margen de utilidad"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Precio"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Precio neto"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Unidades mayoreo"),e.qZA(),e.qZA())}function C(c,g){if(1&c&&(e.TgZ(0,"tr"),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.ALo(7,"number"),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.ALo(10,"moneda"),e.ALo(11,"number"),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.ALo(14,"moneda"),e.ALo(15,"number"),e.qZA(),e.TgZ(16,"td"),e._uU(17),e.ALo(18,"number"),e.qZA(),e.qZA()),2&c){const o=g.$implicit,p=e.oxw();e.xp6(2),e.Oqu(null==o.puntoVenta?null:o.puntoVenta.nombre),e.xp6(2),e.Oqu(p.getProductPriceLabel(o.tipoPrecio)),e.xp6(2),e.hij("",e.xi3(7,8,o.margenUtilidad,"1.2-5")," %"),e.xp6(3),e.AsE("",e.lcZ(10,11,p.producto.moneda)," ",e.xi3(11,13,o.precio,"1.2-5"),""),e.xp6(4),e.AsE("",e.lcZ(14,16,p.producto.moneda)," ",e.xi3(15,18,o.precioNeto,"1.2-5"),""),e.xp6(4),e.Oqu(e.xi3(18,21,o.unidadesMayoreo,"1.2-5"))}}const I=function(){return{width:"50vw"}};let S=(()=>{class c{constructor(o,p){this.monedaPipe=o,this.loginService=p,this.puntosVenta=[]}ngOnInit(){this.puntosVenta=this.loginService.getPuntosVentaUsuario()}get titleModal(){return this.producto?`${this.producto.nombre} | Lista de precios`:""}get preciosPorPuntoVenta(){return this.producto.preciosPorPuntoVenta}get esPrecioUnico(){return!this.producto||!this.preciosPorPuntoVenta&&this.producto.preciosVenta.filter(o=>!o.puntoVenta).length<=1}get preciosVenta(){return this.producto?this.preciosPorPuntoVenta?this.producto.preciosVenta.filter(o=>o.puntoVenta).filter(o=>this.puntosVenta.map(p=>p.id).includes(o.puntoVenta.id)):this.producto.preciosVenta.filter(o=>!o.puntoVenta):[]}get precioPorDefecto(){return!this.preciosPorPuntoVenta&&this.producto.preciosVenta.filter(o=>!o.puntoVenta&&"POR_DEFECTO"===o.tipoPrecio).length?this.producto.preciosVenta.filter(o=>!o.puntoVenta&&"POR_DEFECTO"===o.tipoPrecio)[0]:this.preciosPorPuntoVenta&&this.producto.preciosVenta.filter(o=>o.puntoVenta&&o.puntoVenta.id===this.puntoVenta.id&&"POR_DEFECTO"===o.tipoPrecio).length?this.producto.preciosVenta.filter(o=>o.puntoVenta&&o.puntoVenta.id===this.puntoVenta.id&&"POR_DEFECTO"===o.tipoPrecio)[0]:{tipoPrecio:"POR_DEFECTO"}}get labelButtonPrice(){return this.precioPorDefecto.precio?`${this.monedaPipe.transform(this.producto.moneda)} ${this.precioPorDefecto.precio}`:"No definido"}showBasicDialog(){this.displayModalPrecios=!0}getProductPriceLabel(o){switch(o){case"POR_DEFECTO":return"Por defecto";case"MAYOREO":return"Mayoreo";case"ESPECIAL":return"Especial";default:return""}}}return c.\u0275fac=function(o){return new(o||c)(e.Y36(t.s),e.Y36(f.r))},c.\u0275cmp=e.Xpm({type:c,selectors:[["app-precio-producto-detalle"]],inputs:{producto:"producto",puntoVenta:"puntoVenta"},decls:22,vars:16,consts:[["class","price-info",4,"ngIf","ngIfElse"],["precioButton",""],["appendTo","body",3,"modal","header","visible","baseZIndex","visibleChange"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],[4,"ngIf","ngIfElse"],["no",""],[1,"col-12"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["type","button","pButton","","label","Cerrar",1,"p-button-secondary",3,"click"],[1,"price-info"],["type","button","pButton","",1,"p-button-secondary",3,"label","click"]],template:function(o,p){if(1&o&&(e.YNc(0,E,3,4,"div",0),e.YNc(1,P,2,1,"ng-template",null,1,e.W1O),e.TgZ(3,"p-dialog",2),e.NdJ("visibleChange",function(M){return p.displayModalPrecios=M}),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e.TgZ(6,"h3"),e._uU(7,"Precios por punto de venta:"),e.qZA(),e.YNc(8,k,2,0,"span",5),e.YNc(9,O,1,0,"ng-template",null,6,e.W1O),e.qZA(),e.TgZ(11,"div",4),e.TgZ(12,"h3"),e._uU(13,"Moneda:"),e.qZA(),e._uU(14),e.ALo(15,"moneda"),e.qZA(),e.TgZ(16,"div",7),e.TgZ(17,"p-table",8),e.YNc(18,x,13,0,"ng-template",9),e.YNc(19,C,19,24,"ng-template",10),e.qZA(),e.qZA(),e.qZA(),e.TgZ(20,"p-footer"),e.TgZ(21,"button",11),e.NdJ("click",function(){return p.displayModalPrecios=!1}),e.qZA(),e.qZA(),e.qZA()),2&o){const Z=e.MAs(2),M=e.MAs(10);e.Q6J("ngIf",p.esPrecioUnico)("ngIfElse",Z),e.xp6(3),e.Akn(e.DdM(15,I)),e.Q6J("modal",!0)("header",p.titleModal)("visible",p.displayModalPrecios)("baseZIndex",2e4),e.xp6(5),e.Q6J("ngIf",p.preciosPorPuntoVenta)("ngIfElse",M),e.xp6(6),e.hij(" ",e.xi3(15,12,p.producto.moneda,"moneda")," "),e.xp6(3),e.Q6J("value",p.preciosVenta)}},directives:[l.O5,h.Hq,u.V,d.iA,v.jx,v.$_],pipes:[t.s,l.JJ],styles:[".price-info[_ngcontent-%COMP%]{width:100%;display:flex;align-items:flex-end;justify-content:flex-end}"]}),c})()},16672:(y,_,n)=>{n.d(_,{u:()=>f});var e=n(20958),t=n(5e3);let f=(()=>{class l{}return l.\u0275fac=function(u){return new(u||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[[e.m]]}),l})()},19406:(y,_,n)=>{n.d(_,{P:()=>h});var e=n(20958),t=n(99266),f=n(16672),l=n(5e3);let h=(()=>{class u{}return u.\u0275fac=function(v){return new(v||u)},u.\u0275mod=l.oAB({type:u}),u.\u0275inj=l.cJS({imports:[[e.m,t.w,f.u]]}),u})()}}]);